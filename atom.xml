<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>羊末离殇的独立博客</title>
  
  <subtitle>单身狗在奋斗</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://blog.ymlsfly.xin/"/>
  <updated>2023-04-22T02:52:04.287Z</updated>
  <id>http://blog.ymlsfly.xin/</id>
  
  <author>
    <name>羊末离殇</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>batch-insert-JdbcTemplate</title>
    <link href="http://blog.ymlsfly.xin/2023/04/22/batch-insert-jdbcTemplate/"/>
    <id>http://blog.ymlsfly.xin/2023/04/22/batch-insert-jdbcTemplate/</id>
    <published>2023-04-22T03:45:22.000Z</published>
    <updated>2023-04-22T02:52:04.287Z</updated>
    
    <content type="html"><![CDATA[<h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>后台开发中，批量往数据库写数据是一个很常见的功能，下面就简单实现一下使用 JdbcTemplate 来 batch 写入。</p><h4 id="实现介绍"><a href="#实现介绍" class="headerlink" title="实现介绍"></a>实现介绍</h4><h5 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h5><p>在项目的 pom.xml 中配置 JdbcTemplate 及 mysql 相关的依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.46<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="自定义-table-注解"><a href="#自定义-table-注解" class="headerlink" title="自定义 table 注解"></a>自定义 table 注解</h5><p>新建一个自定义注解，作用于类上面，用于备注 table 信息</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Description：需要进行入库操作的表实体注解</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> fy</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target</span>(ElementType.TYPE)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> DbTable &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 表名</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> fy</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> java.lang.String</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">String <span class="title">tableName</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 表的主键</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> fy</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> java.lang.String</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">String <span class="title">primaryKey</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 不参与操作的黑名单字段属性</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> fy</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> java.lang.String[]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String[] blackIgnoreFieldList() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="自定义-column-注解"><a href="#自定义-column-注解" class="headerlink" title="自定义 column 注解"></a>自定义 column 注解</h5><p>新建一个自定义注解，作用于类属性上面，用于备注 column 信息</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Description：需要进行入库操作的表字段注解</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> fy</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Target</span>(ElementType.FIELD)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> DbColumn &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 该字段是否允许为空（NULL）</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> fy</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> boolean</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">nullable</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 新增时忽略</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> fy</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> boolean</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">ignoredInsert</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 更新时忽略</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> fy</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> boolean</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">ignoredUpdate</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 字段为 NULL 时候的默认值，不能漏了''</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> fy</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> java.lang.String</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">String <span class="title">defaultValue</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="逻辑处理工具类"><a href="#逻辑处理工具类" class="headerlink" title="逻辑处理工具类"></a>逻辑处理工具类</h5><p>利用自定义的两个注解搭配反射获取表及表字段相关信息，然后通过字符串拼装出 batch 操作的 sql，最后通过 jdbcTemplate.execute 来执行该 sql 进行批量操作。</p><p>该类需要加入 spring 管理。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.fy.util.NormalUtil;</span><br><span class="line"><span class="keyword">import</span> com.fy.util.db.ann.DbColumn;</span><br><span class="line"><span class="keyword">import</span> com.fy.util.db.ann.DbTable;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Description：db 操作工具类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> fy</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DbUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;db-util.sql.log:false&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isSqlLog;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 批量执行的批次默认大小</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BATCH_SIZE_DEFAULT = <span class="number">5000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String EMPTY_COLUMN_DATA = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 批量更新（通过主键）</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> fy</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> list 批量更新的数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">batchUpdateByPrimaryKey</span><span class="params">(List&lt;?&gt; list)</span> </span>&#123;</span><br><span class="line">        batchUpdateByPrimaryKey(list, BATCH_SIZE_DEFAULT);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 批量更新（通过主键）</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> fy</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> list 批量更新的数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> batchSize 批量批次的大小</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">batchUpdateByPrimaryKey</span><span class="params">(List&lt;?&gt; list, <span class="keyword">int</span> batchSize)</span> </span>&#123;</span><br><span class="line">        ClassBean classBean = checkAndLoadClass(list);</span><br><span class="line">        <span class="keyword">if</span> (classBean == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        DbTable dbTable = classBean.getDbTable();</span><br><span class="line">        String primaryKey = dbTable.primaryKey();</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">""</span>.equals(primaryKey.trim())) &#123;</span><br><span class="line">            <span class="comment">// 配置没有指定主键</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        batchUpdate(list, Collections.singletonList(primaryKey), batchSize);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 批量更新</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> fy</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> list 批量更新的数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> whereColList 作为 where 条件的字段</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">batchUpdate</span><span class="params">(List&lt;?&gt; list, List&lt;String&gt; whereColList)</span> </span>&#123;</span><br><span class="line">        batchUpdate(list, whereColList, BATCH_SIZE_DEFAULT);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 批量更新</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> fy</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> list 批量更新的数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> whereColList 作为 where 条件的字段</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> batchSize 批量批次的大小</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">batchUpdate</span><span class="params">(List&lt;?&gt; list, List&lt;String&gt; whereColList, <span class="keyword">int</span> batchSize)</span> </span>&#123;</span><br><span class="line">        ClassBean classBean = checkAndLoadClass(list);</span><br><span class="line">        <span class="keyword">if</span> (classBean == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        DbTable dbTable = classBean.getDbTable();</span><br><span class="line">        String tableName = dbTable.tableName();</span><br><span class="line">        Map&lt;String, FieldBean&gt; map = classBean.getFieldBeanMap();</span><br><span class="line">        <span class="keyword">if</span> (map == <span class="keyword">null</span> || map.size() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (Object o : list) &#123;</span><br><span class="line">            StringBuilder toUpdateSb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">boolean</span> hasToUpdate = isHasToUpdate(whereColList, map, o, toUpdateSb);</span><br><span class="line">                <span class="keyword">if</span> (hasToUpdate) &#123;</span><br><span class="line">                    sb.append(<span class="string">" UPDATE "</span>).append(tableName).append(<span class="string">" SET "</span>)</span><br><span class="line">                            .append(toUpdateSb.toString());</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// 说明没有需要更新的字段</span></span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                loadWhere(whereColList, map, sb, o);</span><br><span class="line">                sb.append(<span class="string">"; "</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">                <span class="comment">// 获取值失败</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            count ++;</span><br><span class="line">            <span class="keyword">if</span> (count == batchSize) &#123;</span><br><span class="line">                <span class="comment">// 达到了批次数量，开始执行，并清理 sql</span></span><br><span class="line">                executeSql(sb.toString());</span><br><span class="line">                count = <span class="number">0</span>;</span><br><span class="line">                sb.delete(<span class="number">0</span>, sb.length());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 执行未执行的批次</span></span><br><span class="line">            executeSql(sb.toString());</span><br><span class="line">            sb.delete(<span class="number">0</span>, sb.length());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isHasToUpdate</span><span class="params">(List&lt;String&gt; whereColList,</span></span></span><br><span class="line"><span class="function"><span class="params">                                  Map&lt;String, FieldBean&gt; map,</span></span></span><br><span class="line"><span class="function"><span class="params">                                  Object data,</span></span></span><br><span class="line"><span class="function"><span class="params">                                  StringBuilder toUpdateSb)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> IllegalAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> hasToUpdate = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, FieldBean&gt; entry : map.entrySet()) &#123;</span><br><span class="line">            String name = entry.getKey();</span><br><span class="line">            <span class="keyword">if</span> (whereColList != <span class="keyword">null</span> &amp;&amp; whereColList.contains(name)) &#123;</span><br><span class="line">                <span class="comment">// 这个字段在 where 条件中</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            FieldBean fieldBean = entry.getValue();</span><br><span class="line">            DbColumn dbColumn = fieldBean.getDbColumn();</span><br><span class="line">            <span class="keyword">if</span> (dbColumn != <span class="keyword">null</span> &amp;&amp; dbColumn.ignoredUpdate()) &#123;</span><br><span class="line">                <span class="comment">// 该字段设置了忽略更新</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            Object colData = fieldBean.getField().get(data);</span><br><span class="line">            <span class="keyword">if</span> (colData == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// 该字段值为空</span></span><br><span class="line">                <span class="keyword">if</span> (dbColumn != <span class="keyword">null</span> &amp;&amp; dbColumn.nullable()) &#123;</span><br><span class="line">                    <span class="comment">// 设置了该字段允许为空</span></span><br><span class="line">                    <span class="keyword">if</span> (hasToUpdate) &#123;</span><br><span class="line">                        toUpdateSb.append(<span class="string">", "</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    toUpdateSb.append(name).append(<span class="string">" = NULL "</span>);</span><br><span class="line">                    hasToUpdate = <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 该字段值不为空</span></span><br><span class="line">                <span class="keyword">if</span> (hasToUpdate) &#123;</span><br><span class="line">                    toUpdateSb.append(<span class="string">", "</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                toUpdateSb.append(name).append(<span class="string">" = "</span>)</span><br><span class="line">                        .append(<span class="string">"'"</span>).append(getData(colData)).append(<span class="string">"'"</span>);</span><br><span class="line">                hasToUpdate = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> hasToUpdate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">loadWhere</span><span class="params">(List&lt;String&gt; whereColList,</span></span></span><br><span class="line"><span class="function"><span class="params">                           Map&lt;String, FieldBean&gt; map,</span></span></span><br><span class="line"><span class="function"><span class="params">                           StringBuilder sqlSb,</span></span></span><br><span class="line"><span class="function"><span class="params">                           Object data)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> IllegalAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (whereColList != <span class="keyword">null</span> &amp;&amp; whereColList.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            StringBuilder whereSb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">            <span class="keyword">boolean</span> hasWhere = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">for</span> (String colName : whereColList) &#123;</span><br><span class="line">                FieldBean fieldBean = map.get(colName);</span><br><span class="line">                <span class="keyword">if</span> (fieldBean == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// 不存在这个字段</span></span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (hasWhere) &#123;</span><br><span class="line">                    whereSb.append(<span class="string">" AND "</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                Object colData = fieldBean.getField().get(data);</span><br><span class="line">                whereSb.append(colName).append(<span class="string">" = "</span>)</span><br><span class="line">                        .append(<span class="string">"'"</span>).append(getData(colData)).append(<span class="string">"'"</span>);</span><br><span class="line">                hasWhere = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (hasWhere) &#123;</span><br><span class="line">                sqlSb.append(<span class="string">" WHERE "</span>).append(whereSb.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 批量新增（非空字段）</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> fy</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> list 批量新增的数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">batchInsertSelective</span><span class="params">(List&lt;?&gt; list)</span> </span>&#123;</span><br><span class="line">        batchInsertSelective(list, BATCH_SIZE_DEFAULT);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 批量新增（非空字段）</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> fy</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> list 批量新增的数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> batchSize 批量的批次大小</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">batchInsertSelective</span><span class="params">(List&lt;?&gt; list, <span class="keyword">int</span> batchSize)</span> </span>&#123;</span><br><span class="line">        ClassBean classBean = checkAndLoadClass(list);</span><br><span class="line">        <span class="keyword">if</span> (classBean == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        DbTable dbTable = classBean.getDbTable();</span><br><span class="line">        String tableName = dbTable.tableName();</span><br><span class="line">        Map&lt;String, FieldBean&gt; map = classBean.getFieldBeanMap();</span><br><span class="line">        <span class="keyword">if</span> (map == <span class="keyword">null</span> || map.size() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (Object o : list) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                StringBuilder columnSb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">                StringBuilder dataSb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">                <span class="keyword">boolean</span> hasToInsert = isHasToInsert(map, o, columnSb, dataSb);</span><br><span class="line">                <span class="keyword">if</span> (hasToInsert) &#123;</span><br><span class="line">                    sb.append(<span class="string">" INSERT INTO "</span>).append(tableName).append(<span class="string">" ("</span>)</span><br><span class="line">                            .append(columnSb.toString()).append(<span class="string">") VALUES ("</span>)</span><br><span class="line">                            .append(dataSb.toString()).append(<span class="string">"); "</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// 没有需要插入的数据</span></span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IllegalAccessException ignored) &#123;</span><br><span class="line">                <span class="comment">// 获取值发生异常</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            count ++;</span><br><span class="line">            <span class="keyword">if</span> (count == batchSize) &#123;</span><br><span class="line">                <span class="comment">// 达到了批次数量，开始执行，并清理 sql</span></span><br><span class="line">                executeSql(sb.toString());</span><br><span class="line">                count = <span class="number">0</span>;</span><br><span class="line">                sb.delete(<span class="number">0</span>, sb.length());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 执行未执行的批次</span></span><br><span class="line">            executeSql(sb.toString());</span><br><span class="line">            sb.delete(<span class="number">0</span>, sb.length());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isHasToInsert</span><span class="params">(Map&lt;String, FieldBean&gt; map,</span></span></span><br><span class="line"><span class="function"><span class="params">                                  Object data,</span></span></span><br><span class="line"><span class="function"><span class="params">                                  StringBuilder columnSb,</span></span></span><br><span class="line"><span class="function"><span class="params">                                  StringBuilder dataSb)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> IllegalAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> hasToInsert = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, FieldBean&gt; entry : map.entrySet()) &#123;</span><br><span class="line">            String columnName = entry.getKey();</span><br><span class="line">            FieldBean fieldBean = entry.getValue();</span><br><span class="line">            Object colData = fieldBean.getField().get(data);</span><br><span class="line">            DbColumn dbColumn = fieldBean.getDbColumn();</span><br><span class="line">            <span class="keyword">if</span> (dbColumn != <span class="keyword">null</span> &amp;&amp; dbColumn.ignoredInsert()) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (colData == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// 该字段值为空</span></span><br><span class="line">                <span class="keyword">if</span> (dbColumn != <span class="keyword">null</span> &amp;&amp; !EMPTY_COLUMN_DATA.equals(dbColumn.defaultValue())) &#123;</span><br><span class="line">                    <span class="comment">// 该字段配置了默认值</span></span><br><span class="line">                    <span class="keyword">if</span> (hasToInsert) &#123;</span><br><span class="line">                        columnSb.append(<span class="string">","</span>);</span><br><span class="line">                        dataSb.append(<span class="string">","</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    columnSb.append(columnName);</span><br><span class="line">                    dataSb.append(dbColumn.defaultValue());</span><br><span class="line">                    hasToInsert = <span class="keyword">true</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (dbColumn != <span class="keyword">null</span> &amp;&amp; dbColumn.nullable()) &#123;</span><br><span class="line">                        <span class="comment">// 设置了该字段允许为空</span></span><br><span class="line">                        <span class="keyword">if</span> (hasToInsert) &#123;</span><br><span class="line">                            columnSb.append(<span class="string">","</span>);</span><br><span class="line">                            dataSb.append(<span class="string">","</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                        columnSb.append(columnName);</span><br><span class="line">                        dataSb.append(<span class="string">" NULL "</span>);</span><br><span class="line">                        hasToInsert = <span class="keyword">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 字段值不为空</span></span><br><span class="line">                <span class="keyword">if</span> (hasToInsert) &#123;</span><br><span class="line">                    columnSb.append(<span class="string">","</span>);</span><br><span class="line">                    dataSb.append(<span class="string">","</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                columnSb.append(columnName);</span><br><span class="line">                dataSb.append(<span class="string">"'"</span>).append(getData(colData)).append(<span class="string">"'"</span>);</span><br><span class="line">                hasToInsert = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> hasToInsert;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 批量新增（所有字段）</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> fy</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> list 批量新增的数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">batchInsert</span><span class="params">(List&lt;?&gt; list)</span> </span>&#123;</span><br><span class="line">        batchInsert(list, BATCH_SIZE_DEFAULT);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 批量新增（所有字段）</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> fy</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> list 批量新增的数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> batchSize 批量的批次大小</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">batchInsert</span><span class="params">(List&lt;?&gt; list, <span class="keyword">int</span> batchSize)</span> </span>&#123;</span><br><span class="line">        ClassBean classBean = checkAndLoadClass(list);</span><br><span class="line">        <span class="keyword">if</span> (classBean == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        DbTable dbTable = classBean.getDbTable();</span><br><span class="line">        String tableName = dbTable.tableName();</span><br><span class="line">        Map&lt;String, FieldBean&gt; map = classBean.getFieldBeanMap();</span><br><span class="line">        <span class="keyword">if</span> (map == <span class="keyword">null</span> || map.size() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        StringBuilder columnSb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="comment">// 先组装出字段字符串</span></span><br><span class="line">        <span class="keyword">boolean</span> isNotFirst = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, FieldBean&gt; entry : map.entrySet()) &#123;</span><br><span class="line">            FieldBean fieldBean = entry.getValue();</span><br><span class="line">            DbColumn dbColumn = fieldBean.getDbColumn();</span><br><span class="line">            <span class="keyword">if</span> (dbColumn != <span class="keyword">null</span> &amp;&amp; dbColumn.ignoredInsert()) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (isNotFirst) &#123;</span><br><span class="line">                columnSb.append(<span class="string">","</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            columnSb.append(entry.getKey());</span><br><span class="line">            isNotFirst = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        StringBuilder dataSb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">for</span> (Object o : list) &#123;</span><br><span class="line">            <span class="keyword">if</span> (sb.length() == <span class="number">0</span>) &#123;</span><br><span class="line">                sb.append(<span class="string">" INSERT INTO "</span>).append(tableName).append(<span class="string">" ("</span>)</span><br><span class="line">                        .append(columnSb.toString()).append(<span class="string">") VALUES "</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                dataSb.append(<span class="string">","</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                dataSb.append(<span class="string">"("</span>);</span><br><span class="line">                <span class="keyword">boolean</span> isNotFirstColumn = <span class="keyword">false</span>;</span><br><span class="line">                <span class="keyword">for</span> (Map.Entry&lt;String, FieldBean&gt; entry : map.entrySet()) &#123;</span><br><span class="line">                    FieldBean fieldBean = entry.getValue();</span><br><span class="line">                    DbColumn dbColumn = fieldBean.getDbColumn();</span><br><span class="line">                    <span class="keyword">if</span> (dbColumn != <span class="keyword">null</span> &amp;&amp; dbColumn.ignoredInsert()) &#123;</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    Object data = fieldBean.getField().get(o);</span><br><span class="line">                    <span class="keyword">if</span> (isNotFirstColumn) &#123;</span><br><span class="line">                        dataSb.append(<span class="string">","</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (data == <span class="keyword">null</span>) &#123;</span><br><span class="line">                        <span class="comment">// 该字段值为空</span></span><br><span class="line">                        <span class="keyword">if</span> (dbColumn != <span class="keyword">null</span> &amp;&amp; !EMPTY_COLUMN_DATA.equals(dbColumn.defaultValue())) &#123;</span><br><span class="line">                            <span class="comment">// 该字段配置了默认值</span></span><br><span class="line">                            dataSb.append(dbColumn.defaultValue());</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            dataSb.append(<span class="string">" NULL "</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">// 字段值不为空</span></span><br><span class="line">                        dataSb.append(<span class="string">"'"</span>).append(getData(data)).append(<span class="string">"'"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    isNotFirstColumn = <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                dataSb.append(<span class="string">")"</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IllegalAccessException ignored) &#123;</span><br><span class="line">                <span class="comment">// 获取值发生异常</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            count ++;</span><br><span class="line">            <span class="keyword">if</span> (count == batchSize) &#123;</span><br><span class="line">                <span class="comment">// 达到了批次数量，开始执行，并清理 sql</span></span><br><span class="line">                sb.append(dataSb.toString()).append(<span class="string">";"</span>);</span><br><span class="line">                executeSql(sb.toString());</span><br><span class="line">                count = <span class="number">0</span>;</span><br><span class="line">                dataSb.delete(<span class="number">0</span>, dataSb.length());</span><br><span class="line">                sb.delete(<span class="number">0</span>, sb.length());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 执行未执行的批次</span></span><br><span class="line">            sb.append(dataSb.toString()).append(<span class="string">";"</span>);</span><br><span class="line">            executeSql(sb.toString());</span><br><span class="line">            dataSb.delete(<span class="number">0</span>, dataSb.length());</span><br><span class="line">            sb.delete(<span class="number">0</span>, sb.length());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 执行 sql</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> fy</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sql 待执行的 sql 语句</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">executeSql</span><span class="params">(String sql)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (isSqlLog) &#123;</span><br><span class="line">            System.err.println(sql);</span><br><span class="line">        &#125;</span><br><span class="line">        jdbcTemplate.execute(sql);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Object <span class="title">getData</span><span class="params">(Object data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (data == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (data <span class="keyword">instanceof</span> Date) &#123;</span><br><span class="line">            data = NormalUtil.formatDate((Date) data, <span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 基础检查类信息</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> fy</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> list 数据列表</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> com.fy.util.db.DbUtil.ClassBean</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> ClassBean <span class="title">checkAndLoadClass</span><span class="params">(List&lt;?&gt; list)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (list == <span class="keyword">null</span> || list.size() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 数据为空</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Class&lt;?&gt; clazz = list.get(<span class="number">0</span>).getClass();</span><br><span class="line">        DbTable dbTable = clazz.getAnnotation(DbTable.class);</span><br><span class="line">        <span class="keyword">if</span> (dbTable == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 必须有这个注解</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(clazz.getName() + <span class="string">" 类缺失【DbTable】注解！"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> getTransClass(clazz);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, ClassBean&gt; CLASS_TRANS_MAP_CACHE = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Set&lt;String&gt; BLACK_FIELD_IGNORED_SET =</span><br><span class="line">            Collections.singleton(<span class="string">"serialVersionUID"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 通过 class 类获取该类中相关信息</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> fy</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> clazz 操作的 class 类</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> com.fy.util.db.DbUtil.ClassBean</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> ClassBean <span class="title">getTransClass</span><span class="params">(Class&lt;?&gt; clazz)</span> </span>&#123;</span><br><span class="line">        String clazzName = clazz.getName();</span><br><span class="line">        <span class="keyword">if</span> (CLASS_TRANS_MAP_CACHE.containsKey(clazzName)) &#123;</span><br><span class="line">            <span class="keyword">return</span> CLASS_TRANS_MAP_CACHE.get(clazzName);</span><br><span class="line">        &#125;</span><br><span class="line">        ClassBean classBean = CLASS_TRANS_MAP_CACHE.computeIfAbsent(clazzName,</span><br><span class="line">                k -&gt; <span class="keyword">new</span> ClassBean());</span><br><span class="line">        Field[] fields = clazz.getDeclaredFields();</span><br><span class="line">        Map&lt;String, FieldBean&gt; fieldBeanMap = <span class="keyword">new</span> HashMap&lt;&gt;(fields.length);</span><br><span class="line">        DbTable dbTable = clazz.getAnnotation(DbTable.class);</span><br><span class="line">        <span class="keyword">if</span> (dbTable == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(clazz.getName() + <span class="string">" 类缺失【DbTable】注解！"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        String[] blackIgnoreFieldList = dbTable.blackIgnoreFieldList();</span><br><span class="line">        BLACK_FIELD_IGNORED_SET.addAll(Arrays.asList(blackIgnoreFieldList));</span><br><span class="line">        <span class="keyword">for</span> (Field field : fields) &#123;</span><br><span class="line">            <span class="keyword">if</span> (BLACK_FIELD_IGNORED_SET.contains(field.getName())) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            <span class="comment">// key 是下划线格式</span></span><br><span class="line">            fieldBeanMap.put(NormalUtil.transUpper2Under(field.getName()),</span><br><span class="line">                    <span class="keyword">new</span> FieldBean(field, field.getAnnotation(DbColumn.class)));</span><br><span class="line">        &#125;</span><br><span class="line">        classBean.setClazz(clazz);</span><br><span class="line">        classBean.setDbTable(dbTable);</span><br><span class="line">        classBean.setFieldBeanMap(fieldBeanMap);</span><br><span class="line">        <span class="keyword">return</span> classBean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 储存 class 相关信息的 bean</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> fy</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="meta">@Setter</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ClassBean</span> </span>&#123;</span><br><span class="line">        Class&lt;?&gt; clazz;</span><br><span class="line">        DbTable dbTable;</span><br><span class="line">        Map&lt;String, FieldBean&gt; fieldBeanMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 储存字段相关信息的 bean</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> fy</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="meta">@Setter</span></span><br><span class="line">    <span class="meta">@NoArgsConstructor</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">FieldBean</span> </span>&#123;</span><br><span class="line">        Field field;</span><br><span class="line">        DbColumn dbColumn;</span><br><span class="line"></span><br><span class="line">        FieldBean(Field field, DbColumn dbColumn) &#123;</span><br><span class="line">            <span class="keyword">this</span>.field = field;</span><br><span class="line">            <span class="keyword">this</span>.dbColumn = dbColumn;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="方法概览"><a href="#方法概览" class="headerlink" title="方法概览"></a>方法概览</h5><p>预览工具类中的几个 public 方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 批量更新（通过主键）</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">batchUpdateByPrimaryKey</span><span class="params">(List&lt;?&gt; list)</span></span>;</span><br><span class="line"><span class="comment">// 批量更新（通过主键）</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">batchUpdateByPrimaryKey</span><span class="params">(List&lt;?&gt; list, <span class="keyword">int</span> batchSize)</span></span>;</span><br><span class="line"><span class="comment">// 批量更新</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">batchUpdate</span><span class="params">(List&lt;?&gt; list, List&lt;String&gt; whereColList)</span></span>;</span><br><span class="line"><span class="comment">// 批量更新</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">batchUpdate</span><span class="params">(List&lt;?&gt; list, List&lt;String&gt; whereColList, <span class="keyword">int</span> batchSize)</span></span>;</span><br><span class="line"><span class="comment">// 批量新增（非空字段）</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">batchInsertSelective</span><span class="params">(List&lt;?&gt; list)</span></span>;</span><br><span class="line"><span class="comment">// 批量新增（非空字段）</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">batchInsertSelective</span><span class="params">(List&lt;?&gt; list, <span class="keyword">int</span> batchSize)</span></span>;</span><br><span class="line"><span class="comment">// 批量新增（所有字段）</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">batchInsert</span><span class="params">(List&lt;?&gt; list)</span></span>;</span><br><span class="line"><span class="comment">// 批量新增（所有字段）</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">batchInsert</span><span class="params">(List&lt;?&gt; list, <span class="keyword">int</span> batchSize)</span></span>;</span><br></pre></td></tr></table></figure><h5 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h5><p>1、先在需批量操作的 bean 类上添加相关注解</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.fy.util.db.ann.DbColumn;</span><br><span class="line"><span class="keyword">import</span> com.fy.util.db.ann.DbTable;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@DbTable</span>(tableName = <span class="string">"tb_user"</span>, primaryKey = <span class="string">"id"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDto</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 主键</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 密码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String userPassword;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 密码盐</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String userSalt;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 手机号</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建人</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@DbColumn</span>(defaultValue = <span class="string">"'test-user'"</span>)</span><br><span class="line">    <span class="keyword">private</span> String createUser;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@DbColumn</span>(ignoredInsert = <span class="keyword">true</span>)</span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新人</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@DbColumn</span>(defaultValue = <span class="string">"'test-user'"</span>)</span><br><span class="line">    <span class="keyword">private</span> String updateUser;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@DbColumn</span>(ignoredUpdate = <span class="keyword">true</span>, ignoredInsert = <span class="keyword">true</span>)</span><br><span class="line">    <span class="keyword">private</span> Date updateTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2、使用 spring 注入，然后调用即可</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> DbUtil dbUtil;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDbUtilBatchInsertUser</span><span class="params">(<span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">long</span> t1 = System.currentTimeMillis();</span><br><span class="line">    dbUtil.batchInsert(getUserList(count));</span><br><span class="line">    System.out.println(<span class="string">"【DbUtil】插入条数：【"</span> + count + <span class="string">"】耗时：【"</span></span><br><span class="line">            + (System.currentTimeMillis() - t1) + <span class="string">"】"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h4><p>到此，使用 JdbcTemplate 来 batch 写入数据的实现就介绍完了，后续继续其他方式的批量写入 …</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h4&gt;&lt;p&gt;后台开发中，批量往数据库写数据是一个很常见的功能，下面就简单实现一下使用 JdbcTemplate 来 batch 写入。&lt;/p&gt;
&lt;h4 
      
    
    </summary>
    
      <category term="java" scheme="http://blog.ymlsfly.xin/categories/java/"/>
    
      <category term="mysql" scheme="http://blog.ymlsfly.xin/categories/java/mysql/"/>
    
    
      <category term="java" scheme="http://blog.ymlsfly.xin/tags/java/"/>
    
      <category term="batchInsert" scheme="http://blog.ymlsfly.xin/tags/batchInsert/"/>
    
  </entry>
  
  <entry>
    <title>batch-insert-dynamic-sql</title>
    <link href="http://blog.ymlsfly.xin/2023/04/22/batch-insert-dynamic/"/>
    <id>http://blog.ymlsfly.xin/2023/04/22/batch-insert-dynamic/</id>
    <published>2023-04-22T03:40:22.000Z</published>
    <updated>2023-04-22T02:51:44.943Z</updated>
    
    <content type="html"><![CDATA[<h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>后台开发中，批量往数据库写数据是一个很常见的功能，下面就简单实现一下使用 dynamic-sql 来 batch 写入。</p><h4 id="实现介绍"><a href="#实现介绍" class="headerlink" title="实现介绍"></a>实现介绍</h4><h5 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h5><p>在项目的 pom.xml 中配置 dynamic-sql 及 mysql 相关的依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.46<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.dynamic-sql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-dynamic-sql<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="Mapper-接口"><a href="#Mapper-接口" class="headerlink" title="Mapper 接口"></a>Mapper 接口</h5><p>新建一个 Mapper 接口，并继承 org.mybatis.dynamic.sql.util.mybatis3.CommonInsertMapper</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.jack.entity.User;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.dynamic.sql.util.mybatis3.CommonInsertMapper;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *  Mapper 接口</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jack</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDynamicMapper</span> <span class="keyword">extends</span> <span class="title">CommonInsertMapper</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="逻辑实现类"><a href="#逻辑实现类" class="headerlink" title="逻辑实现类"></a>逻辑实现类</h5><p>批量新增逻辑的实现类，需加入 spring 管理</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.jack.entity.User;</span><br><span class="line"><span class="keyword">import</span> com.jack.mapper.UserDynamicMapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.ExecutorType;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.dynamic.sql.SqlColumn;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.dynamic.sql.SqlTable;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.dynamic.sql.insert.BatchInsertModel;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.dynamic.sql.insert.render.BatchInsert;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.dynamic.sql.render.RenderingStrategies;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.dynamic.sql.util.AbstractColumnMapping;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.dynamic.sql.util.PropertyMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Description：通过 dynamic-sql 来 batch insert</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jack</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DynamicBatchInsertMapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SqlSessionFactory sqlSessionFactory;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">batchInsert</span><span class="params">(List&lt;User&gt; list)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> (</span><br><span class="line">                SqlSession session = sqlSessionFactory.openSession(ExecutorType.BATCH)</span><br><span class="line">                ) &#123;</span><br><span class="line">            UserDynamicMapper mapper = session.getMapper(UserDynamicMapper.class);</span><br><span class="line">            SqlTable sqlTable = SqlTable.of(<span class="string">"tb_user"</span>);</span><br><span class="line">            List&lt;AbstractColumnMapping&gt; columnMappingList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            Field[] fields = User.class.getDeclaredFields();</span><br><span class="line">            <span class="keyword">for</span> (Field field : fields) &#123;</span><br><span class="line">                String fieldName = field.getName();</span><br><span class="line">                <span class="keyword">if</span> (<span class="string">"serialVersionUID"</span>.equals(fieldName)) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                columnMappingList.add(PropertyMapping.of(SqlColumn.of(</span><br><span class="line">                        transUpper2Under(fieldName), sqlTable), fieldName));</span><br><span class="line">            &#125;</span><br><span class="line">            BatchInsert&lt;User&gt; batchInsert = BatchInsertModel.withRecords(list)</span><br><span class="line">                    .withTable(sqlTable)</span><br><span class="line">                    .withColumnMappings(columnMappingList)</span><br><span class="line">                    .build()</span><br><span class="line">                    .render(RenderingStrategies.MYBATIS3);</span><br><span class="line">            batchInsert.insertStatements().forEach(mapper::insert);</span><br><span class="line">            session.commit();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 驼峰转下划线</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> jack</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> src 原字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> java.lang.String</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">transUpper2Under</span><span class="params">(String src)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (src == <span class="keyword">null</span> || <span class="string">""</span>.equals(src.trim())) &#123;</span><br><span class="line">            <span class="keyword">return</span> src;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">char</span>[] arr = src.toCharArray();</span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder(src.length());</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">char</span> c : arr) &#123;</span><br><span class="line">            <span class="keyword">if</span> (Character.isUpperCase(c)) &#123;</span><br><span class="line">                sb.append(<span class="string">'_'</span>).append(Character.toLowerCase(c));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                sb.append(c);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h5><p>使用 spring 注入，然后调用即可</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> DynamicBatchInsertMapper dynamicBatchInsertMapper;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDynamicBatchInsertUser</span><span class="params">(<span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">long</span> t1 = System.currentTimeMillis();</span><br><span class="line">    dynamicBatchInsertMapper.batchInsert(getUserList(count));</span><br><span class="line">    System.out.println(<span class="string">"【DynamicBatchInsertMapper】插入条数：【"</span> + count + <span class="string">"】耗时：【"</span></span><br><span class="line">            + (System.currentTimeMillis() - t1) + <span class="string">"】"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h4><p>到此，使用 dynamic-sql 来 batch 写入数据的实现就介绍完了，后续继续其他方式的批量写入 …</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h4&gt;&lt;p&gt;后台开发中，批量往数据库写数据是一个很常见的功能，下面就简单实现一下使用 dynamic-sql 来 batch 写入。&lt;/p&gt;
&lt;h4 i
      
    
    </summary>
    
      <category term="java" scheme="http://blog.ymlsfly.xin/categories/java/"/>
    
      <category term="mysql" scheme="http://blog.ymlsfly.xin/categories/java/mysql/"/>
    
    
      <category term="java" scheme="http://blog.ymlsfly.xin/tags/java/"/>
    
      <category term="batchInsert" scheme="http://blog.ymlsfly.xin/tags/batchInsert/"/>
    
  </entry>
  
  <entry>
    <title>batch-insert-mybatis</title>
    <link href="http://blog.ymlsfly.xin/2023/04/22/batch-insert-mybatis/"/>
    <id>http://blog.ymlsfly.xin/2023/04/22/batch-insert-mybatis/</id>
    <published>2023-04-22T03:35:22.000Z</published>
    <updated>2023-04-22T02:51:27.327Z</updated>
    
    <content type="html"><![CDATA[<h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>后台开发中，批量往数据库写数据是一个很常见的功能，下面就简单实现一下使用 mybatis 来 batch 写入。</p><h4 id="实现介绍"><a href="#实现介绍" class="headerlink" title="实现介绍"></a>实现介绍</h4><h5 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h5><p>在项目的 pom.xml 中配置 mybatis 及 mysql 相关的依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.46<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="Mapper-接口"><a href="#Mapper-接口" class="headerlink" title="Mapper 接口"></a>Mapper 接口</h5><p>在这个 mapper 的 接口类中添加批量新增的方法。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.jack.entity.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 批量插入用户数据</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> jack</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userList 用户数据列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">batchInsertSelective</span><span class="params">(@Param(<span class="string">"userList"</span>)</span> List&lt;User&gt; userList)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Mapper-xml"><a href="#Mapper-xml" class="headerlink" title="Mapper xml"></a>Mapper xml</h5><p>在这个 mapper 的 xml 中实现批量新增的方法。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"batchInsertSelective"</span> <span class="attr">parameterType</span>=<span class="string">"java.util.List"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"userList"</span> <span class="attr">item</span>=<span class="string">"user"</span> <span class="attr">index</span>=<span class="string">"index"</span> <span class="attr">separator</span>=<span class="string">";"</span>&gt;</span></span><br><span class="line">      insert into tb_user</span><br><span class="line">      <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">"("</span> <span class="attr">suffix</span>=<span class="string">")"</span> <span class="attr">suffixOverrides</span>=<span class="string">","</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"user.id != null"</span>&gt;</span></span><br><span class="line">          id,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"user.userName != null"</span>&gt;</span></span><br><span class="line">          user_name,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"user.userPassword != null"</span>&gt;</span></span><br><span class="line">          user_password,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"user.userSalt != null"</span>&gt;</span></span><br><span class="line">          user_salt,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"user.phone != null"</span>&gt;</span></span><br><span class="line">          phone,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"user.createUser != null"</span>&gt;</span></span><br><span class="line">          create_user,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"user.createTime != null"</span>&gt;</span></span><br><span class="line">          create_time,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"user.updateUser != null"</span>&gt;</span></span><br><span class="line">          update_user,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"user.updateTime != null"</span>&gt;</span></span><br><span class="line">          update_time,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">"values ("</span> <span class="attr">suffix</span>=<span class="string">")"</span> <span class="attr">suffixOverrides</span>=<span class="string">","</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"user.id != null"</span>&gt;</span></span><br><span class="line">          #&#123;user.id,jdbcType=VARCHAR&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"user.userName != null"</span>&gt;</span></span><br><span class="line">          #&#123;user.userName,jdbcType=CHAR&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"user.userPassword != null"</span>&gt;</span></span><br><span class="line">          #&#123;user.userPassword,jdbcType=VARCHAR&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"user.userSalt != null"</span>&gt;</span></span><br><span class="line">          #&#123;user.userSalt,jdbcType=VARCHAR&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"user.phone != null"</span>&gt;</span></span><br><span class="line">          #&#123;user.phone,jdbcType=VARCHAR&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"user.createUser != null"</span>&gt;</span></span><br><span class="line">          #&#123;user.createUser,jdbcType=VARCHAR&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"user.createTime!= null"</span>&gt;</span></span><br><span class="line">          #&#123;user.createTime,jdbcType=VARCHAR&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"user.updateUser!= null"</span>&gt;</span></span><br><span class="line">          #&#123;user.updateUser,jdbcType=VARCHAR&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"user.updateTime!= null"</span>&gt;</span></span><br><span class="line">          #&#123;user.updateTime,jdbcType=TIMESTAMP&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h5><p>使用 spring 注入，然后调用即可</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMybatisBatchInsertUser</span><span class="params">(<span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">long</span> t1 = System.currentTimeMillis();</span><br><span class="line">    userMapper.batchInsertSelective(getUserList(count));</span><br><span class="line">    System.out.println(<span class="string">"【mybatis-batch】插入条数：【"</span> + count + <span class="string">"】耗时：【"</span></span><br><span class="line">            + (System.currentTimeMillis() - t1) + <span class="string">"】"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h4><p>到此，使用 mybatis 来 batch 写入数据的实现就介绍完了，后续继续其他方式的批量写入 …</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h4&gt;&lt;p&gt;后台开发中，批量往数据库写数据是一个很常见的功能，下面就简单实现一下使用 mybatis 来 batch 写入。&lt;/p&gt;
&lt;h4 id=&quot;实
      
    
    </summary>
    
      <category term="java" scheme="http://blog.ymlsfly.xin/categories/java/"/>
    
      <category term="mysql" scheme="http://blog.ymlsfly.xin/categories/java/mysql/"/>
    
    
      <category term="java" scheme="http://blog.ymlsfly.xin/tags/java/"/>
    
      <category term="batchInsert" scheme="http://blog.ymlsfly.xin/tags/batchInsert/"/>
    
  </entry>
  
  <entry>
    <title>batch-insert-mybatis-plus</title>
    <link href="http://blog.ymlsfly.xin/2023/04/22/batch-insert-mybatis-plus/"/>
    <id>http://blog.ymlsfly.xin/2023/04/22/batch-insert-mybatis-plus/</id>
    <published>2023-04-22T03:30:22.000Z</published>
    <updated>2023-04-22T02:51:10.262Z</updated>
    
    <content type="html"><![CDATA[<h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>后台开发中，批量往数据库写数据是一个很常见的功能，下面就简单实现一下使用 mybatis-plus 来 batch 写入。</p><h4 id="实现介绍"><a href="#实现介绍" class="headerlink" title="实现介绍"></a>实现介绍</h4><h5 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h5><p>在项目的 pom.xml 中配置 mybatis-plus 以及 mysql 相关的依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.46<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.3.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="实现自定义的-mybatis-plus-方法"><a href="#实现自定义的-mybatis-plus-方法" class="headerlink" title="实现自定义的 mybatis-plus 方法"></a>实现自定义的 mybatis-plus 方法</h5><p>1、实现自定义的 mybatis-plus 方法 batchInsert。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.injector.AbstractMethod;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.metadata.TableInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.executor.keygen.NoKeyGenerator;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.mapping.MappedStatement;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.mapping.SqlSource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicBoolean;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Description：批量新增，要求所有非空字段必须有设置值</span></span><br><span class="line"><span class="comment"> *      参数：java.util.List&lt;?&gt; dataList</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> fy</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoBatchInsertMethod</span> <span class="keyword">extends</span> <span class="title">AbstractMethod</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">5592924141208308506L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MappedStatement <span class="title">injectMappedStatement</span><span class="params">(Class&lt;?&gt; mapperClass, Class&lt;?&gt; modelClass,</span></span></span><br><span class="line"><span class="function"><span class="params">                                                 TableInfo tableInfo)</span> </span>&#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * &lt;p&gt;</span></span><br><span class="line"><span class="comment">         * INSERT INTO tableName</span></span><br><span class="line"><span class="comment">         *      (id,name)</span></span><br><span class="line"><span class="comment">         * VALUES</span></span><br><span class="line"><span class="comment">         *   &lt;foreach collection="dataList" item="data" open="(" close=")" index="index" separator="),("&gt;</span></span><br><span class="line"><span class="comment">         *       #&#123;data.id&#125;,#&#123;data.name&#125;</span></span><br><span class="line"><span class="comment">         *   &lt;/foreach&gt;</span></span><br><span class="line"><span class="comment">         * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        String sql = <span class="string">"&lt;script&gt;\nINSERT INTO %s %s \nVALUES %s\n&lt;/script&gt;"</span>;</span><br><span class="line">        sql = String.format(sql, tableInfo.getTableName(),</span><br><span class="line">                getFieldSql(tableInfo), getValueSql(tableInfo));</span><br><span class="line">        SqlSource sqlSource = languageDriver.createSqlSource(configuration, sql, modelClass);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.addInsertMappedStatement(mapperClass, modelClass,</span><br><span class="line">                <span class="string">"insertBatchDemo"</span>, sqlSource, <span class="keyword">new</span> NoKeyGenerator(),</span><br><span class="line">                tableInfo.getKeyProperty(), tableInfo.getKeyColumn());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getFieldSql</span><span class="params">(TableInfo tableInfo)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"("</span> + tableInfo.getAllSqlSelect() + <span class="string">")"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getValueSql</span><span class="params">(TableInfo tableInfo)</span> </span>&#123;</span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        sb.append(<span class="string">"&lt;foreach collection=\"dataList\" item=\"data\" open=\"(\" close=\")\""</span> +</span><br><span class="line">                <span class="string">" index=\"index\" separator=\"),(\"&gt;\n"</span>);</span><br><span class="line">        sb.append(<span class="string">"#&#123;data."</span>).append(tableInfo.getKeyProperty()).append(<span class="string">"&#125;,"</span>);</span><br><span class="line">        AtomicBoolean isNotFirst = <span class="keyword">new</span> AtomicBoolean(<span class="keyword">false</span>);</span><br><span class="line">        tableInfo.getFieldList().forEach(field -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (isNotFirst.get()) &#123;</span><br><span class="line">                sb.append(<span class="string">","</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            sb.append(<span class="string">"#&#123;data."</span>).append(field.getProperty()).append(<span class="string">"&#125;"</span>);</span><br><span class="line">            isNotFirst.set(<span class="keyword">true</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        sb.append(<span class="string">"\n&lt;/foreach&gt;"</span>);</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2、实现自定义的 mybatis-plus 方法 batchInsertSelective。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.injector.AbstractMethod;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.metadata.TableInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.executor.keygen.NoKeyGenerator;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.mapping.MappedStatement;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.mapping.SqlSource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicBoolean;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Description：批量新增，只插入传入值的字段</span></span><br><span class="line"><span class="comment"> *      参数：java.util.List&lt;?&gt; dataList</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> fy</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoBatchInsertSelectiveMethod</span> <span class="keyword">extends</span> <span class="title">AbstractMethod</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">5592924141208308506L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MappedStatement <span class="title">injectMappedStatement</span><span class="params">(Class&lt;?&gt; mapperClass, Class&lt;?&gt; modelClass,</span></span></span><br><span class="line"><span class="function"><span class="params">                                                 TableInfo tableInfo)</span> </span>&#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * &lt;p&gt;</span></span><br><span class="line"><span class="comment">         * &lt;foreach collection="dataList" item="data" index="index" separator=";"&gt;</span></span><br><span class="line"><span class="comment">         *      INSERT INTO tableName</span></span><br><span class="line"><span class="comment">         *        &lt;trim prefix="(" suffix=")" suffixOverrides=","&gt;</span></span><br><span class="line"><span class="comment">         *          &lt;if test="data.id != null"&gt;</span></span><br><span class="line"><span class="comment">         *              id,</span></span><br><span class="line"><span class="comment">         *          &lt;/if&gt;</span></span><br><span class="line"><span class="comment">         *          &lt;if test="data.name != null"&gt;</span></span><br><span class="line"><span class="comment">         *              name,</span></span><br><span class="line"><span class="comment">         *          &lt;/if&gt;</span></span><br><span class="line"><span class="comment">         *        &lt;/trim&gt;</span></span><br><span class="line"><span class="comment">         *      VALUES</span></span><br><span class="line"><span class="comment">         *        &lt;trim prefix="(" suffix=")" suffixOverrides=","&gt;</span></span><br><span class="line"><span class="comment">         *          &lt;if test="data.id != null"&gt;</span></span><br><span class="line"><span class="comment">         *              #&#123;data.id&#125;,</span></span><br><span class="line"><span class="comment">         *          &lt;/if&gt;</span></span><br><span class="line"><span class="comment">         *          &lt;if test="data.name != null"&gt;</span></span><br><span class="line"><span class="comment">         *              #&#123;data.name&#125;,</span></span><br><span class="line"><span class="comment">         *          &lt;/if&gt;</span></span><br><span class="line"><span class="comment">         *        &lt;/trim&gt;</span></span><br><span class="line"><span class="comment">         * &lt;/foreach&gt;</span></span><br><span class="line"><span class="comment">         * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        String sql = <span class="string">"&lt;script&gt;\n&lt;foreach collection=\"dataList\" item=\"data\""</span> +</span><br><span class="line">                <span class="string">" index=\"index\" separator=\";\"&gt;\n"</span> +</span><br><span class="line">                <span class="string">"INSERT INTO %s %s VALUES %s \n"</span> +</span><br><span class="line">                <span class="string">"&lt;/foreach&gt;\n&lt;/script&gt;"</span>;</span><br><span class="line">        sql = String.format(sql, tableInfo.getTableName(),</span><br><span class="line">                getFieldSql(tableInfo), getValueSql(tableInfo));</span><br><span class="line">        SqlSource sqlSource = languageDriver.createSqlSource(configuration, sql, modelClass);</span><br><span class="line">        <span class="comment">// NoKeyGenerator：默认空实现，不需要对主键单独处理；</span></span><br><span class="line">        <span class="comment">// Jdbc3KeyGenerator：主要用于数据库的自增主键，比如 MySQL、PostgreSQL；</span></span><br><span class="line">        <span class="comment">// SelectKeyGenerator：主要用于数据库不支持自增主键的情况，比如 Oracle、DB2；</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.addInsertMappedStatement(mapperClass, modelClass,</span><br><span class="line">                <span class="string">"insertBatchSelectiveDemo"</span>, sqlSource, <span class="keyword">new</span> NoKeyGenerator(),</span><br><span class="line">                tableInfo.getKeyProperty(), tableInfo.getKeyColumn());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getFieldSql</span><span class="params">(TableInfo tableInfo)</span> </span>&#123;</span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        sb.append(<span class="string">"&lt;trim prefix=\"(\" suffix=\")\" suffixOverrides=\",\"&gt;"</span>);</span><br><span class="line">        sb.append(<span class="string">"&lt;if test=\"data."</span>).append(tableInfo.getKeyProperty())</span><br><span class="line">                .append(<span class="string">" != null\"&gt;"</span>).append(tableInfo.getKeyColumn())</span><br><span class="line">                .append(<span class="string">",&lt;/if&gt;"</span>);</span><br><span class="line">        tableInfo.getFieldList().forEach(field -&gt;</span><br><span class="line">            sb.append(<span class="string">"&lt;if test=\"data."</span>).append(field.getProperty())</span><br><span class="line">                    .append(<span class="string">" != null\"&gt;"</span>).append(field.getColumn())</span><br><span class="line">                    .append(<span class="string">",&lt;/if&gt;"</span>)</span><br><span class="line">        );</span><br><span class="line">        sb.append(<span class="string">"&lt;/trim&gt;"</span>);</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getValueSql</span><span class="params">(TableInfo tableInfo)</span> </span>&#123;</span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        sb.append(<span class="string">"&lt;trim prefix=\"(\" suffix=\")\" suffixOverrides=\",\"&gt;"</span>);</span><br><span class="line">        sb.append(<span class="string">"&lt;if test=\"data."</span>).append(tableInfo.getKeyProperty())</span><br><span class="line">                .append(<span class="string">" != null\"&gt;#&#123;data."</span>).append(tableInfo.getKeyProperty())</span><br><span class="line">                .append(<span class="string">"&#125;,&lt;/if&gt;"</span>);</span><br><span class="line">        tableInfo.getFieldList().forEach(field -&gt;</span><br><span class="line">                sb.append(<span class="string">"&lt;if test=\"data."</span>).append(field.getProperty())</span><br><span class="line">                        .append(<span class="string">" != null\"&gt;#&#123;data."</span>).append(field.getProperty())</span><br><span class="line">                        .append(<span class="string">"&#125;,&lt;/if&gt;"</span>)</span><br><span class="line">        );</span><br><span class="line">        sb.append(<span class="string">"&lt;/trim&gt;"</span>);</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="将自定义的方法注入到-mp-的管理器中"><a href="#将自定义的方法注入到-mp-的管理器中" class="headerlink" title="将自定义的方法注入到 mp 的管理器中"></a>将自定义的方法注入到 mp 的管理器中</h5><p>将自定义的 batchInsert 及 batchInsertSelective，两个方法加入到 mp 的管理器。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.injector.AbstractMethod;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.injector.DefaultSqlInjector;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.metadata.TableInfo;</span><br><span class="line"><span class="keyword">import</span> com.fy.config.mybatis.plus.method.DemoBatchInsertMethod;</span><br><span class="line"><span class="keyword">import</span> com.fy.config.mybatis.plus.method.DemoBatchInsertSelectiveMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Description：自定义 sql 注入器</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> fy</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomizedSqlInjector</span> <span class="keyword">extends</span> <span class="title">DefaultSqlInjector</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;AbstractMethod&gt; <span class="title">getMethodList</span><span class="params">(Class&lt;?&gt; mapperClass, TableInfo tableInfo)</span> </span>&#123;</span><br><span class="line">        List&lt;AbstractMethod&gt; methodList = <span class="keyword">super</span>.getMethodList(mapperClass, tableInfo);</span><br><span class="line">        methodList.add(<span class="keyword">new</span> DemoBatchInsertMethod());</span><br><span class="line">        methodList.add(<span class="keyword">new</span> DemoBatchInsertSelectiveMethod());</span><br><span class="line">        <span class="keyword">return</span> methodList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="定义自己的顶层-mapper"><a href="#定义自己的顶层-mapper" class="headerlink" title="定义自己的顶层 mapper"></a>定义自己的顶层 mapper</h5><p>自定一个 RootMapper，保留对 mp 的 BaseMapper 的传递，在该 mapper 中定义刚刚的两个方法。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Description：自定义顶层 Mapper</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> fy</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">RootMapper</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 自定义的批量新增方法</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> fy</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dataList 数据列表</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> int</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insertBatchDemo</span><span class="params">(@Param(<span class="string">"dataList"</span>)</span> List&lt;E&gt; dataList)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 自定义的批量新增方法</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> fy</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dataList 数据列表</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> int</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insertBatchSelectiveDemo</span><span class="params">(@Param(<span class="string">"dataList"</span>)</span> List&lt;E&gt; dataList)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="继承自定义顶层-mapper"><a href="#继承自定义顶层-mapper" class="headerlink" title="继承自定义顶层 mapper"></a>继承自定义顶层 mapper</h5><p>在需要批量操作的 mapper 上改成继承自定义的 RootMapper。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.fy.entity.User;</span><br><span class="line"><span class="keyword">import</span> com.fy.config.mybatis.plus.method.bean.RootMapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *  Mapper 接口</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> fy</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> <span class="keyword">extends</span> <span class="title">RootMapper</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h5><p>使用 spring 注入，然后调用即可</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMybatisPlusBatchInsertUser</span><span class="params">(<span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">long</span> t1 = System.currentTimeMillis();</span><br><span class="line">    userMapper.insertBatchDemo(getUserList(count));</span><br><span class="line">    System.out.println(<span class="string">"【mybatis-plus】插入条数：【"</span> + count + <span class="string">"】耗时：【"</span></span><br><span class="line">            + (System.currentTimeMillis() - t1) + <span class="string">"】"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h4><p>到此，使用 mybatis-plus 来 batch 写入数据的实现就介绍完了，后续继续其他方式的批量写入 …</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h4&gt;&lt;p&gt;后台开发中，批量往数据库写数据是一个很常见的功能，下面就简单实现一下使用 mybatis-plus 来 batch 写入。&lt;/p&gt;
&lt;h4 
      
    
    </summary>
    
      <category term="java" scheme="http://blog.ymlsfly.xin/categories/java/"/>
    
      <category term="mysql" scheme="http://blog.ymlsfly.xin/categories/java/mysql/"/>
    
    
      <category term="java" scheme="http://blog.ymlsfly.xin/tags/java/"/>
    
      <category term="batchInsert" scheme="http://blog.ymlsfly.xin/tags/batchInsert/"/>
    
  </entry>
  
  <entry>
    <title>batch-insert-mybatis-provider</title>
    <link href="http://blog.ymlsfly.xin/2023/04/22/batch-insert-mybatis-provider/"/>
    <id>http://blog.ymlsfly.xin/2023/04/22/batch-insert-mybatis-provider/</id>
    <published>2023-04-22T03:25:22.000Z</published>
    <updated>2023-04-22T02:50:50.830Z</updated>
    
    <content type="html"><![CDATA[<h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>后台开发中，批量往数据库写数据是一个很常见的功能，下面就简单实现一下使用 mybatis-provider 来 batch 写入。</p><h4 id="实现介绍"><a href="#实现介绍" class="headerlink" title="实现介绍"></a>实现介绍</h4><h5 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h5><p>在项目的 pom.xml 中配置 mybatis 及 mysql 相关的依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.46<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="provider-逻辑实现类"><a href="#provider-逻辑实现类" class="headerlink" title="provider 逻辑实现类"></a>provider 逻辑实现类</h5><p>新建一个 provider 类，用于实现 batch insert 的逻辑。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.fy.entity.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Description：batch insert 的 provider 实现</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> fy</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserProvider</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">batchInsert</span><span class="params">(List&lt;User&gt; list)</span> </span>&#123;</span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder(<span class="string">"INSERT INTO tb_user (id,user_name,user_password,"</span> +</span><br><span class="line">                <span class="string">"user_salt,phone,create_user,update_user) VALUES"</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; list.size(); i++) &#123;</span><br><span class="line">            User user = list.get(i);</span><br><span class="line">            <span class="keyword">if</span> (i &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                sb.append(<span class="string">","</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            sb.append(<span class="string">"("</span>);</span><br><span class="line">            sb.append(<span class="string">"'"</span>).append(user.getId()).append(<span class="string">"',"</span>);</span><br><span class="line">            sb.append(<span class="string">"'"</span>).append(user.getUserName()).append(<span class="string">"',"</span>);</span><br><span class="line">            sb.append(<span class="string">"'"</span>).append(user.getUserPassword()).append(<span class="string">"',"</span>);</span><br><span class="line">            sb.append(<span class="string">"'"</span>).append(user.getUserSalt()).append(<span class="string">"',"</span>);</span><br><span class="line">            sb.append(<span class="string">"'"</span>).append(user.getPhone()).append(<span class="string">"',"</span>);</span><br><span class="line">            sb.append(<span class="string">"'"</span>).append(user.getCreateUser()).append(<span class="string">"',"</span>);</span><br><span class="line">            sb.append(<span class="string">"'"</span>).append(user.getUpdateUser()).append(<span class="string">"'"</span>);</span><br><span class="line">            sb.append(<span class="string">")"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        sb.append(<span class="string">";"</span>);</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="mapper-接口类"><a href="#mapper-接口类" class="headerlink" title="mapper 接口类"></a>mapper 接口类</h5><p>在该表的 mapper 接口类中，绑定上刚刚的 provider。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.fy.entity.User;</span><br><span class="line"><span class="keyword">import</span> com.fy.service.provider.UserProvider;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.InsertProvider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *  Mapper 接口</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> fy</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 批量插入数据，通过 InsertProvider 方式</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> fy</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> list 数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@InsertProvider</span>(type = UserProvider.class, method = <span class="string">"batchInsert"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">batchInsertByProvider</span><span class="params">(List&lt;User&gt; list)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h5><p>使用 spring 注入 mapper，然后调用即可。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testProviderBatchInsertUser</span><span class="params">(<span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">long</span> t1 = System.currentTimeMillis();</span><br><span class="line">    userMapper.batchInsertByProvider(getUserList(count));</span><br><span class="line">    System.out.println(<span class="string">"【UserMapper-provider】插入条数：【"</span> + count + <span class="string">"】耗时：【"</span></span><br><span class="line">            + (System.currentTimeMillis() - t1) + <span class="string">"】"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h4><p>到此，使用 mybatis-provider 来 batch 写入数据的实现就介绍完了，后续继续其他方式的批量写入 …</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h4&gt;&lt;p&gt;后台开发中，批量往数据库写数据是一个很常见的功能，下面就简单实现一下使用 mybatis-provider 来 batch 写入。&lt;/p&gt;

      
    
    </summary>
    
      <category term="java" scheme="http://blog.ymlsfly.xin/categories/java/"/>
    
      <category term="mysql" scheme="http://blog.ymlsfly.xin/categories/java/mysql/"/>
    
    
      <category term="java" scheme="http://blog.ymlsfly.xin/tags/java/"/>
    
      <category term="batchInsert" scheme="http://blog.ymlsfly.xin/tags/batchInsert/"/>
    
  </entry>
  
  <entry>
    <title>JFreeChart初学习</title>
    <link href="http://blog.ymlsfly.xin/2023/04/22/JFreeChart/"/>
    <id>http://blog.ymlsfly.xin/2023/04/22/JFreeChart/</id>
    <published>2023-04-22T03:20:22.000Z</published>
    <updated>2023-04-22T03:11:52.157Z</updated>
    
    <content type="html"><![CDATA[<h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>JFreeChart是JAVA平台上的一个开放的图表绘制类库，可生成饼图（pie charts）、柱状图（bar charts）、散点图（scatter plots）、时序图（time series）、甘特图（Gantt charts）等等多种图表。</p><p>贴上JFreeChart的git地址：<a href="https://github.com/jfree/jfreechart" target="_blank" rel="noopener">https://github.com/jfree/jfreechart</a></p><p>本文对JFreeChart做一个初步的介绍及使用，博主做了一个简单的封装，拿来即用。</p><h4 id="工具类介绍"><a href="#工具类介绍" class="headerlink" title="工具类介绍"></a>工具类介绍</h4><h5 id="maven-依赖引入"><a href="#maven-依赖引入" class="headerlink" title="maven 依赖引入"></a>maven 依赖引入</h5><p>在项目工程的 pom.xml 中引入 JFreeChart 依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.jfree<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jfreechart<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="chart-配置类"><a href="#chart-配置类" class="headerlink" title="chart 配置类"></a>chart 配置类</h5><p>用于外部配置 chart 配置信息</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.AccessLevel;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Builder;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.Color;</span><br><span class="line"><span class="keyword">import</span> java.awt.Font;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Description：chart 配置信息</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> fy</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span>(access = AccessLevel.PRIVATE)</span><br><span class="line"><span class="meta">@AllArgsConstructor</span>(access = AccessLevel.PRIVATE)</span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChartConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 图标题</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * x 轴</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String labelX;</span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * y 轴</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String labelY;</span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 是否显示图例</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> legend;</span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 采用标准生成器</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> tooltips;</span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 是否生成超链接</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> urls;</span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 标题字体</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Font titleFont;</span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 轴字体</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Font labelFont;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * x 轴是否是 number 类型</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isNumX;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 线条颜色，按数据的设置顺序指定，跳过需指定null</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Color&gt; lineColorList;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 线条粗细，按数据的设置顺序指定，跳过需指定null</span></span><br><span class="line"><span class="comment">     * 默认的粗细为：2.0f</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Float&gt; lineStrokeList;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="chart-数据"><a href="#chart-数据" class="headerlink" title="chart 数据"></a>chart 数据</h5><p>用于外部输入需要绘图的 chart 数据</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Description：chart 数据</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> fy</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChartBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String columnKey;</span><br><span class="line">    <span class="keyword">private</span> Number columnKeyNum;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> val;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ChartBean</span><span class="params">(String columnKey, <span class="keyword">double</span> val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.columnKey = columnKey;</span><br><span class="line">        <span class="keyword">this</span>.val = val;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ChartBean</span><span class="params">(Number columnKeyNum, <span class="keyword">double</span> val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.columnKeyNum = columnKeyNum;</span><br><span class="line">        <span class="keyword">this</span>.val = val;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="逻辑处理工具类"><a href="#逻辑处理工具类" class="headerlink" title="逻辑处理工具类"></a>逻辑处理工具类</h5><p>封装 绘制 JFreeChart 图 的逻辑代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.fy.util.chart.bean.ChartBean;</span><br><span class="line"><span class="keyword">import</span> com.fy.util.chart.bean.ChartConfig;</span><br><span class="line"><span class="keyword">import</span> org.jfree.chart.ChartFactory;</span><br><span class="line"><span class="keyword">import</span> org.jfree.chart.ChartFrame;</span><br><span class="line"><span class="keyword">import</span> org.jfree.chart.JFreeChart;</span><br><span class="line"><span class="keyword">import</span> org.jfree.chart.axis.CategoryAxis;</span><br><span class="line"><span class="keyword">import</span> org.jfree.chart.axis.ValueAxis;</span><br><span class="line"><span class="keyword">import</span> org.jfree.chart.plot.CategoryPlot;</span><br><span class="line"><span class="keyword">import</span> org.jfree.chart.plot.Plot;</span><br><span class="line"><span class="keyword">import</span> org.jfree.chart.plot.PlotOrientation;</span><br><span class="line"><span class="keyword">import</span> org.jfree.chart.plot.XYPlot;</span><br><span class="line"><span class="keyword">import</span> org.jfree.chart.renderer.xy.XYItemRenderer;</span><br><span class="line"><span class="keyword">import</span> org.jfree.data.category.CategoryDataset;</span><br><span class="line"><span class="keyword">import</span> org.jfree.data.category.DefaultCategoryDataset;</span><br><span class="line"><span class="keyword">import</span> org.jfree.data.xy.XYDataset;</span><br><span class="line"><span class="keyword">import</span> org.jfree.data.xy.XYSeries;</span><br><span class="line"><span class="keyword">import</span> org.jfree.data.xy.XYSeriesCollection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.BasicStroke;</span><br><span class="line"><span class="keyword">import</span> java.awt.Color;</span><br><span class="line"><span class="keyword">import</span> java.awt.Font;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Description：JFreeChart 工具类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> fy</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JFreeChartUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 绘制 JFreeChart 图</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> fy</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dataMap 数据信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> config 绘制的配置信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">makeJFreeChart</span><span class="params">(Map&lt;String, List&lt;ChartBean&gt;&gt; dataMap,</span></span></span><br><span class="line"><span class="function"><span class="params">                                      ChartConfig config)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> isNumX = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (config != <span class="keyword">null</span>) &#123;</span><br><span class="line">            isNumX = config.isNumX();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (isNumX) &#123;</span><br><span class="line">            doMakeJFreeChartNum(dataMap, config);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            doMakeJFreeChart(dataMap, config);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">doMakeJFreeChart</span><span class="params">(Map&lt;String, List&lt;ChartBean&gt;&gt; dataMap,</span></span></span><br><span class="line"><span class="function"><span class="params">                                        ChartConfig config)</span> </span>&#123;</span><br><span class="line">        DefaultCategoryDataset dataset = <span class="keyword">new</span> DefaultCategoryDataset();</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, List&lt;ChartBean&gt;&gt; entry : dataMap.entrySet()) &#123;</span><br><span class="line">            String rowKey = entry.getKey();</span><br><span class="line">            List&lt;ChartBean&gt; list = entry.getValue();</span><br><span class="line">            <span class="keyword">for</span> (ChartBean chartBean : list) &#123;</span><br><span class="line">                dataset.addValue(chartBean.getVal(), rowKey, chartBean.getColumnKey());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        JFreeChart jFreeChart = buildLineChart(config, dataset);</span><br><span class="line">        CategoryPlot plot = (CategoryPlot)jFreeChart.getPlot();</span><br><span class="line">        <span class="comment">// 设置轴字体</span></span><br><span class="line">        <span class="comment">// X 轴</span></span><br><span class="line">        CategoryAxis domainAxis = plot.getDomainAxis();</span><br><span class="line">        <span class="comment">// Y 轴</span></span><br><span class="line">        ValueAxis rangeAxis = plot.getRangeAxis();</span><br><span class="line">        Font labelFont = config.getLabelFont();</span><br><span class="line">        <span class="keyword">if</span> (labelFont != <span class="keyword">null</span>) &#123;</span><br><span class="line">            domainAxis.setLabelFont(labelFont);</span><br><span class="line">            rangeAxis.setLabelFont(labelFont);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 背景底部横虚线</span></span><br><span class="line">        plot.setRangeGridlinePaint(Color.BLUE);</span><br><span class="line">        <span class="comment">// 设置是否显示水平方向背景线,默认值为 true</span></span><br><span class="line">        plot.setRangeGridlinesVisible(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">// 设置是否显示垂直方向背景线,默认值为 false</span></span><br><span class="line">        plot.setDomainGridlinesVisible(<span class="keyword">true</span>);</span><br><span class="line">        showPlot(plot, jFreeChart, config.getTitle());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">doMakeJFreeChartNum</span><span class="params">(Map&lt;String, List&lt;ChartBean&gt;&gt; dataMap,</span></span></span><br><span class="line"><span class="function"><span class="params">                                            ChartConfig config)</span> </span>&#123;</span><br><span class="line">        XYSeriesCollection collection = <span class="keyword">new</span> XYSeriesCollection();</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, List&lt;ChartBean&gt;&gt; entry : dataMap.entrySet()) &#123;</span><br><span class="line">            XYSeries xySeries = <span class="keyword">new</span> XYSeries(entry.getKey());</span><br><span class="line">            List&lt;ChartBean&gt; list = entry.getValue();</span><br><span class="line">            <span class="keyword">for</span> (ChartBean chartBean : list) &#123;</span><br><span class="line">                xySeries.add(chartBean.getColumnKeyNum(), chartBean.getVal());</span><br><span class="line">            &#125;</span><br><span class="line">            collection.addSeries(xySeries);</span><br><span class="line">        &#125;</span><br><span class="line">        JFreeChart jFreeChart = buildXYLineChart(config, collection);</span><br><span class="line">        XYPlot plot = (XYPlot) jFreeChart.getPlot();</span><br><span class="line">        <span class="comment">// 设置轴字体</span></span><br><span class="line">        <span class="comment">// X 轴</span></span><br><span class="line">        ValueAxis domainAxis = plot.getDomainAxis();</span><br><span class="line">        <span class="comment">// Y 轴</span></span><br><span class="line">        ValueAxis rangeAxis = plot.getRangeAxis();</span><br><span class="line">        Font labelFont = config.getLabelFont();</span><br><span class="line">        <span class="keyword">if</span> (labelFont != <span class="keyword">null</span>) &#123;</span><br><span class="line">            domainAxis.setLabelFont(labelFont);</span><br><span class="line">            rangeAxis.setLabelFont(labelFont);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 背景底部横虚线</span></span><br><span class="line">        plot.setRangeGridlinePaint(Color.BLUE);</span><br><span class="line">        <span class="comment">// 设置是否显示水平方向背景线,默认值为 true</span></span><br><span class="line">        plot.setRangeGridlinesVisible(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">// 设置是否显示垂直方向背景线,默认值为 false</span></span><br><span class="line">        plot.setDomainGridlinesVisible(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置数据线条颜色及粗细</span></span><br><span class="line">        buildLineColorAndStroke(plot, config);</span><br><span class="line"></span><br><span class="line">        showPlot(plot, jFreeChart, config.getTitle());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">buildLineColorAndStroke</span><span class="params">(XYPlot plot, ChartConfig config)</span> </span>&#123;</span><br><span class="line">        XYItemRenderer renderer = plot.getRenderer();</span><br><span class="line">        List&lt;Color&gt; lineColorList = config.getLineColorList();</span><br><span class="line">        <span class="keyword">if</span> (lineColorList != <span class="keyword">null</span> &amp;&amp; lineColorList.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; lineColorList.size(); i++) &#123;</span><br><span class="line">                Color color = lineColorList.get(i);</span><br><span class="line">                <span class="keyword">if</span> (color != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    renderer.setSeriesPaint(i, color);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;Float&gt; lineStrokeList = config.getLineStrokeList();</span><br><span class="line">        <span class="keyword">if</span> (lineStrokeList != <span class="keyword">null</span> &amp;&amp; lineStrokeList.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; lineStrokeList.size(); i++) &#123;</span><br><span class="line">                Float stoke = lineStrokeList.get(i);</span><br><span class="line">                <span class="keyword">if</span> (stoke != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    renderer.setSeriesStroke(i, <span class="keyword">new</span> BasicStroke(stoke));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">showPlot</span><span class="params">(Plot plot, JFreeChart jFreeChart, String title)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 设置背景色</span></span><br><span class="line">        plot.setBackgroundPaint(Color.LIGHT_GRAY);</span><br><span class="line">        <span class="comment">// 边界线</span></span><br><span class="line">        plot.setOutlinePaint(Color.RED);</span><br><span class="line">        plot.setBackgroundAlpha(<span class="number">0.5f</span>);</span><br><span class="line">        plot.setNoDataMessage(<span class="string">"无对应的数据，请检查数据信息！"</span>);</span><br><span class="line">        ChartFrame chartFrame = <span class="keyword">new</span> ChartFrame(title, jFreeChart);</span><br><span class="line">        chartFrame.pack();</span><br><span class="line">        chartFrame.setVisible(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> JFreeChart <span class="title">buildLineChart</span><span class="params">(ChartConfig config, CategoryDataset dataset)</span> </span>&#123;</span><br><span class="line">        JFreeChart jFreeChart = ChartFactory.createLineChart(config.getTitle(),</span><br><span class="line">                config.getLabelX(), config.getLabelY(),</span><br><span class="line">                dataset,</span><br><span class="line">                PlotOrientation.VERTICAL,</span><br><span class="line">                <span class="comment">// 是否显示图例</span></span><br><span class="line">                config.isLegend(),</span><br><span class="line">                <span class="comment">// 采用标准生成器</span></span><br><span class="line">                config.isTooltips(),</span><br><span class="line">                <span class="comment">// 是否生成超链接</span></span><br><span class="line">                config.isUrls());</span><br><span class="line"></span><br><span class="line">        Font titleFont = config.getTitleFont();</span><br><span class="line">        <span class="keyword">if</span> (titleFont != <span class="keyword">null</span>) &#123;</span><br><span class="line">            jFreeChart.getTitle().setFont(titleFont);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> jFreeChart;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> JFreeChart <span class="title">buildXYLineChart</span><span class="params">(ChartConfig config, XYDataset xyDataset)</span> </span>&#123;</span><br><span class="line">        JFreeChart jFreeChart = ChartFactory.createXYLineChart(config.getTitle(),</span><br><span class="line">                config.getLabelX(), config.getLabelY(),</span><br><span class="line">                xyDataset,</span><br><span class="line">                PlotOrientation.VERTICAL,</span><br><span class="line">                <span class="comment">// 是否显示图例</span></span><br><span class="line">                config.isLegend(),</span><br><span class="line">                <span class="comment">// 采用标准生成器</span></span><br><span class="line">                config.isTooltips(),</span><br><span class="line">                <span class="comment">// 是否生成超链接</span></span><br><span class="line">                config.isUrls());</span><br><span class="line"></span><br><span class="line">        Font titleFont = config.getTitleFont();</span><br><span class="line">        <span class="keyword">if</span> (titleFont != <span class="keyword">null</span>) &#123;</span><br><span class="line">            jFreeChart.getTitle().setFont(titleFont);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> jFreeChart;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="工具类使用"><a href="#工具类使用" class="headerlink" title="工具类使用"></a>工具类使用</h5><p>指定需要的配置，输入数据源信息，简单调用即可绘制，下面用简单的数据做示例</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">ChartConfig config = ChartConfig.builder()</span><br><span class="line">.title(<span class="string">"性能分析"</span>)</span><br><span class="line">.labelX(<span class="string">"数据数量/w条"</span>)</span><br><span class="line">.labelY(<span class="string">"耗时/s"</span>)</span><br><span class="line">.legend(<span class="keyword">true</span>)</span><br><span class="line">.tooltips(<span class="keyword">true</span>)</span><br><span class="line">.titleFont(<span class="keyword">new</span> Font(<span class="string">"宋体"</span>, Font.BOLD, <span class="number">14</span>))</span><br><span class="line">.labelFont(<span class="keyword">new</span> Font(<span class="string">"宋体"</span>, Font.PLAIN, <span class="number">12</span>))</span><br><span class="line">.isNumX(<span class="keyword">true</span>)</span><br><span class="line">.lineColorList(Arrays.asList(Color.pink, <span class="keyword">null</span>, Color.YELLOW))</span><br><span class="line">.lineStrokeList(Arrays.asList(<span class="number">3f</span>, <span class="number">5f</span>, <span class="number">3f</span>))</span><br><span class="line">.build();</span><br><span class="line">Map&lt;String, List&lt;ChartBean&gt;&gt; dataMap = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">dataMap.put(<span class="string">"ONE"</span>, Arrays.asList(</span><br><span class="line"><span class="keyword">new</span> ChartBean(<span class="number">1</span>, <span class="number">1.6</span>),</span><br><span class="line"><span class="keyword">new</span> ChartBean(<span class="number">80</span>, <span class="number">42</span>),</span><br><span class="line"><span class="keyword">new</span> ChartBean(<span class="number">24</span>, <span class="number">10</span>)));</span><br><span class="line">dataMap.put(<span class="string">"TWO"</span>, Arrays.asList(</span><br><span class="line"><span class="keyword">new</span> ChartBean(<span class="number">1</span>, <span class="number">0.5</span>),</span><br><span class="line"><span class="keyword">new</span> ChartBean(<span class="number">80</span>, <span class="number">34</span>),</span><br><span class="line"><span class="keyword">new</span> ChartBean(<span class="number">24</span>, <span class="number">20</span>)));</span><br><span class="line">dataMap.put(<span class="string">"THREE"</span>, Arrays.asList(</span><br><span class="line"><span class="keyword">new</span> ChartBean(<span class="number">1</span>, <span class="number">1.1</span>),</span><br><span class="line"><span class="keyword">new</span> ChartBean(<span class="number">80</span>, <span class="number">180</span>),</span><br><span class="line"><span class="keyword">new</span> ChartBean(<span class="number">24</span>, <span class="number">18</span>)));</span><br><span class="line">JFreeChartUtil.makeJFreeChart(dataMap, config);</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/1139195320/imgs/master/JFreeChart/1.png" alt=""></p><h4 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h4><p>到此，该简单的工具类就介绍完毕了，可以作为初步的学习及使用，当然，还有更多完善的空间，等待咱们一起完善 loading</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h4&gt;&lt;p&gt;JFreeChart是JAVA平台上的一个开放的图表绘制类库，可生成饼图（pie charts）、柱状图（bar charts）、散点图（s
      
    
    </summary>
    
      <category term="java" scheme="http://blog.ymlsfly.xin/categories/java/"/>
    
      <category term="工具类" scheme="http://blog.ymlsfly.xin/categories/java/%E5%B7%A5%E5%85%B7%E7%B1%BB/"/>
    
    
      <category term="JFreeChart" scheme="http://blog.ymlsfly.xin/tags/JFreeChart/"/>
    
      <category term="工具类" scheme="http://blog.ymlsfly.xin/tags/%E5%B7%A5%E5%85%B7%E7%B1%BB/"/>
    
  </entry>
  
  <entry>
    <title>HashMap-put剖析</title>
    <link href="http://blog.ymlsfly.xin/2023/04/18/hashMap-put/"/>
    <id>http://blog.ymlsfly.xin/2023/04/18/hashMap-put/</id>
    <published>2023-04-18T10:30:28.000Z</published>
    <updated>2023-04-18T10:37:11.511Z</updated>
    
    <content type="html"><![CDATA[<h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>作为一个java开发，我们在代码编程中经常会用到 k-v 键值对类型的容器，而其最常用到的即咱们的 HashMap。</p><p>首先，HashMap是什么呢，大家熟知，HashMap是基于哈希表的Map接口的非同步实现，它允许null键和null值，且HashMap依托于它的数据结构的设计，存储效率特别高，所以被咱们常用。</p><p>HashMap里面采用的数据结构有：数组+单向链表+双向链表+红黑树，不愧是大佬们写的容器类，一个字，牛！</p><p>这篇文章咱们就来剖析下 HashMap 的 put 操作，看看往 HashMap 里面塞数据的时候会经过哪些逻辑。</p><p>注：本文基于Jdk1.8！</p><h4 id="代码剖析"><a href="#代码剖析" class="headerlink" title="代码剖析"></a>代码剖析</h4><h5 id="put-方法"><a href="#put-方法" class="headerlink" title="put 方法"></a>put 方法</h5><p>这是 HashMap 做 put 操作的入口方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 调用putVal方法</span></span><br><span class="line">    <span class="keyword">return</span> putVal(hash(key), key, value, <span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="putVal-方法"><a href="#putVal-方法" class="headerlink" title="putVal 方法"></a>putVal 方法</h5><p>这是 HashMap 塞数据实际的逻辑代码方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Implements Map.put and related methods</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> hash hash for key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key the key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value the value to put</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> onlyIfAbsent if true, don't change existing value</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> evict if false, the table is in creation mode.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> previous value, or null if none</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">boolean</span> onlyIfAbsent,</span></span></span><br><span class="line"><span class="function"><span class="params">               <span class="keyword">boolean</span> evict)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="keyword">int</span> n, i;</span><br><span class="line">    <span class="comment">// 判断元素是不是空了，是的话就resize</span></span><br><span class="line">    <span class="keyword">if</span> ((tab = table) == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">        n = (tab = resize()).length;</span><br><span class="line">    <span class="comment">// 找到了这个hash值所在的链表位置，并发现是空的，创建新链表节点，并放进链表数组</span></span><br><span class="line">    <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="keyword">null</span>)</span><br><span class="line">        tab[i] = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        Node&lt;K,V&gt; e; K k;</span><br><span class="line">        <span class="comment">// 找到了这个hash值所在的链表，且相中了连key也是相同的，则直接进行覆盖</span></span><br><span class="line">        <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">            ((k = p.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            e = p;</span><br><span class="line">        <span class="comment">// 如果这个hash值所在的链表已经是红黑树，则投进去</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">            e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="keyword">this</span>, tab, hash, key, value);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 遍历这个hash值所在的链表，从头到尾寻找相中key也相同的节点</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> binCount = <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((e = p.next) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// 遍历到尾部了还没找到，则插入到尾部新节点</span></span><br><span class="line">                    p.next = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">                    <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st</span></span><br><span class="line">                        <span class="comment">// 如果节点数量到了8，则需要考虑是否转换成红黑树</span></span><br><span class="line">                        treeifyBin(tab, hash);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 找到了这个hash值所在的链表，且相中了连key也是相同的，则直接进行覆盖</span></span><br><span class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                    ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                p = e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 如果原来这个找到的节点位置是有值的，则在覆盖塞入后，返回原值</span></span><br><span class="line">        <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123; <span class="comment">// existing mapping for key</span></span><br><span class="line">            V oldValue = e.value;</span><br><span class="line">            <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="keyword">null</span>)</span><br><span class="line">                e.value = value;</span><br><span class="line">            afterNodeAccess(e);</span><br><span class="line">            <span class="keyword">return</span> oldValue;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 增加一次修改次数记录</span></span><br><span class="line">    ++modCount;</span><br><span class="line">    <span class="comment">// 数量达到了阈值，则需要resize</span></span><br><span class="line">    <span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">        resize();</span><br><span class="line">    <span class="comment">// 执行节点插入后的动作，如果有实现逻辑的话</span></span><br><span class="line">    afterNodeInsertion(evict);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="treeifyBin-方法"><a href="#treeifyBin-方法" class="headerlink" title="treeifyBin 方法"></a>treeifyBin 方法</h5><p>这是 HashMap 进行链表转换判断及操作的逻辑代码方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Replaces all linked nodes in bin at index for given hash unless</span></span><br><span class="line"><span class="comment"> * table is too small, in which case resizes instead.</span></span><br><span class="line"><span class="comment"> * 替换给定哈希的索引处bin中的所有链接节点，除非表太小，在这种情况下会调整大小。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">treeifyBin</span><span class="params">(Node&lt;K,V&gt;[] tab, <span class="keyword">int</span> hash)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n, index; Node&lt;K,V&gt; e;</span><br><span class="line">    <span class="comment">// 链表数组是null，或者其数量小于64，则进行resize操作</span></span><br><span class="line">    <span class="keyword">if</span> (tab == <span class="keyword">null</span> || (n = tab.length) &lt; MIN_TREEIFY_CAPACITY)</span><br><span class="line">        resize();</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ((e = tab[index = (n - <span class="number">1</span>) &amp; hash]) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 当这个hash索引处的链表不是null的时候进行才以下逻辑操作</span></span><br><span class="line">        TreeNode&lt;K,V&gt; hd = <span class="keyword">null</span>, tl = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="comment">// 先将该链表转换成双向链表，Node&lt;K,V&gt;变成</span></span><br><span class="line">            <span class="comment">// TreeNode&lt;K,V&gt; replacementTreeNode(Node&lt;K,V&gt; p, Node&lt;K,V&gt; next) &#123;</span></span><br><span class="line">            <span class="comment">//     return new TreeNode&lt;&gt;(p.hash, p.key, p.value, next);</span></span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line">            TreeNode&lt;K,V&gt; p = replacementTreeNode(e, <span class="keyword">null</span>);</span><br><span class="line">            <span class="keyword">if</span> (tl == <span class="keyword">null</span>)</span><br><span class="line">                hd = p;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                p.prev = tl;</span><br><span class="line">                tl.next = p;</span><br><span class="line">            &#125;</span><br><span class="line">            tl = p;</span><br><span class="line">        &#125; <span class="keyword">while</span> ((e = e.next) != <span class="keyword">null</span>);</span><br><span class="line">        <span class="comment">// 将转换的双向链表放进链表数组</span></span><br><span class="line">        <span class="comment">// 然后进行转换成红黑树</span></span><br><span class="line">        <span class="comment">// /**</span></span><br><span class="line">        <span class="comment">// * Forms tree of the nodes linked from this node.</span></span><br><span class="line">        <span class="comment">// * @return root of tree</span></span><br><span class="line">        <span class="comment">// */</span></span><br><span class="line">        <span class="comment">// final void treeify(Node&lt;K,V&gt;[] tab) &#123;...&#125;</span></span><br><span class="line">        <span class="keyword">if</span> ((tab[index] = hd) != <span class="keyword">null</span>)</span><br><span class="line">            hd.treeify(tab);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h4><p>到此，对 HashMap 的 put 方法代码剖析就告一段落了，学习无止境，技术的路上，期待和您一起交流！</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h4&gt;&lt;p&gt;作为一个java开发，我们在代码编程中经常会用到 k-v 键值对类型的容器，而其最常用到的即咱们的 HashMap。&lt;/p&gt;
&lt;p&gt;首先，H
      
    
    </summary>
    
      <category term="java" scheme="http://blog.ymlsfly.xin/categories/java/"/>
    
      <category term="hashmap" scheme="http://blog.ymlsfly.xin/categories/java/hashmap/"/>
    
    
      <category term="java" scheme="http://blog.ymlsfly.xin/tags/java/"/>
    
      <category term="hashmap" scheme="http://blog.ymlsfly.xin/tags/hashmap/"/>
    
  </entry>
  
  <entry>
    <title>nacos多人发布冲突问题</title>
    <link href="http://blog.ymlsfly.xin/2023/04/15/nacos-problem-one/"/>
    <id>http://blog.ymlsfly.xin/2023/04/15/nacos-problem-one/</id>
    <published>2023-04-15T02:20:28.000Z</published>
    <updated>2023-04-17T11:18:12.264Z</updated>
    
    <content type="html"><![CDATA[<h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>Nacos /nɑ:kəʊs/ 是 Dynamic Naming and Configuration Service的首字母简称，一个更易于构建云原生应用的动态服务发现、配置管理和服务管理平台。</p><p>作为一个后台开发，nacos是我经常用到的一款集注册中心、配置中心于一身的平台，简单的配置启动，然后应用注册即可使用，还有简洁明了使用的UI页面，点个赞先！</p><p>贴上官网地址：<br><a href="https://nacos.io/" target="_blank" rel="noopener">https://nacos.io/</a></p><h4 id="问题及处理"><a href="#问题及处理" class="headerlink" title="问题及处理"></a>问题及处理</h4><h5 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h5><p>在使用nacos页面更改配置并发布的时候发现一个问题：</p><p>当两个人A和B都打开了某个配置的编辑页面，都进行了修改，然后点了发布，则会出现后点发布的B提交的配置生效，因为会覆盖前者A发布的版本，而此时如果没做比对或确认的话A就会没有察觉，从而导致可能的一些问题…</p><h5 id="复现"><a href="#复现" class="headerlink" title="复现"></a>复现</h5><p>该问题也很好复现，两个人直接按照步骤操作即可，一个人的话通过两个浏览器来模拟：</p><p>1、通过浏览器A打开nacos UI页面，找到一个配置文件，点击编辑，打开编辑页面；</p><p><img src="https://raw.githubusercontent.com/1139195320/imgs/master/nacos-problem-one/1.png" alt=""></p><p>2、通过浏览器B打开nacos UI页面，也找到刚刚打开的那个配置文件，点击编辑，打开编辑页面；</p><p><img src="https://raw.githubusercontent.com/1139195320/imgs/master/nacos-problem-one/1.png" alt=""></p><p>3、在浏览器A打开的nacos配置编辑页面对配置进行变更修改，然后点击发布；</p><p><img src="https://raw.githubusercontent.com/1139195320/imgs/master/nacos-problem-one/2.png" alt=""></p><p>4、在浏览器B打开的nacos配置编辑页面也对配置进行变更修改，然后点击发布；</p><p><img src="https://raw.githubusercontent.com/1139195320/imgs/master/nacos-problem-one/3.png" alt=""></p><p>5、再次查看nacos上这个配置文件的配置信息，会发现呈现的是浏览器B编辑发布后的结果；</p><p><img src="https://raw.githubusercontent.com/1139195320/imgs/master/nacos-problem-one/4.png" alt=""></p><h5 id="处理"><a href="#处理" class="headerlink" title="处理"></a>处理</h5><p>思路：在发布之前进行MD5比对！拿到源码，本地对逻辑进行变更，然后编译打包使用…</p><p>代码修改处如下：</p><p>1、com.alibaba.nacos.config.server.model.form.ConfigForm</p><p>增加md5参数字段<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.alibaba.nacos.config.server.model.form;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.nacos.api.exception.api.NacosApiException;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.nacos.api.model.v2.ErrorCode;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.nacos.common.utils.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigForm</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ... 代码省略</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String md5;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConfigForm</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConfigForm</span><span class="params">(String dataId, String group, String namespaceId, String content, String tag, String appName,</span></span></span><br><span class="line"><span class="function"><span class="params">            String srcUser, String configTags, String desc, String use, String effect, String type, String schema,</span></span></span><br><span class="line"><span class="function"><span class="params">                      String md5)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.dataId = dataId;</span><br><span class="line">        <span class="keyword">this</span>.group = group;</span><br><span class="line">        <span class="keyword">this</span>.namespaceId = namespaceId;</span><br><span class="line">        <span class="keyword">this</span>.content = content;</span><br><span class="line">        <span class="keyword">this</span>.tag = tag;</span><br><span class="line">        <span class="keyword">this</span>.appName = appName;</span><br><span class="line">        <span class="keyword">this</span>.srcUser = srcUser;</span><br><span class="line">        <span class="keyword">this</span>.configTags = configTags;</span><br><span class="line">        <span class="keyword">this</span>.desc = desc;</span><br><span class="line">        <span class="keyword">this</span>.use = use;</span><br><span class="line">        <span class="keyword">this</span>.effect = effect;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">        <span class="keyword">this</span>.schema = schema;</span><br><span class="line">        <span class="keyword">this</span>.md5 = md5;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ... 代码省略</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMd5</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> md5;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMd5</span><span class="params">(String md5)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.md5 = md5;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == o) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="keyword">null</span> || getClass() != o.getClass()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ConfigForm configForm = (ConfigForm) o;</span><br><span class="line">        <span class="keyword">return</span> dataId.equals(configForm.dataId) &amp;&amp; group.equals(configForm.group) &amp;&amp; Objects.equals(namespaceId, configForm.namespaceId)</span><br><span class="line">                &amp;&amp; content.equals(configForm.content) &amp;&amp; Objects.equals(tag, configForm.tag) &amp;&amp; Objects</span><br><span class="line">                .equals(appName, configForm.appName) &amp;&amp; Objects.equals(srcUser, configForm.srcUser) &amp;&amp; Objects</span><br><span class="line">                .equals(configTags, configForm.configTags) &amp;&amp; Objects.equals(desc, configForm.desc) &amp;&amp; Objects</span><br><span class="line">                .equals(use, configForm.use) &amp;&amp; Objects.equals(effect, configForm.effect) &amp;&amp; Objects</span><br><span class="line">                .equals(type, configForm.type) &amp;&amp; Objects.equals(schema, configForm.schema)</span><br><span class="line">                &amp;&amp; Objects.equals(md5, configForm.md5);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Objects.hash(dataId, group, namespaceId, content, tag, appName, srcUser, configTags, desc, use, effect, type,</span><br><span class="line">                schema, md5);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"ConfigVo&#123;"</span> +</span><br><span class="line">                <span class="string">"dataId='"</span> + dataId + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", group='"</span> + group + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", namespaceId='"</span> + namespaceId + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", content='"</span> + content + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", tag='"</span> + tag + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", appName='"</span> + appName + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", srcUser='"</span> + srcUser + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", configTags='"</span> + configTags + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", desc='"</span> + desc + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", use='"</span> + use + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", effect='"</span> + effect + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", type='"</span> + type + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", schema='"</span> + schema + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", md5='"</span> + md5 + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Validate.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> NacosApiException NacosApiException.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">validate</span><span class="params">()</span> <span class="keyword">throws</span> NacosApiException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(dataId)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NacosApiException(HttpStatus.BAD_REQUEST.value(), ErrorCode.PARAMETER_MISSING,</span><br><span class="line">                    <span class="string">"Required parameter 'dataId' type String is not present"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (StringUtils.isBlank(group)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NacosApiException(HttpStatus.BAD_REQUEST.value(), ErrorCode.PARAMETER_MISSING,</span><br><span class="line">                    <span class="string">"Required parameter 'group' type String is not present"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (StringUtils.isBlank(content)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NacosApiException(HttpStatus.BAD_REQUEST.value(), ErrorCode.PARAMETER_MISSING,</span><br><span class="line">                    <span class="string">"Required parameter 'content' type String is not present"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>2、com.alibaba.nacos.config.server.controller.ConfigController#publishConfig</p><p>添加md5入参，前端有传，直接接收</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line">    <span class="meta">@TpsControl</span>(pointName = <span class="string">"ConfigPublish"</span>)</span><br><span class="line">    <span class="meta">@Secured</span>(action = ActionTypes.WRITE, signType = SignType.CONFIG)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">publishConfig</span><span class="params">(HttpServletRequest request, HttpServletResponse response,</span></span></span><br><span class="line"><span class="function"><span class="params">            @RequestParam(value = <span class="string">"dataId"</span>)</span> String dataId,</span></span><br><span class="line"><span class="function">            @<span class="title">RequestParam</span><span class="params">(value = <span class="string">"group"</span>)</span> String group,</span></span><br><span class="line"><span class="function">            @<span class="title">RequestParam</span><span class="params">(value = <span class="string">"tenant"</span>, required = <span class="keyword">false</span>, defaultValue = StringUtils.EMPTY)</span> String tenant,</span></span><br><span class="line"><span class="function">            @<span class="title">RequestParam</span><span class="params">(value = <span class="string">"content"</span>)</span> String content, @<span class="title">RequestParam</span><span class="params">(value = <span class="string">"tag"</span>, required = <span class="keyword">false</span>)</span> String tag,</span></span><br><span class="line"><span class="function">            @<span class="title">RequestParam</span><span class="params">(value = <span class="string">"appName"</span>, required = <span class="keyword">false</span>)</span> String appName,</span></span><br><span class="line"><span class="function">            @<span class="title">RequestParam</span><span class="params">(value = <span class="string">"src_user"</span>, required = <span class="keyword">false</span>)</span> String srcUser,</span></span><br><span class="line"><span class="function">            @<span class="title">RequestParam</span><span class="params">(value = <span class="string">"config_tags"</span>, required = <span class="keyword">false</span>)</span> String configTags,</span></span><br><span class="line"><span class="function">            @<span class="title">RequestParam</span><span class="params">(value = <span class="string">"desc"</span>, required = <span class="keyword">false</span>)</span> String desc,</span></span><br><span class="line"><span class="function">            @<span class="title">RequestParam</span><span class="params">(value = <span class="string">"use"</span>, required = <span class="keyword">false</span>)</span> String use,</span></span><br><span class="line"><span class="function">            @<span class="title">RequestParam</span><span class="params">(value = <span class="string">"effect"</span>, required = <span class="keyword">false</span>)</span> String effect,</span></span><br><span class="line"><span class="function">            @<span class="title">RequestParam</span><span class="params">(value = <span class="string">"type"</span>, required = <span class="keyword">false</span>)</span> String type,</span></span><br><span class="line"><span class="function">            @<span class="title">RequestParam</span><span class="params">(value = <span class="string">"schema"</span>, required = <span class="keyword">false</span>)</span> String schema,</span></span><br><span class="line"><span class="function">            @<span class="title">RequestParam</span><span class="params">(value = <span class="string">"md5"</span>, required = <span class="keyword">false</span>)</span> String md5) <span class="keyword">throws</span> NacosException </span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ... 代码省略</span></span><br><span class="line">        configForm.setMd5(md5);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ... 代码省略</span></span><br><span class="line">       </span><br><span class="line">        <span class="keyword">return</span> configOperationService.publishConfig(configForm, configRequestInfo, encryptedDataKey);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>3、com.alibaba.nacos.config.server.service.ConfigOperationService#publishConfig</p><p>添加校验逻辑</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Boolean <span class="title">publishConfig</span><span class="params">(ConfigForm configForm, ConfigRequestInfo configRequestInfo, String encryptedDataKey)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> NacosException </span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ... 代码省略</span></span><br><span class="line"></span><br><span class="line">        ConfigInfo oldConfigInfo = configInfoPersistService.findConfigInfo(configInfo.getDataId(), configInfo.getGroup(),</span><br><span class="line">                configInfo.getTenant());</span><br><span class="line">        String oldConfigInfoMd5 = oldConfigInfo.getMd5();</span><br><span class="line">        String curMd5 = configForm.getMd5();</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.equals(curMd5, oldConfigInfoMd5)) &#123;</span><br><span class="line">            <span class="comment">// 传进来的上一版本md5和数据库里现在的md5不相等，表示在此之前其他用户已更新，不能直接覆盖</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NacosApiException(HttpStatus.METHOD_NOT_ALLOWED.value(), ErrorCode.RESOURCE_CONFLICT, <span class="string">"已有其他用户更新了此配置，请先更新再修改发布！"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ... 代码省略</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>4、编译打包</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn -Prelease-nacos -Dmaven.test.skip=true clean install -U</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/1139195320/imgs/master/nacos-problem-one/9.png" alt=""></p><p>5、拿到打包后的新包使用即可</p><p>新包路径：项目代码路径/distribution/target</p><p><img src="https://raw.githubusercontent.com/1139195320/imgs/master/nacos-problem-one/5.png" alt=""></p><h5 id="复测"><a href="#复测" class="headerlink" title="复测"></a>复测</h5><p>再次测试结果符合预期！</p><p><img src="https://raw.githubusercontent.com/1139195320/imgs/master/nacos-problem-one/6.png" alt=""></p><p><img src="https://raw.githubusercontent.com/1139195320/imgs/master/nacos-problem-one/7.png" alt=""></p><p><img src="https://raw.githubusercontent.com/1139195320/imgs/master/nacos-problem-one/8.png" alt=""></p><h4 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h4><p>到此这个问题就可以如愿解决了，欢迎留言交流！</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h4&gt;&lt;p&gt;Nacos /nɑ:kəʊs/ 是 Dynamic Naming and Configuration Service的首字母简称，一个更易于
      
    
    </summary>
    
      <category term="java" scheme="http://blog.ymlsfly.xin/categories/java/"/>
    
      <category term="工具" scheme="http://blog.ymlsfly.xin/categories/java/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="工具" scheme="http://blog.ymlsfly.xin/tags/%E5%B7%A5%E5%85%B7/"/>
    
      <category term="nacos" scheme="http://blog.ymlsfly.xin/tags/nacos/"/>
    
  </entry>
  
  <entry>
    <title>五子棋</title>
    <link href="http://blog.ymlsfly.xin/2023/04/08/%E4%BA%94%E5%AD%90%E6%A3%8B/"/>
    <id>http://blog.ymlsfly.xin/2023/04/08/五子棋/</id>
    <published>2023-04-08T06:15:43.000Z</published>
    <updated>2023-04-16T23:55:58.815Z</updated>
    
    <content type="html"><![CDATA[<h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>突发奇想，使用java来写一个游戏，今日实现的程序为：五子棋。</p><h4 id="实现后的效果图"><a href="#实现后的效果图" class="headerlink" title="实现后的效果图"></a>实现后的效果图</h4><p><img src="https://raw.githubusercontent.com/1139195320/imgs/master/gobang/1.png" alt=""></p><p><img src="https://raw.githubusercontent.com/1139195320/imgs/master/gobang/2.png" alt=""></p><p><img src="https://raw.githubusercontent.com/1139195320/imgs/master/gobang/3.png" alt=""></p><h4 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h4><h5 id="五子棋的棋盘画板类"><a href="#五子棋的棋盘画板类" class="headerlink" title="五子棋的棋盘画板类"></a>五子棋的棋盘画板类</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jack</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GoBangBoard</span> <span class="keyword">extends</span> <span class="title">JPanel</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;LineBean&gt; lineList;</span><br><span class="line">    <span class="keyword">private</span> List&lt;StrBean&gt; strList;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GoBangBoard</span><span class="params">(List&lt;LineBean&gt; lineList)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.lineList = lineList;</span><br><span class="line">        <span class="keyword">this</span>.strList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">paintComponent</span><span class="params">(Graphics g)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.paintComponent(g);</span><br><span class="line">        <span class="keyword">for</span> (LineBean lineBean : lineList) &#123;</span><br><span class="line">            g.drawLine(lineBean.getStartX(), lineBean.getStartY(),</span><br><span class="line">                    lineBean.getEndX(), lineBean.getEndY());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 字体高度</span></span><br><span class="line">        g.setFont(<span class="keyword">new</span> Font(<span class="string">"宋体"</span>, Font.PLAIN, <span class="number">20</span>));</span><br><span class="line">        <span class="keyword">for</span> (StrBean strBean : strList) &#123;</span><br><span class="line">            g.setColor(strBean.getTextColor());</span><br><span class="line">            g.drawString(strBean.getStr(), strBean.getX() - <span class="number">10</span>, strBean.getY() - <span class="number">22</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawString</span><span class="params">(String str, <span class="keyword">int</span> x, <span class="keyword">int</span> y, Color textColor)</span> </span>&#123;</span><br><span class="line">        strList.add(<span class="keyword">new</span> StrBean(str, x, y, textColor));</span><br><span class="line">        repaint();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="五子棋配置类"><a href="#五子棋配置类" class="headerlink" title="五子棋配置类"></a>五子棋配置类</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.Builder;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Description：画板配置</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jack</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GoBangBoardConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">GoBangBoardConfig</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">GoBangBoardConfig</span><span class="params">(<span class="keyword">int</span> sideCount, <span class="keyword">int</span> sideLen, <span class="keyword">int</span> successCount)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sideCount = sideCount;</span><br><span class="line">        <span class="keyword">this</span>.sideLen = sideLen;</span><br><span class="line">        <span class="keyword">this</span>.successCount = successCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 横纵格子数</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> sideCount;</span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 边长</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> sideLen;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 成功所需要连的棋子数，譬如五子棋即为5</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> successCount;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="线条类"><a href="#线条类" class="headerlink" title="线条类"></a>线条类</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Description：线条</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jack</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LineBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LineBean</span><span class="params">(<span class="keyword">int</span> startX, <span class="keyword">int</span> startY, <span class="keyword">int</span> endX, <span class="keyword">int</span> endY)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.startX = startX;</span><br><span class="line">        <span class="keyword">this</span>.startY = startY;</span><br><span class="line">        <span class="keyword">this</span>.endX = endX;</span><br><span class="line">        <span class="keyword">this</span>.endY = endY;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> startX;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> startY;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> endX;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> endY;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LineBean <span class="title">add</span><span class="params">(<span class="keyword">int</span> borderMargin)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.startX += borderMargin;</span><br><span class="line">        <span class="keyword">this</span>.startY += borderMargin;</span><br><span class="line">        <span class="keyword">this</span>.endX += borderMargin;</span><br><span class="line">        <span class="keyword">this</span>.endY += borderMargin;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="坐标类"><a href="#坐标类" class="headerlink" title="坐标类"></a>坐标类</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Description：坐标类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jack</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> x;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> y;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">P</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.x = x;</span><br><span class="line">        <span class="keyword">this</span>.y = y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Objects.hash(x, y);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (obj == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!(obj <span class="keyword">instanceof</span> P)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.hashCode() != obj.hashCode()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        P other = (P) obj;</span><br><span class="line">        <span class="keyword">return</span> x == other.x &amp;&amp; y == other.y;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="棋子类"><a href="#棋子类" class="headerlink" title="棋子类"></a>棋子类</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.Builder;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Description：棋子类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jack</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Point</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Point</span><span class="params">(P p, <span class="keyword">short</span> state)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.p = p;</span><br><span class="line">        <span class="keyword">this</span>.state = state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> P p;</span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 棋子的状态</span></span><br><span class="line"><span class="comment">     * 0-空白、1-黑棋、2-白棋</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">short</span> state;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="字符串绘制类"><a href="#字符串绘制类" class="headerlink" title="字符串绘制类"></a>字符串绘制类</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Description：字符串绘制类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jack</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StrBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StrBean</span><span class="params">(String str, <span class="keyword">int</span> x, <span class="keyword">int</span> y, Color textColor)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.str = str;</span><br><span class="line">        <span class="keyword">this</span>.x = x;</span><br><span class="line">        <span class="keyword">this</span>.y = y;</span><br><span class="line">        <span class="keyword">this</span>.textColor = textColor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String str;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> x;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> y;</span><br><span class="line">    <span class="keyword">private</span> Color textColor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="五子棋辅助类"><a href="#五子棋辅助类" class="headerlink" title="五子棋辅助类"></a>五子棋辅助类</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.jack.game.piece.bean.GoBangBoardConfig;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Description：五子棋 辅助类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jack</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GoBangHelper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MIN_SUCCESS_COUNT = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MIN_SIDE_COUNT = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MIN_SIDE_LEN = <span class="number">400</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getSuccessCount</span><span class="params">(GoBangBoardConfig config)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Math.max(MIN_SUCCESS_COUNT, config.getSuccessCount());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getSideCount</span><span class="params">(GoBangBoardConfig config)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Math.max(MIN_SIDE_COUNT, config.getSideCount());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getSideLen</span><span class="params">(GoBangBoardConfig config)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Math.max(MIN_SIDE_LEN, config.getSideLen());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="启动逻辑主类"><a href="#启动逻辑主类" class="headerlink" title="启动逻辑主类"></a>启动逻辑主类</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.jack.game.piece.bean.*;</span><br><span class="line"><span class="keyword">import</span> com.jack.game.piece.bean.Point;</span><br><span class="line"><span class="keyword">import</span> com.jack.game.piece.helper.GoBangHelper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.MouseAdapter;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.MouseEvent;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Description：五子棋</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jack</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GoBang</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TOP = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> RIGHT_TOP = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> RIGHT = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> RIGHT_BOTTOM = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BOTTOM = <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> LEFT_BOTTOM = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> LEFT = <span class="number">6</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> LEFT_TOP = <span class="number">7</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> List&lt;Integer&gt; DIR_LIST;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 空白</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">short</span> BLANK_STATE = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 黑棋</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">short</span> BLACK_STATE = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 白棋</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">short</span> WHITE_STATE = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">short</span>[] STATE_ARR;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] TEXT_ARR;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Color[] TEXT_COLOR_ARR;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 当前回合的状态</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> curStateStartOffset = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;Short, String&gt; SUCCESS_MSG_MAP;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        DIR_LIST = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        DIR_LIST.add(TOP);</span><br><span class="line">        DIR_LIST.add(RIGHT_TOP);</span><br><span class="line">        DIR_LIST.add(RIGHT);</span><br><span class="line">        DIR_LIST.add(RIGHT_BOTTOM);</span><br><span class="line">        DIR_LIST.add(BOTTOM);</span><br><span class="line">        DIR_LIST.add(LEFT_BOTTOM);</span><br><span class="line">        DIR_LIST.add(LEFT);</span><br><span class="line">        DIR_LIST.add(LEFT_TOP);</span><br><span class="line"></span><br><span class="line">        SUCCESS_MSG_MAP = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        SUCCESS_MSG_MAP.put(BLACK_STATE, <span class="string">"恭喜黑棋方胜利！"</span>);</span><br><span class="line">        SUCCESS_MSG_MAP.put(WHITE_STATE, <span class="string">"恭喜白棋方胜利！"</span>);</span><br><span class="line"></span><br><span class="line">        STATE_ARR = <span class="keyword">new</span> <span class="keyword">short</span>[]&#123;BLACK_STATE, WHITE_STATE&#125;;</span><br><span class="line">        TEXT_ARR = <span class="keyword">new</span> String[]&#123;<span class="string">"●"</span>, <span class="string">"●"</span>&#125;;</span><br><span class="line">        TEXT_COLOR_ARR = <span class="keyword">new</span> Color[] &#123;Color.BLACK, Color.WHITE&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 所有点</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Point[][] allPointArr;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 灵敏距离范围</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> allowLenRange;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 2个棋子之间的间隔</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> interval;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> sideCount;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> sideLen;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> successCount;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isOver = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GoBang</span><span class="params">(GoBangBoardConfig boardConfig)</span> </span>&#123;</span><br><span class="line">        successCount = GoBangHelper.getSuccessCount(boardConfig);</span><br><span class="line">        sideCount = GoBangHelper.getSideCount(boardConfig);</span><br><span class="line">        allPointArr = <span class="keyword">new</span> Point[sideCount][sideCount];</span><br><span class="line">        sideLen = GoBangHelper.getSideLen(boardConfig);</span><br><span class="line">        interval = sideLen * <span class="number">1.0</span> / (sideCount - <span class="number">1</span>);</span><br><span class="line">        allowLenRange = interval / <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; sideCount; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> x = (<span class="keyword">int</span>) (i * interval);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; sideCount; j++) &#123;</span><br><span class="line">                <span class="keyword">int</span> y = (<span class="keyword">int</span>) (j * interval);</span><br><span class="line">                P p = <span class="keyword">new</span> P(x + BORDER_MARGIN, y + BORDER_MARGIN + Y_BORDER_MARGIN);</span><br><span class="line">                Point point = Point.builder()</span><br><span class="line">                        .p(p)</span><br><span class="line">                        .state(BLANK_STATE)</span><br><span class="line">                        .build();</span><br><span class="line">                allPointArr[i][j] = point;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BORDER_MARGIN = <span class="number">30</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> Y_BORDER_MARGIN = <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showGraph</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        JFrame jFrame = <span class="keyword">new</span> JFrame();</span><br><span class="line">        List&lt;LineBean&gt; lineList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; sideCount; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> x = (<span class="keyword">int</span>) (i * interval);</span><br><span class="line">            lineList.add(<span class="keyword">new</span> LineBean(x, <span class="number">0</span>, x, sideLen).add(BORDER_MARGIN));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; sideCount; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> y = (<span class="keyword">int</span>) (i * interval);</span><br><span class="line">            lineList.add(<span class="keyword">new</span> LineBean(<span class="number">0</span>, y, sideLen, y).add(BORDER_MARGIN));</span><br><span class="line">        &#125;</span><br><span class="line">        GoBangBoard goBangBoard = <span class="keyword">new</span> GoBangBoard(lineList);</span><br><span class="line">        jFrame.add(goBangBoard);</span><br><span class="line"></span><br><span class="line">        jFrame.addMouseListener(<span class="keyword">new</span> MouseAdapter() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mouseClicked</span><span class="params">(MouseEvent e)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (!isOver) &#123;</span><br><span class="line">                    clickPoint(e.getX(), e.getY(), goBangBoard);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        jFrame.setSize(sideLen + BORDER_MARGIN * <span class="number">2</span>,</span><br><span class="line">                sideLen + BORDER_MARGIN * <span class="number">2</span> + Y_BORDER_MARGIN);</span><br><span class="line">        jFrame.setDefaultCloseOperation(WindowConstants.EXIT_ON_CLOSE);</span><br><span class="line">        jFrame.setVisible(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">clickPoint</span><span class="params">(<span class="keyword">int</span> clickX, <span class="keyword">int</span> clickY, GoBangBoard goBangBoard)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">short</span> state = STATE_ARR[curStateStartOffset];</span><br><span class="line">        P p = getClickP(clickX, clickY);</span><br><span class="line">        <span class="keyword">if</span> (p == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 点击的不在灵敏度范围内</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> offsetX = transPosX(p.getX());</span><br><span class="line">        <span class="keyword">int</span> offsetY = transPosY(p.getY());</span><br><span class="line">        Point curPoint = allPointArr[offsetX][offsetY];</span><br><span class="line">        <span class="keyword">if</span> (curPoint.getState() != BLANK_STATE) &#123;</span><br><span class="line">            <span class="comment">// 该点已用</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        curPoint.setState(state);</span><br><span class="line">        <span class="comment">// 刷新渲染</span></span><br><span class="line">        goBangBoard.drawString(TEXT_ARR[curStateStartOffset], p.getX(), p.getY(), TEXT_COLOR_ARR[curStateStartOffset]);</span><br><span class="line">        <span class="comment">// 检查是否成功</span></span><br><span class="line">        <span class="keyword">if</span> (checkCurSuccess(curPoint, offsetX, offsetY)) &#123;</span><br><span class="line">            isOver = <span class="keyword">true</span>;</span><br><span class="line">            System.out.println(SUCCESS_MSG_MAP.get(state));</span><br><span class="line">            JOptionPane.showMessageDialog(goBangBoard, SUCCESS_MSG_MAP.get(state));</span><br><span class="line">        &#125;</span><br><span class="line">        curStateStartOffset = (curStateStartOffset + <span class="number">1</span>) % STATE_ARR.length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">checkCurSuccess</span><span class="params">(Point curPoint, <span class="keyword">int</span> offsetX, <span class="keyword">int</span> offsetY)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">short</span> state = curPoint.getState();</span><br><span class="line">        <span class="keyword">if</span> (state == BLANK_STATE) &#123;</span><br><span class="line">            <span class="comment">// 空白</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 检查当前点周围是否满足</span></span><br><span class="line">        <span class="keyword">int</span>[] countArr = <span class="keyword">new</span> <span class="keyword">int</span>[DIR_LIST.size()];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> dir : DIR_LIST) &#123;</span><br><span class="line">            <span class="comment">// 得减去自身</span></span><br><span class="line">            countArr[dir] = getAroundCount(offsetX, offsetY, state, dir) - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (countArr[TOP] + countArr[BOTTOM] == successCount - <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// 竖向成功</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (countArr[LEFT] + countArr[RIGHT] == successCount - <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// 横向成功</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (countArr[LEFT_TOP] + countArr[RIGHT_BOTTOM] == successCount - <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// 左上-右下向成功</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 左下-右上向成功</span></span><br><span class="line">        <span class="keyword">return</span> countArr[LEFT_BOTTOM] + countArr[RIGHT_TOP] == successCount - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getAroundCount</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">short</span> state, <span class="keyword">int</span> dir)</span> </span>&#123;</span><br><span class="line">        Point point = allPointArr[x][y];</span><br><span class="line">        <span class="keyword">short</span> curState = point.getState();</span><br><span class="line">        <span class="keyword">if</span> (curState == state) &#123;</span><br><span class="line">            <span class="comment">// 同色棋子</span></span><br><span class="line">            <span class="keyword">int</span> offsetX;</span><br><span class="line">            <span class="keyword">int</span> offsetY;</span><br><span class="line">            <span class="keyword">switch</span> (dir) &#123;</span><br><span class="line">                <span class="keyword">case</span> TOP:</span><br><span class="line">                    <span class="comment">// 上</span></span><br><span class="line">                    offsetX = x;</span><br><span class="line">                    offsetY = y - <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> RIGHT_TOP:</span><br><span class="line">                    <span class="comment">// 右上</span></span><br><span class="line">                    offsetX = x + <span class="number">1</span>;</span><br><span class="line">                    offsetY = y - <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> RIGHT:</span><br><span class="line">                    <span class="comment">// 右</span></span><br><span class="line">                    offsetX = x + <span class="number">1</span>;</span><br><span class="line">                    offsetY = y;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> RIGHT_BOTTOM:</span><br><span class="line">                    <span class="comment">// 右下</span></span><br><span class="line">                    offsetX = x + <span class="number">1</span>;</span><br><span class="line">                    offsetY = y + <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> BOTTOM:</span><br><span class="line">                    <span class="comment">// 下</span></span><br><span class="line">                    offsetX = x;</span><br><span class="line">                    offsetY = y + <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> LEFT_BOTTOM:</span><br><span class="line">                    <span class="comment">// 左下</span></span><br><span class="line">                    offsetX = x - <span class="number">1</span>;</span><br><span class="line">                    offsetY = y + <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> LEFT:</span><br><span class="line">                    <span class="comment">// 左</span></span><br><span class="line">                    offsetX = x - <span class="number">1</span>;</span><br><span class="line">                    offsetY = y;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> LEFT_TOP:</span><br><span class="line">                    <span class="comment">// 左上</span></span><br><span class="line">                    offsetX = x - <span class="number">1</span>;</span><br><span class="line">                    offsetY = y - <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (isValidOffset(offsetX, offsetY)) &#123;</span><br><span class="line">                <span class="keyword">return</span> getAroundCount(offsetX, offsetY, curState, dir) + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 不同色</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isValidOffset</span><span class="params">(<span class="keyword">int</span> offsetX, <span class="keyword">int</span> offsetY)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> max = allPointArr.length;</span><br><span class="line">        <span class="keyword">return</span> offsetX &gt;= <span class="number">0</span> &amp;&amp; offsetX &lt; max &amp;&amp; offsetY &gt;= <span class="number">0</span> &amp;&amp; offsetY &lt; max;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 通过坐标找到最近的点</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> jack</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> realX 点击的实际点 x</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> realY 点击的实际点 y</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> com.jack.game.piece.bean.P</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> P <span class="title">getClickP</span><span class="params">(<span class="keyword">int</span> realX, <span class="keyword">int</span> realY)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">double</span> margin = Integer.MAX_VALUE;</span><br><span class="line">        <span class="keyword">int</span> resX = realX;</span><br><span class="line">        <span class="keyword">int</span> resY = realY;</span><br><span class="line">        <span class="keyword">for</span> (Point[] points : allPointArr) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Point point : points) &#123;</span><br><span class="line">                <span class="keyword">int</span> x = point.getP().getX();</span><br><span class="line">                <span class="keyword">int</span> y = point.getP().getY();</span><br><span class="line">                <span class="keyword">if</span> (realX == x &amp;&amp; realY == y) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> P(resX, resY);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">int</span> marginX = Math.abs(x - realX);</span><br><span class="line">                <span class="keyword">int</span> marginY = Math.abs(y - realY);</span><br><span class="line">                <span class="keyword">double</span> tmp = Math.sqrt(marginX * marginX + marginY * marginY);</span><br><span class="line">                <span class="keyword">if</span> (tmp &lt; margin) &#123;</span><br><span class="line">                    margin = tmp;</span><br><span class="line">                    resX = x;</span><br><span class="line">                    resY = y;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (margin &gt; allowLenRange) &#123;</span><br><span class="line">            <span class="comment">// 最接近的也不在灵敏范围内</span></span><br><span class="line">            <span class="comment">// 不识别为坐标点</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> P(resX, resY);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">transPosX</span><span class="params">(<span class="keyword">int</span> realX)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>) (Math.ceil((realX - BORDER_MARGIN) / interval));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">transPosY</span><span class="params">(<span class="keyword">int</span> realY)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>) (Math.ceil((realY - BORDER_MARGIN - Y_BORDER_MARGIN) / interval));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="启动调用代码"><a href="#启动调用代码" class="headerlink" title="启动调用代码"></a>启动调用代码</h5><p> 简单一句即可</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> GoBang(GoBangBoardConfig.builder().build()).showGraph();</span><br></pre></td></tr></table></figure><h4 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h4><p>到此一个简单的五子棋程序便实现完成了，启动后，黑白双方交互下棋，有一人胜利即结束，程序为版本一，有诸多地方和功能能够更好的改进，欢迎留言交流！</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h4&gt;&lt;p&gt;突发奇想，使用java来写一个游戏，今日实现的程序为：五子棋。&lt;/p&gt;
&lt;h4 id=&quot;实现后的效果图&quot;&gt;&lt;a href=&quot;#实现后的效果图
      
    
    </summary>
    
      <category term="java" scheme="http://blog.ymlsfly.xin/categories/java/"/>
    
      <category term="play" scheme="http://blog.ymlsfly.xin/categories/java/play/"/>
    
    
      <category term="游戏" scheme="http://blog.ymlsfly.xin/tags/%E6%B8%B8%E6%88%8F/"/>
    
      <category term="play" scheme="http://blog.ymlsfly.xin/tags/play/"/>
    
      <category term="五子棋" scheme="http://blog.ymlsfly.xin/tags/%E4%BA%94%E5%AD%90%E6%A3%8B/"/>
    
  </entry>
  
  <entry>
    <title>进阶注解处理器 processor （三）</title>
    <link href="http://blog.ymlsfly.xin/2020/06/14/processor_three/"/>
    <id>http://blog.ymlsfly.xin/2020/06/14/processor_three/</id>
    <published>2020-06-14T10:54:24.835Z</published>
    <updated>2020-06-14T10:53:10.957Z</updated>
    
    <content type="html"><![CDATA[<h3 id="序言"><a href="#序言" class="headerlink" title="序言"></a>序言</h3><p>该篇主于实战一个简单的 processor，代码备注很详细，如果对运行和语法还有疑问的请先查阅下前面几篇，重复内容此处就不赘述了~   </p><h3 id="annotation"><a href="#annotation" class="headerlink" title="annotation"></a>annotation</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(ElementType.METHOD)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.SOURCE)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> JackLog &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="processor"><a href="#processor" class="headerlink" title="processor"></a>processor</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.jack.annotation.JackLog;</span><br><span class="line"><span class="keyword">import</span> com.sun.tools.javac.api.JavacTrees;</span><br><span class="line"><span class="keyword">import</span> com.sun.tools.javac.model.JavacElements;</span><br><span class="line"><span class="keyword">import</span> com.sun.tools.javac.processing.JavacProcessingEnvironment;</span><br><span class="line"><span class="keyword">import</span> com.sun.tools.javac.tree.JCTree;</span><br><span class="line"><span class="keyword">import</span> com.sun.tools.javac.tree.TreeMaker;</span><br><span class="line"><span class="keyword">import</span> com.sun.tools.javac.tree.TreeTranslator;</span><br><span class="line"><span class="keyword">import</span> com.sun.tools.javac.util.Context;</span><br><span class="line"><span class="keyword">import</span> com.sun.tools.javac.util.List;</span><br><span class="line"><span class="keyword">import</span> com.sun.tools.javac.util.Name;</span><br><span class="line"><span class="keyword">import</span> com.sun.tools.javac.util.Names;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.processing.*;</span><br><span class="line"><span class="keyword">import</span> javax.lang.model.SourceVersion;</span><br><span class="line"><span class="keyword">import</span> javax.lang.model.element.Element;</span><br><span class="line"><span class="keyword">import</span> javax.lang.model.element.TypeElement;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jack</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SupportedAnnotationTypes</span>(<span class="string">"com.jack.annotation.JackLog"</span>)</span><br><span class="line"><span class="meta">@SupportedSourceVersion</span>(SourceVersion.RELEASE_8)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JackLogProcessor</span> <span class="keyword">extends</span> <span class="title">AbstractProcessor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 抽象语法树对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> JavacTrees trees;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用于创建语法树节点的所有方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> TreeMaker treeMaker;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用于创建标识符</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Names names;</span><br><span class="line">    <span class="keyword">private</span> JavacElements elementUtils;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ProcessingEnvironment processingEnv)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.init(processingEnv);</span><br><span class="line">        <span class="keyword">this</span>.trees = JavacTrees.instance(processingEnv);</span><br><span class="line">        Context context = ((JavacProcessingEnvironment) processingEnv).getContext();</span><br><span class="line">        <span class="keyword">this</span>.treeMaker = TreeMaker.instance(context);</span><br><span class="line">        <span class="keyword">this</span>.names = Names.instance(context);</span><br><span class="line">        elementUtils = (JavacElements) processingEnv.getElementUtils();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">process</span><span class="params">(Set&lt;? extends TypeElement&gt; annotations,</span></span></span><br><span class="line"><span class="function"><span class="params">                           RoundEnvironment roundEnv)</span> </span>&#123;</span><br><span class="line">        Set&lt;? extends Element&gt; set = roundEnv.getElementsAnnotatedWith(JackLog.class);</span><br><span class="line">        set.forEach(element -&gt; &#123;</span><br><span class="line">            JCTree jcTree = trees.getTree(element);</span><br><span class="line">            jcTree.accept(<span class="keyword">new</span> TreeTranslator() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visitMethodDef</span><span class="params">(JCTree.JCMethodDecl jcMethodDecl)</span> </span>&#123;</span><br><span class="line">                    doOperationMethod(jcMethodDecl);</span><br><span class="line">                    <span class="keyword">super</span>.visitMethodDef(jcMethodDecl);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doOperationMethod</span><span class="params">(JCTree.JCMethodDecl jcMethodDecl)</span> </span>&#123;</span><br><span class="line">        treeMaker.pos = jcMethodDecl.pos;</span><br><span class="line">        jcMethodDecl.body = treeMaker.Block(<span class="number">0</span>, List.of(</span><br><span class="line">                getSentenceOne(),</span><br><span class="line">                jcMethodDecl.body,</span><br><span class="line">                getSentenceTwo()</span><br><span class="line">        ));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> JCTree.<span class="function">JCStatement <span class="title">getSentenceOne</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Name systemName = elementUtils.getName(<span class="string">"System"</span>);</span><br><span class="line">        Name currentTimeMillisName = elementUtils.getName(<span class="string">"currentTimeMillis"</span>);</span><br><span class="line">        Name longName = elementUtils.getName(<span class="string">"Long"</span>);</span><br><span class="line">        <span class="comment">// 拼接 System.currentTimeMillis()</span></span><br><span class="line">        JCTree.JCFieldAccess s1 = treeMaker.Select(treeMaker.Ident(systemName),</span><br><span class="line">                currentTimeMillisName);</span><br><span class="line">        treeMaker.Exec(treeMaker.Apply(List.nil(), s1, List.nil()));</span><br><span class="line">        <span class="comment">// java.lang.Long fStart = System.currentTimeMillis()</span></span><br><span class="line">        <span class="keyword">return</span> treeMaker.VarDef(treeMaker.Modifiers(<span class="number">0</span>),</span><br><span class="line">                names.fromString(<span class="string">"fStart"</span>), treeMaker.Ident(longName),</span><br><span class="line">                treeMaker.Apply(List.nil(), s1, List.nil()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> JCTree.<span class="function">JCStatement <span class="title">getSentenceTwo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Name systemName = elementUtils.getName(<span class="string">"System"</span>);</span><br><span class="line">        Name currentTimeMillisName = elementUtils.getName(<span class="string">"currentTimeMillis"</span>);</span><br><span class="line">        Name outName = elementUtils.getName(<span class="string">"out"</span>);</span><br><span class="line">        Name printlnName = elementUtils.getName(<span class="string">"println"</span>);</span><br><span class="line">        <span class="comment">// 拼接 System.out</span></span><br><span class="line">        JCTree.JCFieldAccess s1 = treeMaker.Select(treeMaker.Ident(systemName), outName);</span><br><span class="line">        <span class="comment">// 拼接 System.out.println</span></span><br><span class="line">        JCTree.JCFieldAccess s2 = treeMaker.Select(s1, printlnName);</span><br><span class="line">        <span class="comment">// 拼接 System.currentTimeMillis()</span></span><br><span class="line">        JCTree.JCFieldAccess s3 = treeMaker.Select(treeMaker.Ident(systemName),</span><br><span class="line">                currentTimeMillisName);</span><br><span class="line">        <span class="comment">// 拼接 System.currentTimeMills() - fStart</span></span><br><span class="line">        JCTree.JCBinary s4 = treeMaker.Binary(JCTree.Tag.MINUS,</span><br><span class="line">                treeMaker.Apply(List.nil(), s3, List.nil()),</span><br><span class="line">                treeMaker.Ident(names.fromString(<span class="string">"fStart"</span>)));</span><br><span class="line">        JCTree.JCBinary s5 = treeMaker.Binary(JCTree.Tag.PLUS,</span><br><span class="line">                treeMaker.Literal(<span class="string">"耗时："</span>), s4);</span><br><span class="line">        JCTree.JCBinary s6 = treeMaker.Binary(JCTree.Tag.PLUS, s5,</span><br><span class="line">                treeMaker.Literal(<span class="string">"ms"</span>));</span><br><span class="line">        <span class="comment">// System.out.println("耗时：" + (System.currentTimeMills() - fStart) + "ms)</span></span><br><span class="line">        <span class="keyword">return</span> treeMaker.Exec(treeMaker.Apply(List.nil(), s2, List.of(s6)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><p>javax.annotation.processing.Processor<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">com.jack.processor.JackLogProcessor</span><br></pre></td></tr></table></figure></p><p>…   </p><h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p>第一个自定义 processor 的实战，后续逐步进阶~</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;序言&quot;&gt;&lt;a href=&quot;#序言&quot; class=&quot;headerlink&quot; title=&quot;序言&quot;&gt;&lt;/a&gt;序言&lt;/h3&gt;&lt;p&gt;该篇主于实战一个简单的 processor，代码备注很详细，如果对运行和语法还有疑问的请先查阅下前面几篇，重复内容此处就不赘述了~   &lt;/
      
    
    </summary>
    
      <category term="java" scheme="http://blog.ymlsfly.xin/categories/java/"/>
    
      <category term="processor" scheme="http://blog.ymlsfly.xin/categories/java/processor/"/>
    
      <category term="annotation" scheme="http://blog.ymlsfly.xin/categories/java/processor/annotation/"/>
    
    
      <category term="processor" scheme="http://blog.ymlsfly.xin/tags/processor/"/>
    
  </entry>
  
  <entry>
    <title>进阶注解处理器 processor （二）</title>
    <link href="http://blog.ymlsfly.xin/2020/05/31/processor_two/"/>
    <id>http://blog.ymlsfly.xin/2020/05/31/processor_two/</id>
    <published>2020-05-31T11:21:13.803Z</published>
    <updated>2020-05-31T11:25:30.188Z</updated>
    
    <content type="html"><![CDATA[<h3 id="什么是-AST"><a href="#什么是-AST" class="headerlink" title="什么是 AST"></a>什么是 AST</h3><p>AST(Abstract Syntax Tree 抽象语法树)是一种用来描述程序代码语法结构的树形表示方式，语法树的每一个节点都代表着程序代码中的一个语法结构，例如包、类型、修饰符、运算符、接口、返回值，甚至代码注释等都可以是一个语法结构。   </p><h3 id="什么是-JCTree"><a href="#什么是-JCTree" class="headerlink" title="什么是 JCTree"></a>什么是 JCTree</h3><p>JCTree是语法树元素的基类，它包含两个属性：<br>type：表示语法结构的类型。<br>pos：用于指明当前语法树节点（JCTree）在语法树中的位置，因此不能直接用new关键字来创建语法树节点，即使创建了也没有意义，而要用TreeMaker来进行操作。   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">JCTree</span> <span class="keyword">implements</span> <span class="title">Tree</span>, <span class="title">Cloneable</span>, <span class="title">DiagnosticPosition</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> pos;</span><br><span class="line">    <span class="keyword">public</span> Type type;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>JCTree 有很多子类，eg：<br>JCStatement、JCClassDecl、JCMethodDecl、JCVariableDecl、JCModifiers、JCExpression …<br>在后续多少都会用到。   </p><h3 id="什么是-TreeMaker"><a href="#什么是-TreeMaker" class="headerlink" title="什么是 TreeMaker"></a>什么是 TreeMaker</h3><p>TreeMaker创建语法树节点的所有方法，创建时会为创建出来的JCTree设置pos字段，所以必须用上下文相关的TreeMaker对象来创建语法树节点，而不能直接new语法树节点。   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Context context = ((JavacProcessingEnvironment) processingEnv).getContext();</span><br><span class="line">TreeMaker treeMaker = TreeMaker.instance(context);</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><h3 id="怎么使用-TreeMaker"><a href="#怎么使用-TreeMaker" class="headerlink" title="怎么使用 TreeMaker"></a>怎么使用 TreeMaker</h3><p>部分方法示例：<br>TreeMaker.MethodDef<br>用于创建方法定义语法树节点（JCMethodDecl）<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> JCMethodDecl <span class="title">MethodDef</span><span class="params">(JCModifiers mods, Name name,</span></span></span><br><span class="line"><span class="function"><span class="params">       JCExpression returntype, List&lt;JCTypeParameter&gt; typarams,</span></span></span><br><span class="line"><span class="function"><span class="params">       List&lt;JCVariableDecl&gt; params, List&lt;JCExpression&gt; thrown,</span></span></span><br><span class="line"><span class="function"><span class="params">       JCBlock body, JCExpression defaultValue)</span></span>&#123;</span><br><span class="line">    JCMethodDecl tree = <span class="keyword">new</span> JCMethodDecl(mods, name,</span><br><span class="line">       returntype, typarams, params, thrown, body, </span><br><span class="line">       defaultValue, <span class="keyword">null</span>);</span><br><span class="line">    tree.pos = pos;</span><br><span class="line">    <span class="keyword">return</span> tree;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>TreeMaker.VarDef<br>用于创建字段/变量定义语法树节点（JCVariableDecl）<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> JCVariableDecl <span class="title">VarDef</span><span class="params">(JCModifiers mods, Name name, JCExpression vartype, </span></span></span><br><span class="line"><span class="function"><span class="params">        JCExpression init)</span> </span>&#123;</span><br><span class="line">    JCVariableDecl tree = <span class="keyword">new</span> JCVariableDecl(mods, name, vartype, init, <span class="keyword">null</span>);</span><br><span class="line">    tree.pos = pos;</span><br><span class="line">    <span class="keyword">return</span> tree;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>TreeMaker.Return<br>用于创建return语句语法树节点（JCReturn）<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> JCReturn <span class="title">Return</span><span class="params">(JCExpression expression)</span> </span>&#123;</span><br><span class="line">    JCReturn jcReturn= <span class="keyword">new</span> JCReturn(expression);</span><br><span class="line">    jcReturn.pos = <span class="keyword">this</span>.pos;</span><br><span class="line">    <span class="keyword">return</span> jcReturn;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>…   </p><h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p>以上是与JCTree的初次会面，后续逐步进阶~</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;什么是-AST&quot;&gt;&lt;a href=&quot;#什么是-AST&quot; class=&quot;headerlink&quot; title=&quot;什么是 AST&quot;&gt;&lt;/a&gt;什么是 AST&lt;/h3&gt;&lt;p&gt;AST(Abstract Syntax Tree 抽象语法树)是一种用来描述程序代码语法结构的树形表
      
    
    </summary>
    
      <category term="java" scheme="http://blog.ymlsfly.xin/categories/java/"/>
    
      <category term="processor" scheme="http://blog.ymlsfly.xin/categories/java/processor/"/>
    
      <category term="annotation" scheme="http://blog.ymlsfly.xin/categories/java/processor/annotation/"/>
    
    
      <category term="processor" scheme="http://blog.ymlsfly.xin/tags/processor/"/>
    
  </entry>
  
  <entry>
    <title>进阶注解处理器 processor （一）</title>
    <link href="http://blog.ymlsfly.xin/2020/05/17/processor_one/"/>
    <id>http://blog.ymlsfly.xin/2020/05/17/processor_one/</id>
    <published>2020-05-17T01:25:19.657Z</published>
    <updated>2020-05-17T01:50:11.841Z</updated>
    
    <content type="html"><![CDATA[<h3 id="什么是-processor"><a href="#什么是-processor" class="headerlink" title="什么是 processor"></a>什么是 processor</h3><p>processor 顾名思义，就是一个处理器，java中有对注解做处理的注解处理器，我们知道，如果一个注解定义了，而没被使用，其就相当于一个普通的注释，而注解又分不同的生命周期   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RetentionPolicy.SOURCE</span><br><span class="line">RetentionPolicy.CLASS</span><br><span class="line">RetentionPolicy.RUNTIME</span><br></pre></td></tr></table></figure><p>SOURCE 生命周期的注解在编译期就会被丢弃，CLASS 生命周期的注解在类加载的时候被丢弃，RUNTIME 生命周期的注解始终不丢弃。<br>用过spring boot系列的同学就都知道，其ioc就是通过 运行期注解来实现的，本文中学习注解处理器使用的是编译期注解，在编译期来做一些事儿~</p><h3 id="怎么使用-processor"><a href="#怎么使用-processor" class="headerlink" title="怎么使用 processor"></a>怎么使用 processor</h3><p>1、新建一个要捕捉的编译期注解   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.SOURCE)</span><br><span class="line"><span class="meta">@Target</span>(ElementType.METHOD)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyAnn &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2、新建一个处理器，通过实现AbstractProcessor的process方法    </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.annotation.processing.AbstractProcessor;</span><br><span class="line"><span class="keyword">import</span> javax.annotation.processing.RoundEnvironment;</span><br><span class="line"><span class="keyword">import</span> javax.annotation.processing.SupportedAnnotationTypes;</span><br><span class="line"><span class="keyword">import</span> javax.annotation.processing.SupportedSourceVersion;</span><br><span class="line"><span class="keyword">import</span> javax.lang.model.SourceVersion;</span><br><span class="line"><span class="keyword">import</span> javax.lang.model.element.TypeElement;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SupportedSourceVersion</span>(SourceVersion.RELEASE_8)</span><br><span class="line"><span class="meta">@SupportedAnnotationTypes</span>(<span class="string">"com.jack.annotation.MyAnn"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyProcessor</span> <span class="keyword">extends</span> <span class="title">AbstractProcessor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">process</span><span class="params">(Set&lt;? extends TypeElement&gt; annotations, </span></span></span><br><span class="line"><span class="function"><span class="params">                           RoundEnvironment roundEnv)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>SupportedSourceVersion 中指定支持的jdk版本。<br>SupportedAnnotationTypes 中指定要捕捉的注解类。</p><p>3、配置pom文件，maven打包插件   </p><p>4、配置处理器暴露文件<br>在 resources 目录下新建 META-INF/services 目录，在 META-INF/services 目录下新建 javax.annotation.processing.Processor 文件，在此文件中写入自定义处理器 processor 的全路径，换行分隔。   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">com.jack.processor.MyProcessor</span><br></pre></td></tr></table></figure><p>5、编译打包   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean install -DskipTest=<span class="keyword">true</span></span><br></pre></td></tr></table></figure><p>6、在另一个工程中引入上面生成的 jar 包，使用其注解，然后编译代码即可。</p><p>tip：<br>如果不想通过打包 jar 来使用，也可以通过在一个工程中直接使用，但要求 processor 的编译一定要在使用此注解的编译之前，并且编译该类，要显示指定使用此注解处理器。   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">javac java/com/jack/annotation/MyAnn.java</span><br><span class="line">javac java/com/jack/processor/MyProcessor.java</span><br><span class="line">javac -processor com.jack.processor.MyProcessor com/jack/test/Test.java</span><br></pre></td></tr></table></figure><h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p>以上是与注解处理器的初次会面，后续逐步进阶~</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;什么是-processor&quot;&gt;&lt;a href=&quot;#什么是-processor&quot; class=&quot;headerlink&quot; title=&quot;什么是 processor&quot;&gt;&lt;/a&gt;什么是 processor&lt;/h3&gt;&lt;p&gt;processor 顾名思义，就是一个处理器，jav
      
    
    </summary>
    
      <category term="java" scheme="http://blog.ymlsfly.xin/categories/java/"/>
    
      <category term="processor" scheme="http://blog.ymlsfly.xin/categories/java/processor/"/>
    
      <category term="annotation" scheme="http://blog.ymlsfly.xin/categories/java/processor/annotation/"/>
    
    
      <category term="processor" scheme="http://blog.ymlsfly.xin/tags/processor/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="http://blog.ymlsfly.xin/2020/05/10/hello-world/"/>
    <id>http://blog.ymlsfly.xin/2020/05/10/hello-world/</id>
    <published>2020-05-10T07:00:05.672Z</published>
    <updated>2018-12-18T15:40:10.629Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><h4 id="hgjhgjg"><a href="#hgjhgjg" class="headerlink" title="hgjhgjg"></a>hgjhgjg</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.
      
    
    </summary>
    
      <category term="默认" scheme="http://blog.ymlsfly.xin/categories/%E9%BB%98%E8%AE%A4/"/>
    
    
      <category term="hello" scheme="http://blog.ymlsfly.xin/tags/hello/"/>
    
  </entry>
  
  <entry>
    <title>java中复合bean的copy工具类</title>
    <link href="http://blog.ymlsfly.xin/2020/05/10/CopyUtil/"/>
    <id>http://blog.ymlsfly.xin/2020/05/10/CopyUtil/</id>
    <published>2020-05-10T07:00:05.669Z</published>
    <updated>2019-09-22T06:15:41.300Z</updated>
    
    <content type="html"><![CDATA[<h3 id="诞生由来"><a href="#诞生由来" class="headerlink" title="诞生由来"></a>诞生由来</h3><p>之前项目里就经常有bean之间的属性copy，一直都是用spring自带的工具类来解决，方法如下：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.beans.BeanUtils#copyProperties(java.lang.Object, java.lang.Object);</span><br></pre></td></tr></table></figure></p><p>该方法只能对一个bean中普通属性字段进行copy，如果这个bean中有其他的bean，即bean中bean，就需要将其值取出，单独对这个子bean进行copy，然后set进父bean，这种copy如果在bean层次少的时候还无所谓，如果在bean的层次比较深的时候，就会发现很是繁琐了，最近遇到的项目里面有bean和bo的转换，其深度就有四五层，所以如果能想出一个新的工具类，能够一次性copy其bean中bena肯定最好不过了。</p><h3 id="以前用的简单包装工具类"><a href="#以前用的简单包装工具类" class="headerlink" title="以前用的简单包装工具类"></a>以前用的简单包装工具类</h3><ul><li>满足单层bean的copy。</li><li>满足单层bean集合的copy。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CopyUtil</span> </span>&#123;</span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"all"</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">copy</span><span class="params">(Object fromBean, Class&lt;T&gt; clz)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> InstantiationException, IllegalAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (fromBean == <span class="keyword">null</span> || clz == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        T result = clz.newInstance();</span><br><span class="line">        BeanUtils.copyProperties(fromBean, result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">List&lt;T&gt; <span class="title">copy</span><span class="params">(Collection&lt;?&gt; fromBeans, Class&lt;T&gt; cls)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> InstantiationException, IllegalAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (CollectionUtils.isEmpty(fromBeans) || <span class="keyword">null</span> == cls) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;T&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Object fromBean : fromBeans) &#123;</span><br><span class="line">            T t = copy(fromBean, cls);</span><br><span class="line">            <span class="keyword">if</span> (t != <span class="keyword">null</span>) &#123;</span><br><span class="line">                list.add(t);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="通过反射写出的新的一套工具类"><a href="#通过反射写出的新的一套工具类" class="headerlink" title="通过反射写出的新的一套工具类"></a>通过反射写出的新的一套工具类</h3><ul><li>满足单层bean的copy。</li><li>满足单层bean集合的copy。</li><li>满足多层bean的复合copy。</li></ul><h4 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h4><ul><li>获取fromBean中的属性字段，如果toBean中也有其属性字段，则继续下一步。</li><li>反射执行get/is获取其属性field，得到属性类型type，属性值fieldValue。</li><li>如果type是普通类型，则直接反射执行set方法将值写入toBean。</li><li>如果type是List集合类型，调用getFieldIfList获取对应toBean中的该属性值toList：<ul><li>获取这个List类型属性里面包裹的属性类型type_child。</li><li>如果type_child仍是List集合类型，递归调用getFieldIfList去掉List外壳，并将值add进其父List。</li><li>如果type_child不是集合类型，通过Class.forName获取其class：<ul><li>如果type_child是一般类型，直接将传进来的list值add进toList返回。</li><li>如果type_child是child_bean类型，遍历传进来的list，对其每个值又重新调用copy方法set进new出来的新child_bean实例中，返回。</li></ul></li></ul></li><li>如果type是Map类型，暂不考虑。</li><li><p>如果type不是以上类型（忽略考虑了java里面或者其他类里面定义的内置bean类型），判定为bean中bean类型：</p><ul><li><p>反射获取toBean中对应字段的class：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;?&gt; newToClass = toClass.getDeclaredField(field.getName()).getType();</span><br><span class="line">Object newToBean = newToClass.newInstance();</span><br></pre></td></tr></table></figure></li><li><p>再次调用copy方法将fieldValue写入newToBean，然后执行set方法将newToBean写入toBean。</p></li></ul></li><li>最终返回toBean即目标结果。</li></ul><h4 id="判断是否是普通字段属性"><a href="#判断是否是普通字段属性" class="headerlink" title="判断是否是普通字段属性"></a>判断是否是普通字段属性</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Author</span> fangyang</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Description</span> 返回该字段的类型是否是普通类型</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Date</span> 10:14 2019/9/21</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Param</span> [clazz]</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> boolean</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isNormalField</span><span class="params">(Class clazz)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> clazz == <span class="keyword">int</span>.class || clazz == String.class || clazz == <span class="keyword">float</span>.class</span><br><span class="line">        || clazz == <span class="keyword">double</span>.class || clazz == <span class="keyword">char</span>.class || clazz == <span class="keyword">byte</span>.class</span><br><span class="line">        || clazz == <span class="keyword">short</span>.class || clazz == Date.class || clazz == <span class="keyword">boolean</span>.class</span><br><span class="line">        || clazz == Integer.class || clazz == Float.class</span><br><span class="line">        || clazz == Double.class || clazz == Character.class || clazz == Byte.class</span><br><span class="line">        || clazz == Short.class || clazz == Boolean.class</span><br><span class="line">        || clazz == <span class="keyword">long</span>.class || clazz == Long.class;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="整体工具类"><a href="#整体工具类" class="headerlink" title="整体工具类"></a>整体工具类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: fangyang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2019/9/21 09:39</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CopyUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String LIST_STR = <span class="string">"java.util.List"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String SERIAL_FIELD_STR = <span class="string">"serialVersionUID"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> LIST_STR_LEN = <span class="string">"java.util.List"</span>.length();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"all"</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">copy</span><span class="params">(Object fromBean, Class&lt;T&gt; clz)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> NoSuchMethodException, InvocationTargetException, IllegalAccessException,</span></span><br><span class="line"><span class="function">            NoSuchFieldException, ClassNotFoundException, InstantiationException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (fromBean == <span class="keyword">null</span> || clz == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (isNormalField(clz)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (fromBean.getClass() == clz) &#123;</span><br><span class="line">                <span class="comment">// 类型一致</span></span><br><span class="line">                <span class="keyword">return</span> (T) fromBean;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"this fromBean is not "</span> + clz + <span class="string">" type"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> copy(fromBean, clz.newInstance());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">List&lt;T&gt; <span class="title">copy</span><span class="params">(Collection&lt;?&gt; fromBeans, Class&lt;T&gt; cls)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> NoSuchMethodException, InvocationTargetException, IllegalAccessException,</span></span><br><span class="line"><span class="function">            NoSuchFieldException, ClassNotFoundException, InstantiationException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (CollectionUtils.isEmpty(fromBeans) || <span class="keyword">null</span> == cls) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;T&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Object fromBean : fromBeans) &#123;</span><br><span class="line">            T t = copy(fromBean, cls);</span><br><span class="line">            <span class="keyword">if</span> (t != <span class="keyword">null</span>) &#123;</span><br><span class="line">                list.add(t);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span> fangyang</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span> 要求 bean 中对应字段的属性名必须一致，普通类型字段要求字段类型一致</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span> 10:12 2019/9/21</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Param</span> [fromBean, toBean] 从 fromBean 复制到 toBean</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> E</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"all"</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T, E&gt; <span class="function">E <span class="title">copy</span><span class="params">(Object fromBean, E toBean)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> NoSuchMethodException, InvocationTargetException, IllegalAccessException,</span></span><br><span class="line"><span class="function">            NoSuchFieldException, ClassNotFoundException, InstantiationException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (fromBean == <span class="keyword">null</span> || toBean == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        Class&lt;?&gt; fromClass = fromBean.getClass();</span><br><span class="line">        Class&lt;?&gt; toClass = toBean.getClass();</span><br><span class="line">        <span class="keyword">for</span> (Field field : fromClass.getDeclaredFields()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (field.getName().equals(SERIAL_FIELD_STR)) &#123;</span><br><span class="line">                <span class="comment">// 序列化字段，忽略</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (toClass.getDeclaredField(field.getName()) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// toClass 中没有该属性字段</span></span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (isNormalField(field.getType())</span><br><span class="line">                        &amp;&amp; toClass.getDeclaredField(field.getName()).getType() != field.getType()) &#123;</span><br><span class="line">                    <span class="comment">// 属性是普通字段，且二者对应属性字段的类型不同</span></span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            String getMethodName = <span class="string">"get"</span> + StringUtils.capitalize(field.getName());</span><br><span class="line">            String setMethodName = <span class="string">"set"</span> + StringUtils.capitalize(field.getName());</span><br><span class="line">            String isMethodName = <span class="string">"is"</span> + StringUtils.capitalize(field.getName());</span><br><span class="line">            Object fieldValue;</span><br><span class="line">            <span class="keyword">if</span> (field.getType() == <span class="keyword">boolean</span>.class || field.getType() == Boolean.class) &#123;</span><br><span class="line">                <span class="comment">// boolean 类型</span></span><br><span class="line">                fieldValue = fromClass.getDeclaredMethod(isMethodName).invoke(fromBean);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                fieldValue = fromClass.getDeclaredMethod(getMethodName).invoke(fromBean);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> == fieldValue) &#123;</span><br><span class="line">                <span class="comment">// fromBean 无此属性值</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (isNormalField(field.getType())) &#123;</span><br><span class="line">                Method method = toClass.getDeclaredMethod(setMethodName, field.getType());</span><br><span class="line">                method.invoke(toBean, fieldValue);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (field.getType() == List.class) &#123;</span><br><span class="line">                List&lt;T&gt; list = (List&lt;T&gt;) fieldValue;</span><br><span class="line">                String str = toClass.getDeclaredField(field.getName()).getGenericType().toString();</span><br><span class="line">                List&lt;Object&gt; toList = getFieldIfList(list, str);</span><br><span class="line">                Method method = toClass.getDeclaredMethod(setMethodName, List.class);</span><br><span class="line">                method.invoke(toBean, toList);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (field.getType() == Map.class)&#123;</span><br><span class="line">                <span class="comment">// TODO Map 暂不处理</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// bean 中 bean</span></span><br><span class="line">                Class&lt;?&gt; newToClass = toClass.getDeclaredField(field.getName()).getType();</span><br><span class="line">                Object newToBean = newToClass.newInstance();</span><br><span class="line">                copy(fieldValue, newToBean);</span><br><span class="line">                Method method = toClass.getDeclaredMethod(setMethodName, newToClass);</span><br><span class="line">                method.invoke(toBean, newToBean);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> toBean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span> fangyang</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span> 获取当源属性类型是 &#123;<span class="doctag">@link</span> List&#125; 时的目标属性值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span> 12:13 2019/9/22</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Param</span> [list, toBeanClassStr]</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> java.util.List&lt;java.lang.Object&gt;</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"all"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> &lt;T, E&gt; <span class="function">List&lt;Object&gt; <span class="title">getFieldIfList</span><span class="params">(List&lt;T&gt; list, String toBeanClassStr)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> IllegalAccessException, InstantiationException, ClassNotFoundException,</span></span><br><span class="line"><span class="function">            NoSuchMethodException, NoSuchFieldException, InvocationTargetException </span>&#123;</span><br><span class="line">        String newBeanClassStr = toBeanClassStr.substring(LIST_STR_LEN + <span class="number">1</span>,</span><br><span class="line">                toBeanClassStr.length() - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (newBeanClassStr.contains(LIST_STR)) &#123;</span><br><span class="line">            List&lt;Object&gt; result = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            <span class="keyword">for</span> (T t : list) &#123;</span><br><span class="line">                <span class="comment">// 递归去掉 list 外壳</span></span><br><span class="line">                List&lt;Object&gt; toT = getFieldIfList((List&lt;E&gt;) t, newBeanClassStr);</span><br><span class="line">                result.add(toT);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        Class&lt;?&gt; toBeanClass = Class.forName(newBeanClassStr);</span><br><span class="line">        List&lt;Object&gt; toList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (isNormalField(toBeanClass)) &#123;</span><br><span class="line">            <span class="comment">// 说明 list 里面的元素是一般属性字段</span></span><br><span class="line">            toList.addAll(list);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (T t : list) &#123;</span><br><span class="line">                Object toT = copy(t, toBeanClass.newInstance());</span><br><span class="line">                toList.add(toT);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> toList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span> fangyang</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span> 返回该字段的类型是否是普通类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span> 10:14 2019/9/21</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Param</span> [clazz]</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> boolean</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isNormalField</span><span class="params">(Class clazz)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> clazz == <span class="keyword">int</span>.class || clazz == String.class || clazz == <span class="keyword">float</span>.class</span><br><span class="line">                || clazz == <span class="keyword">double</span>.class || clazz == <span class="keyword">char</span>.class || clazz == <span class="keyword">byte</span>.class</span><br><span class="line">                || clazz == <span class="keyword">short</span>.class || clazz == Date.class || clazz == <span class="keyword">boolean</span>.class</span><br><span class="line">                || clazz == Integer.class || clazz == Float.class</span><br><span class="line">                || clazz == Double.class || clazz == Character.class || clazz == Byte.class</span><br><span class="line">                || clazz == Short.class || clazz == Boolean.class</span><br><span class="line">                || clazz == <span class="keyword">long</span>.class || clazz == Long.class;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="简单测试"><a href="#简单测试" class="headerlink" title="简单测试"></a>简单测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Bean1</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Bean1_1&gt; list;</span><br><span class="line">    <span class="keyword">private</span> Bean1_2 testBean;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; aList;</span><br><span class="line">    <span class="keyword">private</span> List&lt;List&lt;Integer&gt;&gt; bList;</span><br><span class="line">    <span class="keyword">private</span> List&lt;List&lt;Bean1_3&gt;&gt; cList;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Bean2</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Bean2_1&gt; list;</span><br><span class="line">    <span class="keyword">private</span> Bean2_2 testBean;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; aList;</span><br><span class="line">    <span class="keyword">private</span> List&lt;List&lt;Integer&gt;&gt; bList;</span><br><span class="line">    <span class="keyword">private</span> List&lt;List&lt;Bean2_3&gt;&gt; cList;</span><br><span class="line">&#125;</span><br><span class="line">... 里面都是一些简单的bean，就不一一展开</span><br></pre></td></tr></table></figure><p>main方法简单set值进行copy，打印对比测试：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Bean1(name=aaa, list=[Bean1_1(name=name0, id=<span class="number">6</span>, testBean=[Bean1_1_1(age=<span class="number">17</span>, birthday=Sun Sep <span class="number">22</span> <span class="number">14</span>:<span class="number">11</span>:<span class="number">47</span> CST <span class="number">2019</span>), Bean1_1_1(age=<span class="number">16</span>, birthday=Sun Sep <span class="number">22</span> <span class="number">14</span>:<span class="number">11</span>:<span class="number">47</span> CST <span class="number">2019</span>)], success=<span class="keyword">true</span>), Bean1_1(name=name1, id=<span class="number">0</span>, testBean=[Bean1_1_1(age=<span class="number">15</span>, birthday=Sun Sep <span class="number">22</span> <span class="number">14</span>:<span class="number">11</span>:<span class="number">47</span> CST <span class="number">2019</span>), Bean1_1_1(age=<span class="number">15</span>, birthday=Sun Sep <span class="number">22</span> <span class="number">14</span>:<span class="number">11</span>:<span class="number">47</span> CST <span class="number">2019</span>)], success=<span class="keyword">true</span>)], testBean=Bean1_2(test=<span class="number">100</span>), aList=[a1, a2], bList=[[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">1</span>, <span class="number">2</span>]], cList=[[Bean1_3(id=<span class="number">10</span>), Bean1_3(id=<span class="number">10</span>), Bean1_3(id=<span class="number">10</span>)], [Bean1_3(id=<span class="number">11</span>), Bean1_3(id=<span class="number">11</span>), Bean1_3(id=<span class="number">11</span>)]])</span><br><span class="line">Bean2(name=aaa, list=[Bean2_1(name=name0, id=<span class="number">6</span>, testBean=[Bean2_1_1(age=<span class="number">17</span>, birthday=Sun Sep <span class="number">22</span> <span class="number">14</span>:<span class="number">11</span>:<span class="number">47</span> CST <span class="number">2019</span>), Bean2_1_1(age=<span class="number">16</span>, birthday=Sun Sep <span class="number">22</span> <span class="number">14</span>:<span class="number">11</span>:<span class="number">47</span> CST <span class="number">2019</span>)], success=<span class="keyword">true</span>), Bean2_1(name=name1, id=<span class="number">0</span>, testBean=[Bean2_1_1(age=<span class="number">15</span>, birthday=Sun Sep <span class="number">22</span> <span class="number">14</span>:<span class="number">11</span>:<span class="number">47</span> CST <span class="number">2019</span>), Bean2_1_1(age=<span class="number">15</span>, birthday=Sun Sep <span class="number">22</span> <span class="number">14</span>:<span class="number">11</span>:<span class="number">47</span> CST <span class="number">2019</span>)], success=<span class="keyword">true</span>)], testBean=Bean2_2(test=<span class="number">100</span>), aList=[a1, a2], bList=[[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">1</span>, <span class="number">2</span>]], cList=[[Bean2_3(id=<span class="number">10</span>), Bean2_3(id=<span class="number">10</span>), Bean2_3(id=<span class="number">10</span>)], [Bean2_3(id=<span class="number">11</span>), Bean2_3(id=<span class="number">11</span>), Bean2_3(id=<span class="number">11</span>)]])</span><br></pre></td></tr></table></figure></p><h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p>以上为博主应需写出的工具类，肯定不尽完美，读者发现有问题，可以提出来，博主很乐意一直完善该工具类~</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;诞生由来&quot;&gt;&lt;a href=&quot;#诞生由来&quot; class=&quot;headerlink&quot; title=&quot;诞生由来&quot;&gt;&lt;/a&gt;诞生由来&lt;/h3&gt;&lt;p&gt;之前项目里就经常有bean之间的属性copy，一直都是用spring自带的工具类来解决，方法如下：&lt;br&gt;&lt;figure c
      
    
    </summary>
    
      <category term="java" scheme="http://blog.ymlsfly.xin/categories/java/"/>
    
      <category term="copy" scheme="http://blog.ymlsfly.xin/categories/java/copy/"/>
    
    
      <category term="Copy-util" scheme="http://blog.ymlsfly.xin/tags/Copy-util/"/>
    
  </entry>
  
  <entry>
    <title>面试(one) 某一次一面</title>
    <link href="http://blog.ymlsfly.xin/2019/02/24/%E9%9D%A2%E8%AF%95(one)/"/>
    <id>http://blog.ymlsfly.xin/2019/02/24/面试(one)/</id>
    <published>2019-02-24T15:11:59.000Z</published>
    <updated>2019-02-25T16:18:17.290Z</updated>
    
    <content type="html"><![CDATA[<hr><h1 id="Spring的ioc和aop是怎么实现的？"><a href="#Spring的ioc和aop是怎么实现的？" class="headerlink" title="Spring的ioc和aop是怎么实现的？"></a>Spring的ioc和aop是怎么实现的？</h1><h2 id="IOC（Inverse-Of-Control）控制反转"><a href="#IOC（Inverse-Of-Control）控制反转" class="headerlink" title="IOC（Inverse Of Control）控制反转"></a>IOC（Inverse Of Control）控制反转</h2><p>也同DI（Dependency Injection）依赖注入。<br>将对在自身对象中的一个内置对象的控制反转，反转后不再由自己本身的对象进行控制这个内置对象的创建，而是由第三方系统去控制这个内置对象的创建。<br>实现：<br>（1）将bean之间的依赖关系尽可能地抓换为关联关系；<br>（2）将对具体类的关联尽可能地转换为对Java interface的关联，而不是与具体的服务对象相关联；<br>（3）Bean实例具体关联相关java interface的哪个实现类的实例，在配置信息的元数据中描述；<br>（4）由IoC组件（或称容器）根据配置信息，实例化具体bean类、将bean之间的依赖关系注入进来。   </p><h2 id="AOP（Aspect-Oriented-Programming）面向切面编程。"><a href="#AOP（Aspect-Oriented-Programming）面向切面编程。" class="headerlink" title="AOP（Aspect Oriented Programming）面向切面编程。"></a>AOP（Aspect Oriented Programming）面向切面编程。</h2><p>当前已经成为一种比较成熟的编程思想，可以用来很好的解决应用系统中分布于各个模块的交叉关注点问题。在轻量级的J2EE中应用开发中，使用AOP来灵活处理一些具有横切性质的系统级服务，如事务处理、安全检查、缓存、对象池管理等，已经成为一种非常适用的解决方案。 AOP中比较重要的概念有：Aspect、JoinPoint、PonitCut、Advice、Introduction、Weave、Target Object、Proxy Object等。   </p><h1 id="tcp的三次握手？"><a href="#tcp的三次握手？" class="headerlink" title="tcp的三次握手？"></a>tcp的三次握手？</h1><p>首先由Client发出请求连接即 SYN=1 ACK=0，TCP规定SYN=1时不能携带数据，但要消耗一个序号,因此声明自己的序号是 seq=x。然后 Server 进行回复确认，即 SYN=1 ACK=1 seq=y，ack=x+1。再然后 Client 再进行一次确认，但不用SYN 了，这时即为 ACK=1, seq=x+1，ack=y+1。</p><h1 id="tcp的状态？"><a href="#tcp的状态？" class="headerlink" title="tcp的状态？"></a>tcp的状态？</h1><p>tcp的11种状态：</p><ol><li>CLOSED：初始状态，表示TCP连接是“关闭着的”或“未打开的”。</li><li>LISTEN ：表示服务器端的某个SOCKET处于监听状态，可以接受客户端的连接。</li><li>SYN_RCVD ：表示服务器接收到了来自客户端请求连接的SYN报文。在正常情况下，这个状态是服务器端的SOCKET在建立TCP连接时的三次握手会话过程中的一个中间状态，很短暂，基本上用netstat很难看到这种状态，除非故意写一个监测程序，将三次TCP握手过程中最后一个ACK报文不予发送。当TCP连接处于此状态时，再收到客户端的ACK报文，它就会进入到ESTABLISHED 状态。</li><li>SYN_SENT ：这个状态与SYN_RCVD 状态相呼应，当客户端SOCKET执行connect()进行连接时，它首先发送SYN报文，然后随即进入到SYN_SENT 状态，并等待服务端的发送三次握手中的第2个报文。SYN_SENT 状态表示客户端已发送SYN报文。</li><li>ESTABLISHED ：表示TCP连接已经成功建立。</li><li>FIN_WAIT_1 ：这个状态得好好解释一下，其实FIN_WAIT_1 和FIN_WAIT_2 两种状态的真正含义都是表示等待对方的FIN报文。而这两种状态的区别是：FIN_WAIT_1状态实际上是当SOCKET在ESTABLISHED状态时，它想主动关闭连接，向对方发送了FIN报文，此时该SOCKET进入到FIN_WAIT_1 状态。而当对方回应ACK报文后，则进入到FIN_WAIT_2 状态。当然在实际的正常情况下，无论对方处于任何种情况下，都应该马上回应ACK报文，所以FIN_WAIT_1 状态一般是比较难见到的，而FIN_WAIT_2 状态有时仍可以用netstat看到。</li><li>FIN_WAIT_2 ：上面已经解释了这种状态的由来，实际上FIN_WAIT_2状态下的SOCKET表示半连接，即有一方调用close()主动要求关闭连接。注意：FIN_WAIT_2 是没有超时的（不像TIME_WAIT 状态），这种状态下如果对方不关闭（不配合完成4次挥手过程），那这个 FIN_WAIT_2 状态将一直保持到系统重启，越来越多的FIN_WAIT_2 状态会导致内核crash。</li><li>TIME_WAIT ：表示收到了对方的FIN报文，并发送出了ACK报文。 TIME_WAIT状态下的TCP连接会等待2*MSL（Max Segment Lifetime，最大分段生存期，指一个TCP报文在Internet上的最长生存时间。每个具体的TCP协议实现都必须选择一个确定的MSL值，RFC 1122建议是2分钟，但BSD传统实现采用了30秒，Linux可以cat /proc/sys/net/ipv4/tcp_fin_timeout看到本机的这个值），然后即可回到CLOSED 可用状态了。如果FIN_WAIT_1状态下，收到了对方同时带FIN标志和ACK标志的报文时，可以直接进入到TIME_WAIT状态，而无须经过FIN_WAIT_2状态。（这种情况应该就是四次挥手变成三次挥手的那种情况）</li><li>CLOSING ：这种状态在实际情况中应该很少见，属于一种比较罕见的例外状态。正常情况下，当一方发送FIN报文后，按理来说是应该先收到（或同时收到）对方的ACK报文，再收到对方的FIN报文。但是CLOSING 状态表示一方发送FIN报文后，并没有收到对方的ACK报文，反而却也收到了对方的FIN报文。什么情况下会出现此种情况呢？那就是当双方几乎在同时close()一个SOCKET的话，就出现了双方同时发送FIN报文的情况，这是就会出现CLOSING 状态，表示双方都正在关闭SOCKET连接。</li><li>CLOSE_WAIT ：表示正在等待关闭。怎么理解呢？当对方close()一个SOCKET后发送FIN报文给自己，系统毫无疑问地将会回应一个ACK报文给对方，此时TCP连接则进入到CLOSE_WAIT状态。接下来呢，需要检查自己是否还有数据要发送给对方，如果没有的话，也就可以close()这个SOCKET并发送FIN报文给对方，即关闭自己到对方这个方向的连接。有数据的话则看程序的策略，继续发送或丢弃。简单地说，当处于CLOSE_WAIT 状态下，需要完成的事情是等待你去关闭连接。</li><li>LAST_ACK ：当被动关闭的一方在发送FIN报文后，等待对方的ACK报文的时候，就处于LAST_ACK 状态。当收到对方的ACK报文后，也就可以进入到CLOSED 可用状态了。</li></ol><h1 id="servlet中的get和post方法有哪些区别？"><a href="#servlet中的get和post方法有哪些区别？" class="headerlink" title="servlet中的get和post方法有哪些区别？"></a>servlet中的get和post方法有哪些区别？</h1><ol><li>GET中的总字符数是有限的。</li><li>GET发送的数据会追加到URL的后面。</li><li>GET请求可以建立书签。</li><li>GET请求是幂等的，不会修改服务器上的任何内容，能执行多次而不会产生不好的副作用。</li><li>POST不是幂等的，POST提交的数据可能用于不可逆转的事务。</li><li>POST发送的数据是可以很大的，理论不受限，例如可以传文件。</li><li>POST将表单内的数据放置在HTML HEADER内一起传送所指的URL地址。是对用户透明的。</li><li>GET安全性非常低，POST安全性较高。但是执行效率却比POST方法好。</li></ol><h1 id="什么是高并发？"><a href="#什么是高并发？" class="headerlink" title="什么是高并发？"></a>什么是高并发？</h1><p>高并发（High Concurrency）是互联网分布式系统架构设计中必须考虑的因素之一，它通常是指，通过设计保证系统能够同时并行处理很多请求。高并发相关常用的一些指标有响应时间（Response Time），吞吐量（Throughput），每秒查询率QPS（Query Per Second），并发用户数等。</p><h1 id="什么是线程？"><a href="#什么是线程？" class="headerlink" title="什么是线程？"></a>什么是线程？</h1><p>有时被称为轻量进程(Lightweight Process，LWP），是程序执行流的最小单元。一个标准的线程由线程ID，当前指令指针(PC），寄存器集合和堆栈组成。另外，线程是进程中的一个实体，是被系统独立调度和分派的基本单位。</p><h1 id="线程有哪些状态？"><a href="#线程有哪些状态？" class="headerlink" title="线程有哪些状态？"></a>线程有哪些状态？</h1><ol><li>创建状态。在生成线程对象，并没有调用该对象的start方法，这是线程处于创建状态。</li><li>就绪状态。当调用了线程对象的start方法之后，该线程就进入了就绪状态，但是此时线程调度程序还没有把该线程设置为当前线程，此时处于就绪状态。在线程运行之后，从等待或者睡眠中回来之后，也会处于就绪状态。</li><li>运行状态。线程调度程序将处于就绪状态的线程设置为当前线程，此时线程就进入了运行状态，开始运行run函数当中的代码。</li><li>阻塞状态。线程正在运行的时候，被暂停，通常是为了等待某个事件的发生(比如说某项资源就绪)之后再继续运行。sleep，suspend，wait等方法都可以导致线程阻塞。</li><li>死亡状态。如果一个线程的run方法执行结束或者调用stop方法后，该线程就会死亡。对于已经死亡的线程，无法再使用start方法令其进入就绪。</li></ol><h1 id="什么情况下用到多线程？"><a href="#什么情况下用到多线程？" class="headerlink" title="什么情况下用到多线程？"></a>什么情况下用到多线程？</h1><ol><li><p>程序包含复杂的计算任务时<br>主要是利用多线程获取更多的CPU时间（资源）。</p></li><li><p>处理速度较慢的外围设备<br>比如：打印时。再比如网络程序，涉及数据包的收发，时间因素不定。使用独立的线程处理这些任务，可使程序无需专门等待结果。</p></li><li><p>程序设计自身的需要<br>WINDOWS系统是基于消息循环的抢占式多任务系统，为使消息循环系统不至于阻塞，程序需要多个线程的来共同完成某些任务。</p></li></ol><h1 id="有哪些锁？"><a href="#有哪些锁？" class="headerlink" title="有哪些锁？"></a>有哪些锁？</h1><p>锁分类：</p><ol><li>公平锁/非公平锁</li><li>可重入锁</li><li>独享锁/共享锁</li><li>互斥锁/读写锁</li><li>乐观锁/悲观锁</li><li>分段锁</li><li>偏向锁/轻量级锁/重量级锁</li><li>自旋锁</li></ol><h1 id="ReentrantLock和synchronized的区别？"><a href="#ReentrantLock和synchronized的区别？" class="headerlink" title="ReentrantLock和synchronized的区别？"></a>ReentrantLock和synchronized的区别？</h1><ol><li>synchronized是托管给JVM执行的，而Lock是Java写的控制锁的代码。 </li><li>synchronized原始采用的是CPU悲观锁机制，即线程获得的是独占锁。独占锁意味着其他线程只能依靠阻塞来等待线程释放锁。而在CPU转换线程阻塞时会引起线程上下文切换，当有很多线程竞争锁的时候，会引起CPU频繁的上下文切换导致效率很低。　 </li><li>Lock用的是乐观锁方式。每次不加锁而是假设没有冲突而去完成某项操作，如果因为冲突失败就重试，直到成功为止。 </li><li>ReentrantLock必须在finally中释放锁，否则后果很严重，编码角度来说使用synchronized更加简单，不容易遗漏或者出错。 </li><li>ReentrantLock提供了可轮询的锁请求，他可以尝试的去取得锁，如果取得成功则继续处理，取得不成功，可以等下次运行的时候处理，所以不容易产生死锁，而synchronized则一旦进入锁请求要么成功，要么一直阻塞，所以更容易产生死锁。 </li><li>synchronized的话，锁的范围是整个方法或synchronized块部分；而Lock因为是方法调用，可以跨方法，灵活性更大。</li></ol><h1 id="什么是悲观锁和乐观锁？"><a href="#什么是悲观锁和乐观锁？" class="headerlink" title="什么是悲观锁和乐观锁？"></a>什么是悲观锁和乐观锁？</h1><h2 id="悲观锁："><a href="#悲观锁：" class="headerlink" title="悲观锁："></a>悲观锁：</h2><p>总是假设最坏的情况，每次去拿数据的时候都认为别人会修改，所以每次在拿数据的时候都会上锁，这样别人想拿这个数据就会阻塞直到它拿到锁。传统的关系型数据库里边就用到了很多这种锁机制，比如行锁，表锁等，读锁，写锁等，都是在做操作之前先上锁。再比如Java里面的同步原语synchronized关键字的实现也是悲观锁。   </p><h2 id="乐观锁："><a href="#乐观锁：" class="headerlink" title="乐观锁："></a>乐观锁：</h2><p>顾名思义，就是很乐观，每次去拿数据的时候都认为别人不会修改，所以不会上锁，但是在更新的时候会判断一下在此期间别人有没有去更新这个数据，可以使用版本号等机制。乐观锁适用于多读的应用类型，这样可以提高吞吐量，像数据库提供的类似于write_condition机制，其实都是提供的乐观锁。在Java中java.util.concurrent.atomic包下面的原子变量类就是使用了乐观锁的一种实现方式CAS实现的。   </p><h1 id="java中哪些容器是线程安全的，例如vector？"><a href="#java中哪些容器是线程安全的，例如vector？" class="headerlink" title="java中哪些容器是线程安全的，例如vector？"></a>java中哪些容器是线程安全的，例如vector？</h1><h2 id="同步容器类：使用了synchronized"><a href="#同步容器类：使用了synchronized" class="headerlink" title="同步容器类：使用了synchronized"></a>同步容器类：使用了synchronized</h2><ol><li>Vector</li><li>HashTable<br>并发容器：</li><li>ConcurrentHashMap:分段</li><li>CopyOnWriteArrayList：写时复制</li><li>CopyOnWriteArraySet：写时复制<h2 id="Queue"><a href="#Queue" class="headerlink" title="Queue:"></a>Queue:</h2></li><li>ConcurrentLinkedQueue：是使用非阻塞的方式实现的基于链接节点的无界的线程安全队列，性能非常好。<br>（java.util.concurrent.BlockingQueue 接口代表了线程安全的队列。）</li><li>ArrayBlockingQueue：基于数组的有界阻塞队列</li><li>LinkedBlockingQueue：基于链表的有界阻塞队列。</li><li>PriorityBlockingQueue：支持优先级的无界阻塞队列，即该阻塞队列中的元素可自动排序。默认情况下，元素采取自然升序排列</li><li>DelayQueue：一种延时获取元素的无界阻塞队列。</li><li>SynchronousQueue：不存储元素的阻塞队列。每个put操作必须等待一个take操作，否则不能继续添加元素。内部其实没有任何一个元素，容量是0<h2 id="Deque"><a href="#Deque" class="headerlink" title="Deque:"></a>Deque:</h2>(Deque接口定义了双向队列。双向队列允许在队列头和尾部进行入队出队操作。)</li><li>ArrayDeque:基于数组的双向非阻塞队列。</li><li>LinkedBlockingDeque:基于链表的双向阻塞队列。<h2 id="Sorted容器："><a href="#Sorted容器：" class="headerlink" title="Sorted容器："></a>Sorted容器：</h2></li><li>ConcurrentSkipListMap：是TreeMap的线程安全版本</li><li>ConcurrentSkipListSet：是TreeSet的线程安全版本</li></ol><h1 id="oracle的分页举例？"><a href="#oracle的分页举例？" class="headerlink" title="oracle的分页举例？"></a>oracle的分页举例？</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> </span><br><span class="line">( <span class="keyword">SELECT</span> <span class="keyword">ROWNUM</span> r, t1.* <span class="keyword">FROM</span> student t1 <span class="keyword">WHERE</span> <span class="keyword">ROWNUM</span> &lt; <span class="number">20</span> ) t2</span><br><span class="line"><span class="keyword">where</span> t2.r &gt;= <span class="number">15</span>;</span><br></pre></td></tr></table></figure><h1 id="数据库有哪些优化方式？"><a href="#数据库有哪些优化方式？" class="headerlink" title="数据库有哪些优化方式？"></a>数据库有哪些优化方式？</h1><ol><li>索引</li><li>分库分表分区</li><li>数据库引擎</li><li>预处理</li><li>mysql like查询</li><li>读写分离</li></ol><h1 id="什么是数据库的脏读，怎么防止脏读？"><a href="#什么是数据库的脏读，怎么防止脏读？" class="headerlink" title="什么是数据库的脏读，怎么防止脏读？"></a>什么是数据库的脏读，怎么防止脏读？</h1><p>脏读就是指读到还没完全弄好的数据。比如，你要读取数据库中的字段A、字段B，你读取时恰巧有其他用户正在更新这2个字段，而且是先更新A、再更新B，此时就可能会发生脏读：</p><ol><li>如果都未更新你就读取了，或者都更新完了你才读取，这都不是脏读，因为你得到的是更新前的有效值，或完全更新后的值。</li><li>如果那个用户更新一半你就读取了，也就是说更新了A，正打算要更新B但尚未更新时，你就读取了，此时你得到的就是脏数据。  </li></ol><p>避免脏读的办法就是采取事务，使得他用户正在更新时锁定数据库，阻止你读取，直至全部完成才让你读取。</p><h1 id="springboot运行是执行哪个文件就行了？"><a href="#springboot运行是执行哪个文件就行了？" class="headerlink" title="springboot运行是执行哪个文件就行了？"></a>springboot运行是执行哪个文件就行了？</h1><p>运行的是【工程名字+Application.java】这个文件。</p><h1 id="java使用哪个命令运行jar包？"><a href="#java使用哪个命令运行jar包？" class="headerlink" title="java使用哪个命令运行jar包？"></a>java使用哪个命令运行jar包？</h1><ol><li>java -cp<br>java -cp 和 -classpath 一样，是指定类运行所依赖其他类的路径，通常是类库，jar包之类，需要全路径到jar包，<br>window上分号“;”<br>linux上分号“:”<br>java -cp .;myClass.jar packname.mainclassname<br>表达式支持通配符，例如：<br>java -cp .;c:\classes01\myClass.jar;c:\classes02*.jar  packname.mainclassname<br>java -cp lib/<em>;etc/ com.Start param1 param2<br>将lib下的所有jar文件以及etc下的所有配置文件添加到 classpath 中<br>并在classpath 中寻找 com.Start类（main方法类）并运行<br>param1，param2 为main方法的参数可不填<br>注意：jar 文件引入classpath，通配符不能写成 </em>.jar， 只能使用 <em> 或 123</em><br>注意：配置文件引入classpath，只能写到目录 /， 不能添加 *    </li><li>java -jar<br>java -jar myClass.jar<br>执行该命令时，会用到目录META-INF\MANIFEST.MF文件，<br>在该文件中，有一个叫Main－Class的参数，它说明了java -jar命令执行的类<br>java -jar  *.jar param1 param2<br>运行jar包，会自动到 jar 包中查询mainfest中定义的启动类并运行<br>param1，param2 为main方法的参数可不填   </li></ol><h1 id="linux上查询进程服务的命令？"><a href="#linux上查询进程服务的命令？" class="headerlink" title="linux上查询进程服务的命令？"></a>linux上查询进程服务的命令？</h1><p>ps aux</p><h1 id="linux上程序运行cpu过高，使用哪个命令定位到导致其的代码位置？"><a href="#linux上程序运行cpu过高，使用哪个命令定位到导致其的代码位置？" class="headerlink" title="linux上程序运行cpu过高，使用哪个命令定位到导致其的代码位置？"></a>linux上程序运行cpu过高，使用哪个命令定位到导致其的代码位置？</h1><p>jstack是java虚拟机自带的一种堆栈跟踪工具。jstack用于打印出给定的java进程ID或core file或远程调试服务的Java堆栈信息，如果是在64位机器上，需要指定选项”-J-d64”，Windows的jstack使用方式只支持以下的这种方式：<br>jstack [-l] pid<br>主要分为两个功能：   </p><ol><li>针对活着的进程做本地的或远程的线程dump； </li><li>针对core文件做线程dump。<br>jstack用于生成java虚拟机当前时刻的线程快照。线程快照是当前java虚拟机内每一条线程正在执行的方法堆栈的集合，生成线程快照的主要目的是定位线程出现长时间停顿的原因，如线程间死锁、死循环、请求外部资源导致的长时间等待等。 线程出现停顿的时候通过jstack来查看各个线程的调用堆栈，就可以知道没有响应的线程到底在后台做什么事情，或者等待什么资源。 如果java程序崩溃生成core文件，jstack工具可以用来获得core文件的java stack和native stack的信息，从而可以轻松地知道java程序是如何崩溃和在程序何处发生问题。另外，jstack工具还可以附属到正在运行的java程序中，看到当时运行的java程序的java stack和native stack的信息, 如果现在运行的java程序呈现hung的状态，jstack是非常有用的。</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;hr&gt;
&lt;h1 id=&quot;Spring的ioc和aop是怎么实现的？&quot;&gt;&lt;a href=&quot;#Spring的ioc和aop是怎么实现的？&quot; class=&quot;headerlink&quot; title=&quot;Spring的ioc和aop是怎么实现的？&quot;&gt;&lt;/a&gt;Spring的ioc和aop是怎么实
      
    
    </summary>
    
      <category term="面试" scheme="http://blog.ymlsfly.xin/categories/%E9%9D%A2%E8%AF%95/"/>
    
    
      <category term="面试" scheme="http://blog.ymlsfly.xin/tags/%E9%9D%A2%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>effect_java_study</title>
    <link href="http://blog.ymlsfly.xin/2018/12/19/effect-java-study/"/>
    <id>http://blog.ymlsfly.xin/2018/12/19/effect-java-study/</id>
    <published>2018-12-19T14:07:07.000Z</published>
    <updated>2018-12-22T08:18:37.877Z</updated>
    
    <content type="html"><![CDATA[<h2 id="effect-java学习笔记"><a href="#effect-java学习笔记" class="headerlink" title="effect-java学习笔记"></a>effect-java学习笔记</h2><h4 id="基本类型和装箱类型的选择"><a href="#基本类型和装箱类型的选择" class="headerlink" title="基本类型和装箱类型的选择"></a>基本类型和装箱类型的选择</h4><ul><li>优先使用基本类型而不是装箱的基本类型，也要注意无意识的自动装箱。</li></ul><h4 id="警惕内存泄露"><a href="#警惕内存泄露" class="headerlink" title="警惕内存泄露"></a>警惕内存泄露</h4><ul><li>清空对象引用应该是例外而不是规范。</li><li>当一个类自己管理内存时，程序员应该警惕内存泄漏问题。另一个常见的内存泄漏来源是缓存。</li></ul><h4 id="重写equals方法必须遵守的规定"><a href="#重写equals方法必须遵守的规定" class="headerlink" title="重写equals方法必须遵守的规定"></a>重写equals方法必须遵守的规定</h4><p>equals方法实现了一个等价关系（equivalence relation）。它有以下这些属性:</p><ul><li>自反性：对于任何非空引用x，x.equals(x)必须返回true。</li><li>对称性：对于任何非空引用x和y，如果且仅当y.equals(x)返回true时x.equals(y)必须返回true。</li><li>传递性：对于任何非空引用x、y、z，如果x.equals(y)返回true，y.equals(z)返回true，则x.equals(z)必须返回true。</li><li>一致性：对于任何非空引用x和y，如果在equals比较中使用的信息没有修改，则x.equals(y)的多次调用必须始终返回true或始终返回false。</li><li>对于任何非空引用x，x.equals(null)必须返回false。</li></ul><ol><li>当重写equals方法时，同时也要重写hashCode方法。</li><li>不要让equals方法试图太聪明。</li><li>在equal 时方法声明中，不要将参数Object替换成其他类型。</li></ol><h4 id="在每个类中，在重写-equals-方法的时侯，一定要重写-hashcode-方法"><a href="#在每个类中，在重写-equals-方法的时侯，一定要重写-hashcode-方法" class="headerlink" title="在每个类中，在重写 equals 方法的时侯，一定要重写 hashcode 方法"></a>在每个类中，在重写 equals 方法的时侯，一定要重写 hashcode 方法</h4><ol><li>当在一个应用程序执行过程中，如果在equals方法比较中没有修改任何信息，在一个对象上重复调用hashCode方法时，它必须始终返回相同的值。从一个应用程序到另一个应用程序的每一次执行返回的值可以是不一致的。</li><li>如果两个对象根据equals(Object)方法比较是相等的，那么在两个对象上调用hashCode就必须产生的结果是相同的整数。</li><li>如果两个对象根据equals(Object)方法比较并不相等，则不要求在每个对象上调用hashCode都必须产生不同的结果。 但是，程序员应该意识到，为不相等的对象生成不同的结果可能会提高散列表（hash tables）的性能。</li></ol><ul><li>当无法重写hashCode时，所违反第二个关键条款是：相等的对象必须具有相等的哈希码（ hash codes）。</li><li>不要试图从哈希码计算中排除重要的属性来提高性能。</li><li>不要为hashCode返回的值提供详细的规范，因此客户端不能合理地依赖它； 你可以改变它的灵活性。</li></ul><h4 id="始终重写toString方法"><a href="#始终重写toString方法" class="headerlink" title="始终重写toString方法"></a>始终重写toString方法</h4><h4 id="接口仅用来定义类型"><a href="#接口仅用来定义类型" class="headerlink" title="接口仅用来定义类型"></a>接口仅用来定义类型</h4><ol><li>不在接口中定义常量，将常量放到与其紧密相关联的类或接口中，或将常量定义在工具类中，接口中最好仅保留类型的定义。</li><li>（如果一个非final类实现了常量接口，那么此类的所有子类都会被该常量接口所污染）。</li><li>如果大量使用实用工具类导出的常量，则通过使用静态导入来限定具有类名的常量。</li></ol><h4 id="优先考虑静态成员类"><a href="#优先考虑静态成员类" class="headerlink" title="优先考虑静态成员类"></a>优先考虑静态成员类</h4><p>嵌套类（nested class）是在另一个类中定义的类。 嵌套类应该只存在于其宿主类（enclosing class）中。 如果一个嵌套类在其他一些情况下是有用的，那么它应该是一个顶级类。 有四种嵌套类：静态成员类，非静态成员类，匿名类和局部类。 除了第一种以外，剩下的三种都被称为内部类（inner class）。   </p><ul><li>静态成员类是最简单的嵌套类。 最好把它看作是一个普通的类，恰好在另一个类中声明，并且可以访问所有宿主类的成员，甚至是那些被声明为私有类的成员。 静态成员类是其宿主类的静态成员，并遵循与其他静态成员相同的可访问性规则。 如果它被声明为private，则只能在宿主类中访问，静态成员类的一个常见用途是作为公共帮助类，仅在与其外部类一起使用时才有用。</li><li>非静态成员类实例和其宿主实例之间的关联是在创建成员类实例时建立的，并且之后不能被修改。 通常情况下，通过在宿主类的实例方法中调用非静态成员类构造方法来自动建立关联。 尽管很少有可能使用表达式enclosingInstance.new MemberClass(args)手动建立关联。 该关联在非静态成员类实例中占用了空间，并为其构建添加了时间开销。</li><li>一个匿名类没有名字。 它不是其宿主类的成员。 它不是与其他成员一起声明，而是在使用时同时声明和实例化。 在表达式合法的代码中，匿名类是允许的。 当且仅当它们出现在非静态上下文中时，匿名类才会封装实例。 但是，即使它们出现在静态上下文中，它们也不能有除常量型变量之外的任何静态成员，这些常量型变量包括final的基本类型，或者初始化常量表达式的字符串属性。匿名类是创建小方法对象和处理对象的首选方法，但lambda表达式现在是首选。 匿名类的另一个常见用途是实现静态工厂方法。</li><li>局部类是四种嵌套类中使用最少的。 一个局部类可以在任何可以声明局部变量的地方声明，并遵守相同的作用域规则。 局部类与其他类型的嵌套类具有共同的属性。 像成员类一样，他们有名字，可以重复使用。 就像匿名类一样，只有在非静态上下文中定义它们时，它们才会包含实例，并且它们不能包含静态成员。 像匿名类一样，应该保持简短，以免损害可读性。</li></ul><h4 id="永远不要将多个顶级类或接口放在一个源文件中。"><a href="#永远不要将多个顶级类或接口放在一个源文件中。" class="headerlink" title="永远不要将多个顶级类或接口放在一个源文件中。"></a>永远不要将多个顶级类或接口放在一个源文件中。</h4>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;effect-java学习笔记&quot;&gt;&lt;a href=&quot;#effect-java学习笔记&quot; class=&quot;headerlink&quot; title=&quot;effect-java学习笔记&quot;&gt;&lt;/a&gt;effect-java学习笔记&lt;/h2&gt;&lt;h4 id=&quot;基本类型和装箱类型的选择&quot;
      
    
    </summary>
    
      <category term="java" scheme="http://blog.ymlsfly.xin/categories/java/"/>
    
    
      <category term="effect-java" scheme="http://blog.ymlsfly.xin/tags/effect-java/"/>
    
  </entry>
  
  <entry>
    <title>svn安装部署</title>
    <link href="http://blog.ymlsfly.xin/2018/12/19/svn/"/>
    <id>http://blog.ymlsfly.xin/2018/12/19/svn/</id>
    <published>2018-12-19T12:45:37.000Z</published>
    <updated>2018-12-19T12:49:11.775Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SVN服务器的部署使用"><a href="#SVN服务器的部署使用" class="headerlink" title="SVN服务器的部署使用"></a>SVN服务器的部署使用</h1><pre><code>本文是博主亲自折腾过然后记录下的笔记，基本已经很全了，希望对其他的朋友都有帮助。   注明，博主折腾所用的是ubuntu服务器。</code></pre><h2 id="部署安装svn服务器"><a href="#部署安装svn服务器" class="headerlink" title="部署安装svn服务器"></a><em><strong>部署安装svn服务器</strong></em></h2><h3 id="1、安装svn"><a href="#1、安装svn" class="headerlink" title="1、安装svn"></a>1、安装svn</h3><p> 查看是否已经安装了svn：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svn --version</span><br></pre></td></tr></table></figure></p><p>如果已经安装，可以卸载（自选，重装即卸载）<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get remove --purge subversion</span><br><span class="line"><span class="comment"># （--purge 选项表示彻底删除该软件和相关文件）</span></span><br></pre></td></tr></table></figure></p><p>更新源并安装<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get update</span><br><span class="line">apt-get install subversion</span><br></pre></td></tr></table></figure></p><h3 id="2、创建svn版本库"><a href="#2、创建svn版本库" class="headerlink" title="2、创建svn版本库"></a>2、创建svn版本库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mkdir /<span class="built_in">test</span>/svn</span><br><span class="line">mkdir /<span class="built_in">test</span>/svn/repository</span><br><span class="line"><span class="comment"># 更改repository的权限（第一次搭建没有赋予权限，客户端访问服务器被拒绝）</span></span><br><span class="line">chmod -R 777 /<span class="built_in">test</span>/svn/repository</span><br><span class="line"><span class="comment"># 创建版本库</span></span><br><span class="line">svnadmin create /<span class="built_in">test</span>/svn/repository</span><br></pre></td></tr></table></figure><h3 id="3、修改配置文件"><a href="#3、修改配置文件" class="headerlink" title="3、修改配置文件"></a>3、修改配置文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /<span class="built_in">test</span>/svn/repository</span><br><span class="line">chmod -R 777 db</span><br></pre></td></tr></table></figure><ol><li><p>修改配置文件conf/svnserve.conf</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">vim /<span class="built_in">test</span>/svn/repository/conf/svnserve.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 匿名用户可读（可改成none，即不可读）</span></span><br><span class="line">anon-access = <span class="built_in">read</span></span><br><span class="line"><span class="comment"># 权限用户可写</span></span><br><span class="line">auth-access = write</span><br><span class="line"><span class="comment"># 密码文件为passwd</span></span><br><span class="line">password-db = passwd</span><br><span class="line"><span class="comment"># 权限文件为authz</span></span><br><span class="line">authz-db = authz</span><br><span class="line"><span class="comment"># （tip：去掉前面的# 并且顶格，不然会报错）</span></span><br></pre></td></tr></table></figure></li><li><p>添加访问用户密码文件conf/passwd</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim /<span class="built_in">test</span>/svn/repository/conf/passwd</span><br><span class="line"></span><br><span class="line">[users]</span><br><span class="line">fy = 123</span><br><span class="line">hello = hello</span><br><span class="line"><span class="comment"># （直接用户名 = 密码，一行一个用户，明文密码）</span></span><br></pre></td></tr></table></figure></li><li><p>设置用户权限conf/authz</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">vim /<span class="built_in">test</span>/svn/repository/conf/authz</span><br><span class="line"></span><br><span class="line">[groups]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切记组要定义在目录上面，否则会报错</span></span><br><span class="line"><span class="comment"># 用户fy属于admin权限组</span></span><br><span class="line">admin = fy</span><br><span class="line"></span><br><span class="line">[/]</span><br><span class="line"><span class="comment"># admin权限组的权限是读和写</span></span><br><span class="line">@admin = rw</span><br><span class="line"><span class="comment"># 所有的组都具有读权限和写权限</span></span><br><span class="line">* = r</span><br><span class="line"><span class="comment"># （[/]代表的根目录，注意定义用户组一定要放在最上面）</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="4、启动svn服务器"><a href="#4、启动svn服务器" class="headerlink" title="4、启动svn服务器"></a>4、启动svn服务器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">svnserve -d -r /<span class="built_in">test</span>/svn</span><br><span class="line"><span class="comment"># （-d：表示在后台运行，-r：指定服务器的根目录）</span></span><br></pre></td></tr></table></figure><p>用如下命令查看svnserve是否已经运行：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep svnserve</span><br><span class="line">&gt;&gt;root     28019  0.0  0.1  73492  2860 ?        Ss   Apr04   0:00 svnserve -d -r /software/svn/</span><br><span class="line"><span class="comment"># （表示服务器已经在后台运行了）</span></span><br></pre></td></tr></table></figure></p><p>如果需要关闭svn服务器，可以用如下命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">killall svnserve</span><br></pre></td></tr></table></figure></p><h3 id="5、客户端连接"><a href="#5、客户端连接" class="headerlink" title="5、客户端连接"></a>5、客户端连接</h3><p>在windows上打开小乌龟客户端，输入地址访问：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">svn://ip/repository</span></span><br><span class="line"># （按照登录用户不同，所得权限就不同）</span><br></pre></td></tr></table></figure></p><h2 id="svn和Apache整合"><a href="#svn和Apache整合" class="headerlink" title="svn和Apache整合"></a><em><strong>svn和Apache整合</strong></em></h2><h3 id="1、安装Apache"><a href="#1、安装Apache" class="headerlink" title="1、安装Apache"></a>1、安装Apache</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install apache2</span><br></pre></td></tr></table></figure><h3 id="2、修改Apache端口"><a href="#2、修改Apache端口" class="headerlink" title="2、修改Apache端口"></a>2、修改Apache端口</h3><p>（可选，此处因为博主nginx用了80端口，所以更换Apache端口为8081）<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/apache2/ports/conf</span><br><span class="line">Listen 8081</span><br><span class="line"></span><br><span class="line">vim /etc/apache2/sites-available/000-default.conf</span><br><span class="line">&lt;VirtualHost *:8081&gt;</span><br></pre></td></tr></table></figure></p><h3 id="3、安装整合需要的组件"><a href="#3、安装整合需要的组件" class="headerlink" title="3、安装整合需要的组件"></a>3、安装整合需要的组件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get install libapache2-svn</span><br><span class="line">apt-get install apache2-utils</span><br></pre></td></tr></table></figure><h3 id="4、修改Apache模块儿部分的配置文件"><a href="#4、修改Apache模块儿部分的配置文件" class="headerlink" title="4、修改Apache模块儿部分的配置文件"></a>4、修改Apache模块儿部分的配置文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/apache2/mods-enabled/dav_svn.load</span><br><span class="line">LoadModule dav_svn_module /usr/lib/apache2/modules/mod_dav_svn.so  </span><br><span class="line">LoadModule authz_svn_module /usr/lib/apache2/modules/mod_authz_svn.so</span><br></pre></td></tr></table></figure><h3 id="5、生成新的整合后登录的密码文件"><a href="#5、生成新的整合后登录的密码文件" class="headerlink" title="5、生成新的整合后登录的密码文件"></a>5、生成新的整合后登录的密码文件</h3><p>（可以直接用SVN的密码文件，但会覆盖，所以最好先备份，<br>原密码文件只能用于svn://前缀协议的登录，此生成的新密码文件只能用于http ://前缀协议的登录）<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cp /<span class="built_in">test</span>/svn/repository/conf/passwd /<span class="built_in">test</span>/svn/repository/conf/passwd.bak</span><br><span class="line">htpasswd -c /<span class="built_in">test</span>/svn/repository/conf/passwd <span class="string">'用户1'</span></span><br><span class="line">htpasswd /<span class="built_in">test</span>/svn/repository/conf/passwd <span class="string">'用户2'</span></span><br><span class="line"><span class="comment"># （切记：首次创建需要添加-c选项，如果再次添加用户的话不需要添加-c选项了，如果添加-c选项，之前已经添加的用户就会消失，相当于从新开始了）</span></span><br></pre></td></tr></table></figure></p><h3 id="6、配置Apache，以http的协议方式访问svn服务"><a href="#6、配置Apache，以http的协议方式访问svn服务" class="headerlink" title="6、配置Apache，以http的协议方式访问svn服务"></a>6、配置Apache，以http的协议方式访问svn服务</h3><p>（在安装libapache2-svn的时候，生成了一个路径为/etc/apache2/mods-available/dav_svn.conf的文件，直接进行修改即可）<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/apache2/mods-available/dav_svn.conf</span><br><span class="line"></span><br><span class="line">&lt;Location /svn&gt;</span><br><span class="line"><span class="comment"># http中需要输入的前缀</span></span><br><span class="line">DAV svn</span><br><span class="line"><span class="comment"># SVNParentPath /test/svn/repository  </span></span><br><span class="line"><span class="comment"># 挂载linux的文件路径</span></span><br><span class="line">SVNPath /<span class="built_in">test</span>/svn/repository</span><br><span class="line">AuthType Basic</span><br><span class="line">AuthName <span class="string">"Subversion Repository"</span></span><br><span class="line"><span class="comment"># 文字提示</span></span><br><span class="line">AuthUserFile /<span class="built_in">test</span>/svn/repository/conf/passwd</span><br><span class="line"><span class="comment"># 密码文件</span></span><br><span class="line">AuthzSVNAccessFile /<span class="built_in">test</span>/svn/repository/conf/authz</span><br><span class="line"><span class="comment"># 权限配置文件</span></span><br><span class="line">Require valid-user</span><br><span class="line"><span class="comment"># 每次登陆都输入密码</span></span><br><span class="line">&lt;/Location&gt;</span><br></pre></td></tr></table></figure></p><h3 id="7、重启svn，重启Apache"><a href="#7、重启svn，重启Apache" class="headerlink" title="7、重启svn，重启Apache"></a>7、重启svn，重启Apache</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">killall svnserve</span><br><span class="line">svnserve -d -r /<span class="built_in">test</span>/svn</span><br><span class="line">service apache2 restart</span><br></pre></td></tr></table></figure><h3 id="8、svn登录"><a href="#8、svn登录" class="headerlink" title="8、svn登录"></a>8、svn登录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://ip:8081/svn</span><br></pre></td></tr></table></figure><h2 id="一点小tip"><a href="#一点小tip" class="headerlink" title="一点小tip"></a>一点小tip</h2><h3 id="问题补充"><a href="#问题补充" class="headerlink" title="问题补充"></a>问题补充</h3><ul><li>客户端没有报错原因，在服务器端可以检查配置文件是否有误<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">svnauthz-validate /<span class="built_in">test</span>/svn/repository/conf/svnserve.conf</span><br><span class="line">svnauthz-validate /<span class="built_in">test</span>/svn/repository/conf/passwd</span><br><span class="line">svnauthz-validate /<span class="built_in">test</span>/svn/repository/conf/authz</span><br></pre></td></tr></table></figure></li></ul><p>如果读者有啥好的建议，或新的tip，等等都可以留言，博主会及时更新此博客！</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;SVN服务器的部署使用&quot;&gt;&lt;a href=&quot;#SVN服务器的部署使用&quot; class=&quot;headerlink&quot; title=&quot;SVN服务器的部署使用&quot;&gt;&lt;/a&gt;SVN服务器的部署使用&lt;/h1&gt;&lt;pre&gt;&lt;code&gt;本文是博主亲自折腾过然后记录下的笔记，基本已经很全了
      
    
    </summary>
    
      <category term="svn" scheme="http://blog.ymlsfly.xin/categories/svn/"/>
    
    
      <category term="svn" scheme="http://blog.ymlsfly.xin/tags/svn/"/>
    
  </entry>
  
  <entry>
    <title>使用laydate来显示个性化的时间输入框</title>
    <link href="http://blog.ymlsfly.xin/2018/03/16/%E4%BD%BF%E7%94%A8laydate%E6%9D%A5%E6%98%BE%E7%A4%BA%E4%B8%AA%E6%80%A7%E5%8C%96%E7%9A%84%E6%97%B6%E9%97%B4%E8%BE%93%E5%85%A5%E6%A1%86/"/>
    <id>http://blog.ymlsfly.xin/2018/03/16/使用laydate来显示个性化的时间输入框/</id>
    <published>2018-03-16T09:08:35.000Z</published>
    <updated>2018-03-16T11:26:51.860Z</updated>
    
    <content type="html"><![CDATA[<h2 id="内容简介"><a href="#内容简介" class="headerlink" title="内容简介"></a>内容简介</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">常规用法</span><br><span class="line">国际化</span><br><span class="line">年选择器</span><br><span class="line">年月选择器</span><br><span class="line">时间选择器</span><br><span class="line">日期时间选择器</span><br><span class="line">日期范围</span><br><span class="line">年范围</span><br><span class="line">年月范围</span><br><span class="line">时间范围</span><br><span class="line">日期时间范围</span><br><span class="line">自定义格式</span><br><span class="line">开启公历节日</span><br><span class="line">自定义重要日</span><br><span class="line">限定可选日期</span><br><span class="line">限定可选时间</span><br><span class="line">初始赋值</span><br><span class="line">选中后的回调</span><br><span class="line">日期切换的回调</span><br><span class="line">不出现底部栏</span><br><span class="line">只出现确定按钮</span><br><span class="line">自定义事件</span><br><span class="line">自定义颜色</span><br><span class="line">格子主题</span><br></pre></td></tr></table></figure><h2 id="代码展示"><a href="#代码展示" class="headerlink" title="代码展示"></a>代码展示</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/laydate/laydate.js"</span> &gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">/*常规用法*/</span></span><br><span class="line"><span class="undefined">laydate.render(&#123;</span></span><br><span class="line"><span class="undefined">elem: '.date1_1'</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">/*国际版*/</span></span><br><span class="line"><span class="undefined">laydate.render(&#123;</span></span><br><span class="line"><span class="undefined">elem: '.date1_2',</span></span><br><span class="line"><span class="undefined">lang: 'en'</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">/*年选择器*/</span></span><br><span class="line"><span class="undefined">laydate.render(&#123;</span></span><br><span class="line"><span class="undefined">elem: '.date2_1',</span></span><br><span class="line"><span class="undefined">type: 'year'</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">/*年月选择器*/</span></span><br><span class="line"><span class="undefined">laydate.render(&#123;</span></span><br><span class="line"><span class="undefined">elem: '.date2_2',</span></span><br><span class="line"><span class="undefined">type: 'month'</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">/*时间选择器*/</span></span><br><span class="line"><span class="undefined">laydate.render(&#123;</span></span><br><span class="line"><span class="undefined">elem: '.date2_3',</span></span><br><span class="line"><span class="undefined">type: 'time'</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">/*日期时间选择器*/</span></span><br><span class="line"><span class="undefined">laydate.render(&#123;</span></span><br><span class="line"><span class="undefined">elem: '.date2_4',</span></span><br><span class="line"><span class="undefined">type: 'datetime'</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">/*日期范围*/</span></span><br><span class="line"><span class="undefined">laydate.render(&#123;</span></span><br><span class="line"><span class="undefined">elem: '.date3_1',</span></span><br><span class="line"><span class="undefined">range: true</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">/*年范围*/</span></span><br><span class="line"><span class="undefined">laydate.render(&#123;</span></span><br><span class="line"><span class="undefined">elem: '.date3_2',</span></span><br><span class="line"><span class="undefined">type: 'year',</span></span><br><span class="line"><span class="undefined">range: true</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">/*年月范围*/</span></span><br><span class="line"><span class="undefined">laydate.render(&#123;</span></span><br><span class="line"><span class="undefined">elem: '.date3_3',</span></span><br><span class="line"><span class="undefined">type: 'month',</span></span><br><span class="line"><span class="undefined">range: true</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">/*时间范围*/</span></span><br><span class="line"><span class="undefined">laydate.render(&#123;</span></span><br><span class="line"><span class="undefined">elem: '.date3_4',</span></span><br><span class="line"><span class="undefined">type: 'time',</span></span><br><span class="line"><span class="undefined">range: true</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">/*日期时间范围*/</span></span><br><span class="line"><span class="undefined">laydate.render(&#123;</span></span><br><span class="line"><span class="undefined">elem: '.date3_5',</span></span><br><span class="line"><span class="undefined">type: 'datetime',</span></span><br><span class="line"><span class="undefined">range: true</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">/*自定义格式*/</span></span><br><span class="line"><span class="undefined">laydate.render(&#123;</span></span><br><span class="line"><span class="undefined">elem: '.date4_1',</span></span><br><span class="line"><span class="undefined">format: 'yyyy年MM月dd日'</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">laydate.render(&#123;</span></span><br><span class="line"><span class="undefined">elem: '.date4_2',</span></span><br><span class="line"><span class="undefined">format: 'dd/MM/yyyy'</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">laydate.render(&#123;</span></span><br><span class="line"><span class="undefined">elem: '.date4_3',</span></span><br><span class="line"><span class="undefined">format: 'yyyyMM'</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">laydate.render(&#123;</span></span><br><span class="line"><span class="undefined">elem: '.date4_4',</span></span><br><span class="line"><span class="undefined">type: 'time',</span></span><br><span class="line"><span class="undefined">format: 'H点M分'</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">laydate.render(&#123;</span></span><br><span class="line"><span class="undefined">elem: '.date4_5',</span></span><br><span class="line"><span class="undefined">type: 'month',</span></span><br><span class="line"><span class="undefined">range: '→',</span></span><br><span class="line"><span class="undefined">format: 'yyyy-MM'</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">laydate.render(&#123;</span></span><br><span class="line"><span class="undefined">elem: '.date4_6',</span></span><br><span class="line"><span class="undefined">type: 'datetime',</span></span><br><span class="line"><span class="undefined">range: '到',</span></span><br><span class="line"><span class="undefined">format: 'yyyy年M月d日H时m分s秒'</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">/*开启公历节日*/</span></span><br><span class="line"><span class="undefined">laydate.render(&#123;</span></span><br><span class="line"><span class="undefined">elem: '.date5_1',</span></span><br><span class="line"><span class="undefined">calendar: true</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">/*自定义重要日*/</span></span><br><span class="line"><span class="undefined">laydate.render(&#123;</span></span><br><span class="line"><span class="undefined">elem: '.date5_2',</span></span><br><span class="line"><span class="undefined">mark: &#123;</span></span><br><span class="line"><span class="undefined">'0-10-14': '生日',</span></span><br><span class="line"><span class="undefined">'0-12-31': '跨年' //每年的日期</span></span><br><span class="line"><span class="undefined">,</span></span><br><span class="line"><span class="undefined">'0-0-10': '工资' //每月某天</span></span><br><span class="line"><span class="undefined">,</span></span><br><span class="line"><span class="undefined">'0-0-15': '月中',</span></span><br><span class="line"><span class="undefined">'2017-8-15': '' //如果为空字符，则默认显示数字+徽章</span></span><br><span class="line"><span class="undefined">,</span></span><br><span class="line"><span class="undefined">'2099-10-14': '呵呵'</span></span><br><span class="line"><span class="undefined">&#125;,</span></span><br><span class="line"><span class="undefined">done: function(value, date) &#123;</span></span><br><span class="line"><span class="undefined">if(date.year === 2017 &amp;&amp; date.month === 8 &amp;&amp; date.date === 15) &#123; </span></span><br><span class="line"><span class="undefined">/*点击2017年8月15日，弹出提示语*/</span></span><br><span class="line"><span class="undefined">alert('这一天是：中国人民抗日战争胜利72周年');</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">/*限定可选日期*/</span></span><br><span class="line"><span class="undefined">var ins22 = laydate.render(&#123;</span></span><br><span class="line"><span class="undefined">elem: '.date6_1',</span></span><br><span class="line"><span class="undefined">min: '2016-10-14',</span></span><br><span class="line"><span class="undefined">max: '2080-10-14',</span></span><br><span class="line"><span class="undefined">ready: function() &#123;</span></span><br><span class="line"><span class="xml">ins22.hint('日期可选值设定在 <span class="tag">&lt;<span class="name">br</span>&gt;</span> 2016-10-14 到 2080-10-14');</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">/*前后若干天可选，这里以7天为例*/</span></span><br><span class="line"><span class="undefined">laydate.render(&#123;</span></span><br><span class="line"><span class="undefined">elem: '.date6_2',</span></span><br><span class="line"><span class="undefined">min: -7,</span></span><br><span class="line"><span class="undefined">max: 7</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">/*限定可选时间*/</span></span><br><span class="line"><span class="undefined">laydate.render(&#123;</span></span><br><span class="line"><span class="undefined">elem: '.date6_3',</span></span><br><span class="line"><span class="undefined">type: 'time',</span></span><br><span class="line"><span class="undefined">min: '09:30:00',</span></span><br><span class="line"><span class="undefined">max: '17:30:00',</span></span><br><span class="line"><span class="undefined">btns: ['clear', 'confirm']</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">/*初始赋值*/</span></span><br><span class="line"><span class="undefined">laydate.render(&#123;</span></span><br><span class="line"><span class="undefined">elem: '.date7_1',</span></span><br><span class="line"><span class="undefined">value: '1989-10-14'</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">/*选中后的回调*/</span></span><br><span class="line"><span class="undefined">laydate.render(&#123;</span></span><br><span class="line"><span class="undefined">elem: '.date7_2',</span></span><br><span class="line"><span class="undefined">done: function(value, date) &#123;</span></span><br><span class="line"><span class="undefined">alert('你选择的日期是：' + value + '\n获得的对象是' + JSON.stringify(date));</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">/*日期切换的回调*/</span></span><br><span class="line"><span class="undefined">laydate.render(&#123;</span></span><br><span class="line"><span class="undefined">elem: '.date7_3',</span></span><br><span class="line"><span class="undefined">change: function(value, date) &#123;</span></span><br><span class="line"><span class="undefined">alert('你选择的日期是：' + value + '\n\n获得的对象是' + JSON.stringify(date));</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">/*不出现底部栏*/</span></span><br><span class="line"><span class="undefined">laydate.render(&#123;</span></span><br><span class="line"><span class="undefined">elem: '.date7_4',</span></span><br><span class="line"><span class="undefined">showBottom: false</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">/*只出现确定按钮*/</span></span><br><span class="line"><span class="undefined">laydate.render(&#123;</span></span><br><span class="line"><span class="undefined">elem: '.date7_5',</span></span><br><span class="line"><span class="undefined">btns: ['confirm']</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">/*自定义事件*/</span></span><br><span class="line"><span class="undefined">laydate.render(&#123;</span></span><br><span class="line"><span class="undefined">elem: '.date7_6',</span></span><br><span class="line"><span class="undefined">trigger: 'mousedown'</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">/*墨绿主题*/</span></span><br><span class="line"><span class="undefined">laydate.render(&#123;</span></span><br><span class="line"><span class="undefined">elem: '.date8_1',</span></span><br><span class="line"><span class="undefined">theme: 'molv'</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">/*自定义颜色*/</span></span><br><span class="line"><span class="undefined">laydate.render(&#123;</span></span><br><span class="line"><span class="undefined">elem: '.date8_2',</span></span><br><span class="line"><span class="undefined">theme: '#393D49'</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">/*格子主题*/</span></span><br><span class="line"><span class="undefined">laydate.render(&#123;</span></span><br><span class="line"><span class="undefined">elem: '.date8_3',</span></span><br><span class="line"><span class="undefined">theme: 'grid'</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">center</span>&gt;</span></span><br><span class="line">date:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"date"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">datetime-local:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"datetime-local"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">time:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"time"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">中文版：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">readonly</span>=<span class="string">"readonly"</span> <span class="attr">class</span>=<span class="string">"date1_1"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">国际版：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">readonly</span>=<span class="string">"readonly"</span> <span class="attr">class</span>=<span class="string">"date1_2"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">年选择器：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">readonly</span>=<span class="string">"readonly"</span> <span class="attr">class</span>=<span class="string">"date2_1"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">年月选择器：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">readonly</span>=<span class="string">"readonly"</span> <span class="attr">class</span>=<span class="string">"date2_2"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">时间选择器：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">readonly</span>=<span class="string">"readonly"</span> <span class="attr">class</span>=<span class="string">"date2_3"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">日期时间选择器：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">readonly</span>=<span class="string">"readonly"</span> <span class="attr">class</span>=<span class="string">"date2_4"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">日期范围：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">readonly</span>=<span class="string">"readonly"</span> <span class="attr">class</span>=<span class="string">"date3_1"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">年范围：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">readonly</span>=<span class="string">"readonly"</span> <span class="attr">class</span>=<span class="string">"date3_2"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">年月范围：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">readonly</span>=<span class="string">"readonly"</span> <span class="attr">class</span>=<span class="string">"date3_3"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">时间范围：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">readonly</span>=<span class="string">"readonly"</span> <span class="attr">class</span>=<span class="string">"date3_4"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">日期时间范围：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">readonly</span>=<span class="string">"readonly"</span> <span class="attr">class</span>=<span class="string">"date3_5"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">yyyy年MM月dd日：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">readonly</span>=<span class="string">"readonly"</span> <span class="attr">class</span>=<span class="string">"date4_1"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">dd/MM/yyyy：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">readonly</span>=<span class="string">"readonly"</span> <span class="attr">class</span>=<span class="string">"date4_2"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">yyyyMM：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">readonly</span>=<span class="string">"readonly"</span> <span class="attr">class</span>=<span class="string">"date4_3"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">H点M分：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">readonly</span>=<span class="string">"readonly"</span> <span class="attr">class</span>=<span class="string">"date4_4"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">yyyy-MM：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">readonly</span>=<span class="string">"readonly"</span> <span class="attr">class</span>=<span class="string">"date4_5"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">yyyy年M月d日H时m分s秒：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">readonly</span>=<span class="string">"readonly"</span> <span class="attr">class</span>=<span class="string">"date4_6"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">开启公历节日：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">readonly</span>=<span class="string">"readonly"</span> <span class="attr">class</span>=<span class="string">"date5_1"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">自定义重要日：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">readonly</span>=<span class="string">"readonly"</span> <span class="attr">class</span>=<span class="string">"date5_2"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">限定可选日期：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">readonly</span>=<span class="string">"readonly"</span> <span class="attr">class</span>=<span class="string">"date6_1"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">前后若干天可选：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">readonly</span>=<span class="string">"readonly"</span> <span class="attr">class</span>=<span class="string">"date6_2"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">限定可选时间：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">readonly</span>=<span class="string">"readonly"</span> <span class="attr">class</span>=<span class="string">"date6_3"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">初始赋值：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">readonly</span>=<span class="string">"readonly"</span> <span class="attr">class</span>=<span class="string">"date7_1"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">选中后的回调：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">readonly</span>=<span class="string">"readonly"</span> <span class="attr">class</span>=<span class="string">"date7_2"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">日期切换的回调：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">readonly</span>=<span class="string">"readonly"</span> <span class="attr">class</span>=<span class="string">"date7_3"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">不出现底部栏：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">readonly</span>=<span class="string">"readonly"</span> <span class="attr">class</span>=<span class="string">"date7_4"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">只出现确定按钮：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">readonly</span>=<span class="string">"readonly"</span> <span class="attr">class</span>=<span class="string">"date7_5"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">自定义事件：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">readonly</span>=<span class="string">"readonly"</span> <span class="attr">class</span>=<span class="string">"date7_6"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">墨绿主题：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">readonly</span>=<span class="string">"readonly"</span> <span class="attr">class</span>=<span class="string">"date8_1"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">自定义颜色：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">readonly</span>=<span class="string">"readonly"</span> <span class="attr">class</span>=<span class="string">"date8_2"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">格子主题：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">readonly</span>=<span class="string">"readonly"</span> <span class="attr">class</span>=<span class="string">"date8_3"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="效果展示"><a href="#效果展示" class="headerlink" title="效果展示"></a>效果展示</h2><hr><p><a href="http://github.ifdream.xin/demo/laydate/laydateDemo.html" target="_blank" rel="noopener">http://github.ifdream.xin/demo/laydate/laydateDemo.html</a></p><hr><h2 id="资源文件链接"><a href="#资源文件链接" class="headerlink" title="资源文件链接"></a>资源文件链接</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://github.ifdream.xin/js/laydate/laydate.js</span><br><span class="line">http://github.ifdream.xin/js/laydate/theme.zip</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;内容简介&quot;&gt;&lt;a href=&quot;#内容简介&quot; class=&quot;headerlink&quot; title=&quot;内容简介&quot;&gt;&lt;/a&gt;内容简介&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pr
      
    
    </summary>
    
      <category term="日期时间输入框" scheme="http://blog.ymlsfly.xin/categories/%E6%97%A5%E6%9C%9F%E6%97%B6%E9%97%B4%E8%BE%93%E5%85%A5%E6%A1%86/"/>
    
    
      <category term="datetime" scheme="http://blog.ymlsfly.xin/tags/datetime/"/>
    
  </entry>
  
  <entry>
    <title>cannot be read or is not a valid ZIP file</title>
    <link href="http://blog.ymlsfly.xin/2018/01/30/cannot-be-read-or-is-not-a-valid-ZIP-file/"/>
    <id>http://blog.ymlsfly.xin/2018/01/30/cannot-be-read-or-is-not-a-valid-ZIP-file/</id>
    <published>2018-01-30T08:23:42.000Z</published>
    <updated>2018-01-30T08:32:33.890Z</updated>
    
    <content type="html"><![CDATA[<p>博主今天在eclipse中导入一个maven项目，在项目上报了个叹号，项目不能运行，打开problem窗口，终于在里面看到了错误：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cannot be read or is not a valid ZIP file</span><br></pre></td></tr></table></figure><p>百思不得其解，终于在网上找到了答案，这种异常错误是依赖的jar包没有完全下好。到repository 中删去相应的jar目录 让maven重新去下载。如果还报错，删除maven报错，eclipse中打开pom.xml 编辑状态 重新保存。看看最新的报错信息，进入对应的目录，删除即可。</p><p>博主就是到自己本地的maven仓库找到错误中指定位置指定的jar，将其完全删除，然后回到maven项目，随便变动下pom.xml文件，然后重新保存，让其重新下载那个没下载好的jar，等下完后就发现项目上的叹号没有了，问题解决了。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;博主今天在eclipse中导入一个maven项目，在项目上报了个叹号，项目不能运行，打开problem窗口，终于在里面看到了错误：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;
      
    
    </summary>
    
      <category term="异常错误集" scheme="http://blog.ymlsfly.xin/categories/%E5%BC%82%E5%B8%B8%E9%94%99%E8%AF%AF%E9%9B%86/"/>
    
    
      <category term="maven" scheme="http://blog.ymlsfly.xin/tags/maven/"/>
    
      <category term="eclipse报错" scheme="http://blog.ymlsfly.xin/tags/eclipse%E6%8A%A5%E9%94%99/"/>
    
  </entry>
  
  <entry>
    <title>zTree的试炼</title>
    <link href="http://blog.ymlsfly.xin/2018/01/29/zTree%E7%9A%84%E8%AF%95%E7%82%BC/"/>
    <id>http://blog.ymlsfly.xin/2018/01/29/zTree的试炼/</id>
    <published>2018-01-29T09:29:09.000Z</published>
    <updated>2018-01-29T11:04:52.745Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>jQuery的插件特别多，前几天博主盯上了zTree，这个有名的jquery树插件，然后通过网上一些别人的资料，以及官方的API，将zTree稍过了下，今天就将其分享出来！</p><h2 id="功能介绍"><a href="#功能介绍" class="headerlink" title="功能介绍"></a>功能介绍</h2><ol><li>初始化zTree</li><li>zTree的配置</li><li>添加/删除/获取/修改节点</li><li>全选/反选节点</li><li>节点上移下移</li><li>节点右键菜单</li></ol><h2 id="贴代码"><a href="#贴代码" class="headerlink" title="贴代码"></a>贴代码</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span> zTreeDemo <span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"content-type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"css/demo.css"</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"css/zTreeStyle.css"</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">#rMenuUl&#123;</span></span><br><span class="line"><span class="undefined">border: 1px dashed #617775;</span></span><br><span class="line"><span class="undefined">display: none;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">#rMenuUl li&#123;</span></span><br><span class="line"><span class="undefined">list-style: none;</span></span><br><span class="line"><span class="undefined">text-align: center;</span></span><br><span class="line"><span class="undefined">width: 100px;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">#rMenuUl li:hover&#123;</span></span><br><span class="line"><span class="undefined">background-color: #617775;</span></span><br><span class="line"><span class="undefined">color: white;</span></span><br><span class="line"><span class="undefined">cursor: pointer;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/jquery.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/jquery.ztree.all.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">var zTreeObj;</span></span><br><span class="line"><span class="undefined">var nowRightClickNode = null;</span></span><br><span class="line"><span class="undefined">// zTree 的参数配置，深入使用请参考 API 文档（setting 配置详解）</span></span><br><span class="line"><span class="undefined">var setting = &#123;</span></span><br><span class="line"><span class="undefined">treeId: "",</span></span><br><span class="line"><span class="undefined">treeObj: null,</span></span><br><span class="line"><span class="undefined">view: &#123;</span></span><br><span class="line"><span class="undefined">selectedMulti: true, //设置是否能够同时选中多个节点</span></span><br><span class="line"><span class="undefined">showIcon: true, //设置是否显示节点图标</span></span><br><span class="line"><span class="undefined">showLine: true, //设置是否显示节点与节点之间的连线</span></span><br><span class="line"><span class="undefined">showTitle: true, //设置是否显示节点的title提示信息</span></span><br><span class="line"><span class="undefined">&#125;,</span></span><br><span class="line"><span class="undefined">data: &#123;</span></span><br><span class="line"><span class="undefined">simpleData: &#123;</span></span><br><span class="line"><span class="undefined">enable: false, //设置是否启用简单数据格式（zTree支持标准数据格式跟简单数据格式）</span></span><br><span class="line"><span class="undefined">idKey: "id", //设置启用简单数据格式时id对应的属性名称</span></span><br><span class="line"><span class="undefined">pidKey: "pId" //设置启用简单数据格式时parentId对应的属性名称,ztree根据id及pid层级关系构建树结构</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">&#125;,</span></span><br><span class="line"><span class="undefined">check: &#123;</span></span><br><span class="line"><span class="undefined">enable: true //设置是否显示checkbox复选框</span></span><br><span class="line"><span class="undefined">&#125;,</span></span><br><span class="line"><span class="undefined">callback: &#123;</span></span><br><span class="line"><span class="undefined">/*定义节点单击事件回调函数*/</span></span><br><span class="line"><span class="undefined">onClick: onClick,</span></span><br><span class="line"><span class="undefined">/*定义节点右键单击事件回调函数*/</span></span><br><span class="line"><span class="undefined">onRightClick: OnRightClick,</span></span><br><span class="line"><span class="undefined">/*定义节点重新编辑成功前回调函数，一般用于节点编辑时判断输入的节点名称是否合法*/</span></span><br><span class="line"><span class="undefined">beforeRename: beforeRename,</span></span><br><span class="line"><span class="undefined">/*定义节点双击事件回调函数*/</span></span><br><span class="line"><span class="undefined">onDblClick: "onDblClick",</span></span><br><span class="line"><span class="undefined">/*定义节点复选框选中或取消选中事件的回调函数*/</span></span><br><span class="line"><span class="undefined">onCheck: onCheck</span></span><br><span class="line"><span class="undefined">&#125;,</span></span><br><span class="line"><span class="undefined">async: &#123;</span></span><br><span class="line"><span class="undefined">/*设置启用异步加载*/</span></span><br><span class="line"><span class="undefined">enable: true,</span></span><br><span class="line"><span class="undefined">/*异步加载类型:post和get*/</span></span><br><span class="line"><span class="undefined">type: "get",</span></span><br><span class="line"><span class="undefined">/*定义ajax提交参数的参数类型，一般为json格式*/</span></span><br><span class="line"><span class="undefined">contentType: "application/json",</span></span><br><span class="line"><span class="undefined">/*定义数据请求路径*/</span></span><br><span class="line"><span class="undefined">url: "/Design/Get",</span></span><br><span class="line"><span class="undefined">/*定义提交时参数的名称，=号前面标识节点属性，后面标识提交时json数据中参数的名称*/</span></span><br><span class="line"><span class="undefined">autoParam: ["id=id", "name=name"]</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">&#125;;</span></span><br><span class="line"><span class="undefined">/*节点数据*/</span></span><br><span class="line"><span class="undefined">var zNodes = [&#123;</span></span><br><span class="line"><span class="undefined">name: "test1",</span></span><br><span class="line"><span class="undefined">open: true,</span></span><br><span class="line"><span class="undefined">children: [&#123;</span></span><br><span class="line"><span class="undefined">name: "test1_1"</span></span><br><span class="line"><span class="undefined">&#125;, &#123;</span></span><br><span class="line"><span class="undefined">name: "test1_2"</span></span><br><span class="line"><span class="undefined">&#125;]</span></span><br><span class="line"><span class="undefined">&#125;,&#123;</span></span><br><span class="line"><span class="undefined">name: "test2",</span></span><br><span class="line"><span class="undefined">open: true,</span></span><br><span class="line"><span class="undefined">children: [&#123;</span></span><br><span class="line"><span class="undefined">name: "test2_1"</span></span><br><span class="line"><span class="undefined">&#125;, &#123;</span></span><br><span class="line"><span class="undefined">name: "test2_2"</span></span><br><span class="line"><span class="undefined">&#125;]</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">];</span></span><br><span class="line"><span class="undefined">$(document).ready(function() &#123;</span></span><br><span class="line"><span class="undefined">/*初始化时会返回该树*/</span></span><br><span class="line"><span class="undefined">var zTreeObj = $.fn.zTree.init($("#treeDemo"), setting, zNodes);</span></span><br><span class="line"><span class="undefined">/*获取所有选中的节点*/</span></span><br><span class="line"><span class="undefined">$("#getCheckedNodes").click(function()&#123;</span></span><br><span class="line"><span class="undefined">var nodes = zTreeObj.getCheckedNodes();</span></span><br><span class="line"><span class="undefined">var str = "选中的节点数：" + nodes.length;</span></span><br><span class="line"><span class="undefined">$.each(nodes, function(index,n) &#123;</span></span><br><span class="line"><span class="undefined">str += "\n" + n.name ;</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">alert(str);</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">/*添加节点*/</span></span><br><span class="line"><span class="undefined">$("#addNode").click(function() &#123;</span></span><br><span class="line"><span class="undefined">/*获取到该树*/</span></span><br><span class="line"><span class="undefined">var tree = $.fn.zTree.getZTreeObj("treeDemo");</span></span><br><span class="line"><span class="undefined">/*</span></span><br><span class="line"><span class="undefined"> *  parentNode:指定的父节点，如果增加根节点，请设置 parentNode 为 null 即可</span></span><br><span class="line"><span class="undefined">index:新节点插入的位置（从 0 开始），index = -1 时，插入到最后，此参数可忽略</span></span><br><span class="line"><span class="undefined">newNodes：需要增加的节点数据 JSON 对象集合，数据只需要满足 zTree 的节点数据必需的属性即可 </span></span><br><span class="line"><span class="undefined">isSilent：true 时，添加节点后不展开父节点，其他值或缺省状态都自动展开</span></span><br><span class="line"><span class="undefined"> * </span></span><br><span class="line"><span class="undefined"> * */</span></span><br><span class="line"><span class="undefined">tree.addNodes(null, 2, [&#123;</span></span><br><span class="line"><span class="undefined">name:"hello",</span></span><br><span class="line"><span class="undefined">open : true ,</span></span><br><span class="line"><span class="undefined">children : [</span></span><br><span class="line"><span class="undefined">&#123;name:"hello1"&#125; , &#123;name:"hello2"&#125;</span></span><br><span class="line"><span class="undefined">]&#125;], false);</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">/*全选所有节点*/</span></span><br><span class="line"><span class="undefined">$("#checkAll").click(function()&#123;</span></span><br><span class="line"><span class="undefined">var tree = $.fn.zTree.getZTreeObj("treeDemo");</span></span><br><span class="line"><span class="undefined">/*checked参数为true时全部勾选，为false时全部取消勾选。*/</span></span><br><span class="line"><span class="undefined">tree.checkAllNodes(true);</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">/*反选所有节点*/</span></span><br><span class="line"><span class="undefined">$("#checkAllNo").click(function()&#123;</span></span><br><span class="line"><span class="undefined">var tree = $.fn.zTree.getZTreeObj("treeDemo");</span></span><br><span class="line"><span class="undefined">var nodes = tree.getNodes();</span></span><br><span class="line"><span class="undefined">$.each(nodes, function(index,n) &#123;</span></span><br><span class="line"><span class="undefined">/*</span></span><br><span class="line"><span class="undefined"> * check_Child_State子节点勾选状态</span></span><br><span class="line"><span class="undefined"> * -1不存在子节点 或 子节点全部设置为 nocheck = true</span></span><br><span class="line"><span class="undefined">0无 子节点被勾选</span></span><br><span class="line"><span class="undefined">1部分 子节点被勾选</span></span><br><span class="line"><span class="undefined">2全部 子节点被勾选</span></span><br><span class="line"><span class="undefined"> * */</span></span><br><span class="line"><span class="undefined">if(n.check_Child_State == 0)&#123;</span></span><br><span class="line"><span class="undefined">checkXNode(tree , n);</span></span><br><span class="line"><span class="undefined">&#125;else&#123;</span></span><br><span class="line"><span class="undefined">checkCNode(tree , n);</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">/*通过递归来反选某节点*/</span></span><br><span class="line"><span class="undefined">function checkCNode(tree , node)&#123;</span></span><br><span class="line"><span class="undefined">if(node.children != null)&#123;</span></span><br><span class="line"><span class="undefined">if(node.check_Child_State == 2)&#123;</span></span><br><span class="line"><span class="undefined">/*原来的子节点全被选中*/</span></span><br><span class="line"><span class="undefined">tree.checkNode(node,false);</span></span><br><span class="line"><span class="undefined">$.each(node.children, function(index , n) &#123;</span></span><br><span class="line"><span class="undefined">checkCNode(tree,n);</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">&#125;else&#123;</span></span><br><span class="line"><span class="undefined">$.each(node.children, function(index , n) &#123;</span></span><br><span class="line"><span class="undefined">if(n.checked)&#123;</span></span><br><span class="line"><span class="undefined">checkCNode(tree , n);</span></span><br><span class="line"><span class="undefined">&#125;else&#123;</span></span><br><span class="line"><span class="undefined">checkXNode(tree,n);</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">&#125;else&#123;</span></span><br><span class="line"><span class="undefined">/*node无子节点*/</span></span><br><span class="line"><span class="undefined">tree.checkNode(node,false); </span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">/*通过递归来选择某节点*/</span></span><br><span class="line"><span class="undefined">function checkXNode(tree,node)&#123;</span></span><br><span class="line"><span class="undefined">tree.checkNode(node);</span></span><br><span class="line"><span class="undefined">if(node.children != null)&#123;</span></span><br><span class="line"><span class="undefined">$.each(node.children, function(index , n) &#123;</span></span><br><span class="line"><span class="undefined">checkXNode(tree , n);</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">/*通过递归将某节点置为未选*/</span></span><br><span class="line"><span class="undefined">function checkNNode(tree , node)&#123;</span></span><br><span class="line"><span class="undefined">tree.checkNode(node,false); </span></span><br><span class="line"><span class="undefined">if(node.children)&#123;</span></span><br><span class="line"><span class="undefined">$.each(node.children, function(index , n) &#123;</span></span><br><span class="line"><span class="undefined">checkNNode(tree , n);</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">/*节点单击事件*/</span></span><br><span class="line"><span class="undefined">function onClick(e, treeId, treeNode) &#123;</span></span><br><span class="line"><span class="undefined">/*如果不是叶子结点，结束*/</span></span><br><span class="line"><span class="undefined">if(treeNode.isParent)</span></span><br><span class="line"><span class="undefined">return;</span></span><br><span class="line"><span class="undefined">/*获取当前结点上的相关属性数据，执行相关逻辑*/</span></span><br><span class="line"><span class="undefined">alert(treeNode.name);</span></span><br><span class="line"><span class="undefined">&#125;;</span></span><br><span class="line"><span class="undefined">/*节点复选框事件*/</span></span><br><span class="line"><span class="undefined">function onCheck() &#123;</span></span><br><span class="line"><span class="undefined">/*获取树对象*/</span></span><br><span class="line"><span class="undefined">var treeObj = $.fn.zTree.getZTreeObj("treeDemo");</span></span><br><span class="line"><span class="undefined">/*获取勾选状态改变的节点*/</span></span><br><span class="line"><span class="undefined">var nodes = treeObj.getChangeCheckedNodes();</span></span><br><span class="line"><span class="undefined">var designIds = [];</span></span><br><span class="line"><span class="undefined">/*定义初始勾选状态为未勾选*/</span></span><br><span class="line"><span class="undefined">var status = 0;</span></span><br><span class="line"><span class="undefined">if(nodes[0].checked)</span></span><br><span class="line"><span class="undefined">/*如果状态改变节点为勾选状态，说明当前操作是从未勾选变为已勾选。*/</span></span><br><span class="line"><span class="undefined">status = 1;</span></span><br><span class="line"><span class="undefined">$.each(nodes, function(i, item) &#123;</span></span><br><span class="line"><span class="undefined">/*将状态改变的节点id输出到数组*/</span></span><br><span class="line"><span class="undefined">designIds.push(item.id);</span></span><br><span class="line"><span class="undefined">/*将节点的初始状态置为当前状态。否则每次勾选操作获取状态改变节点时只会跟树初始化的状态相比较。*/</span></span><br><span class="line"><span class="undefined">item.checkedOld = item.checked;</span></span><br><span class="line"><span class="undefined">&#125;)</span></span><br><span class="line"><span class="undefined">$.ajax(&#123;</span></span><br><span class="line"><span class="undefined">type: "Post",</span></span><br><span class="line"><span class="undefined">url: "url",</span></span><br><span class="line"><span class="undefined">data: &#123;</span></span><br><span class="line"><span class="undefined">"designIds": designIds</span></span><br><span class="line"><span class="undefined">&#125;,</span></span><br><span class="line"><span class="undefined">success: function(data) &#123;</span></span><br><span class="line"><span class="undefined">RealBimOcx.BatchAddSubClrInfoBegin();</span></span><br><span class="line"><span class="undefined">$.each(data.result, function(i, item) &#123;</span></span><br><span class="line"><span class="undefined">/*这里根据发生改变的节点是勾选还是为勾选进行相关逻辑操作。*/</span></span><br><span class="line"><span class="undefined">if(status == 1)</span></span><br><span class="line"><span class="undefined">RealBimOcx.AddSubClrInfo(item, 255, 255, 0);</span></span><br><span class="line"><span class="undefined">else</span></span><br><span class="line"><span class="undefined">RealBimOcx.AddSubClrInfo(item, 0, 255, 0);</span></span><br><span class="line"><span class="undefined">if(i % 100 == 0) &#123;</span></span><br><span class="line"><span class="undefined">RealBimOcx.BatchAddSubClrInfoEnd();</span></span><br><span class="line"><span class="undefined">RealBimOcx.BatchAddSubClrInfoBegin();</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">&#125;)</span></span><br><span class="line"><span class="undefined">RealBimOcx.BatchAddSubClrInfoEnd();</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">&#125;)</span></span><br><span class="line"><span class="undefined">&#125;;</span></span><br><span class="line"><span class="undefined">/*节点右键单击回调函数*/</span></span><br><span class="line"><span class="undefined">function OnRightClick(event, treeId, treeNode) &#123;</span></span><br><span class="line"><span class="undefined">nowRightClickNode = treeNode;</span></span><br><span class="line"><span class="undefined">var zTree = $.fn.zTree.getZTreeObj("treeDemo");</span></span><br><span class="line"><span class="undefined">$("#treeDemo").hide();</span></span><br><span class="line"><span class="undefined">if(treeNode)&#123;</span></span><br><span class="line"><span class="undefined">/*点击的是节点*/</span></span><br><span class="line"><span class="undefined">if(treeNode.getParentNode() == null)&#123;</span></span><br><span class="line"><span class="undefined">zTree.cancelSelectedNode();</span></span><br><span class="line"><span class="undefined">/*根据鼠标位置显示右键操作面板*/</span></span><br><span class="line"><span class="undefined">showRMenu("root", event.clientX, event.clientY);</span></span><br><span class="line"><span class="undefined">&#125; else if(!treeNode.noR) &#123;</span></span><br><span class="line"><span class="undefined">zTree.selectNode(treeNode,false,false);</span></span><br><span class="line"><span class="undefined">showRMenu("node", event.clientX, event.clientY);</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">$("#treeDemo").show();</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">/*根据节点类型，控制右键操作菜单哪些可用哪些不可用*/</span></span><br><span class="line"><span class="undefined">function showRMenu(type, x, y) &#123;</span></span><br><span class="line"><span class="undefined">$("#rMenu ul").show();</span></span><br><span class="line"><span class="undefined">if(type == "root") &#123;</span></span><br><span class="line"><span class="undefined">$("#m_del").hide();</span></span><br><span class="line"><span class="undefined">$("#m_edit").hide();</span></span><br><span class="line"><span class="undefined">$("#m_up").hide();</span></span><br><span class="line"><span class="undefined">$("#m_down").hide();</span></span><br><span class="line"><span class="undefined">$("#m_ulevel").hide();</span></span><br><span class="line"><span class="undefined">$("#m_dlevel").hide();</span></span><br><span class="line"><span class="undefined">$("#m_add").addClass('mboder');</span></span><br><span class="line"><span class="undefined">&#125; else &#123;</span></span><br><span class="line"><span class="undefined">$("#m_del").show();</span></span><br><span class="line"><span class="undefined">$("#m_edit").show();</span></span><br><span class="line"><span class="undefined">$("#m_up").show();</span></span><br><span class="line"><span class="undefined">$("#m_down").show();</span></span><br><span class="line"><span class="undefined">$("#m_add").removeClass('mboder');</span></span><br><span class="line"><span class="undefined">$("#m_ulevel").show();</span></span><br><span class="line"><span class="undefined">$("#m_dlevel").show();</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">$("#rMenu").css(&#123;</span></span><br><span class="line"><span class="undefined">"top": y + "px",</span></span><br><span class="line"><span class="undefined">"left": x + "px",</span></span><br><span class="line"><span class="undefined">"display": "block"</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">$("body").bind("mousedown", onBodyMouseDown);</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">/*隐藏右键面板*/</span></span><br><span class="line"><span class="undefined">function hideRMenu() &#123;</span></span><br><span class="line"><span class="undefined">var rMenu = $("#rMenu");</span></span><br><span class="line"><span class="undefined">if(rMenu) rMenu.css(&#123;</span></span><br><span class="line"><span class="undefined">"display": "none"</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">$("body").unbind("mousedown", onBodyMouseDown);</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">/*单击页面其他位置 隐藏右键面板*/</span></span><br><span class="line"><span class="undefined">function onBodyMouseDown(event) &#123;</span></span><br><span class="line"><span class="undefined">if(!(event.target.id == "rMenu" || $(event.target).parents("#rMenu").length &gt; 0)) &#123;</span></span><br><span class="line"><span class="undefined">$("#rMenu").css(&#123;</span></span><br><span class="line"><span class="undefined">"display": "none"</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">/*增加节点*/</span></span><br><span class="line"><span class="undefined">function addTreeNode() &#123;</span></span><br><span class="line"><span class="undefined"> var zTree = $.fn.zTree.getZTreeObj("treeDemo");</span></span><br><span class="line"><span class="undefined">hideRMenu();</span></span><br><span class="line"><span class="undefined">var name = window.prompt("请输入新增的子节点的名称：");</span></span><br><span class="line"><span class="undefined">if(name == null || name == "")return;</span></span><br><span class="line"><span class="undefined">var newNode = &#123;</span></span><br><span class="line"><span class="undefined">name: name</span></span><br><span class="line"><span class="undefined">&#125;;</span></span><br><span class="line"><span class="undefined">newNode.checked = nowRightClickNode.checked;</span></span><br><span class="line"><span class="undefined">newNode.pid = nowRightClickNode.id;</span></span><br><span class="line"><span class="undefined">zTree.addNodes(nowRightClickNode, newNode);</span></span><br><span class="line"><span class="undefined">/*得到新增加的节点*/</span></span><br><span class="line"><span class="undefined">var node = zTree.getNodeByParam("name", name, null); </span></span><br><span class="line"><span class="undefined">/*选中新增加的节点*/</span></span><br><span class="line"><span class="undefined">zTree.selectNode(node);</span></span><br><span class="line"><span class="undefined">/*让新增加的节点处于编辑状态*/</span></span><br><span class="line"><span class="undefined">zTree.editName(node); </span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">/*编辑节点*/</span></span><br><span class="line"><span class="undefined">function editTreeNode() &#123;</span></span><br><span class="line"><span class="undefined">var zTree = $.fn.zTree.getZTreeObj("treeDemo");</span></span><br><span class="line"><span class="undefined">/*得到选中节点集合*/</span></span><br><span class="line"><span class="undefined">var nodes = zTree.getSelectedNodes(); </span></span><br><span class="line"><span class="undefined">if (nodes &amp;&amp; nodes.length &gt; 0) &#123;</span></span><br><span class="line"><span class="undefined">/*得到选中节点的父节点*/</span></span><br><span class="line"><span class="undefined">var parent = nodes[0].getParentNode(); </span></span><br><span class="line"><span class="undefined">if (parent) &#123;</span></span><br><span class="line"><span class="undefined">/*如果选中节点父节点存在，将当前节点的pid属性值设置为父节点的id*/</span></span><br><span class="line"><span class="undefined">nodes[0].pid = parent.id; </span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">/*让选中节点处于编辑状态*/</span></span><br><span class="line"><span class="undefined">zTree.editName(nodes[0]); </span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">hideRMenu();</span></span><br><span class="line"><span class="undefined">&#125;;</span></span><br><span class="line"><span class="undefined">/*节点编辑状态离开时触发事件 */</span></span><br><span class="line"><span class="undefined">    /*编辑并保存节点（对编辑的检查）*/</span></span><br><span class="line"><span class="undefined">    function beforeRename(treeId, treeNode, newName, isCancel) &#123;</span></span><br><span class="line"><span class="undefined">if (newName.length == 0) &#123; //节点名称判断</span></span><br><span class="line"><span class="undefined">alert("节点名不能为空。");</span></span><br><span class="line"><span class="undefined">return false;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">return true;</span></span><br><span class="line"><span class="undefined">&#125;;</span></span><br><span class="line"><span class="undefined">/*删除节点数据 */</span></span><br><span class="line"><span class="undefined">function removeTreeNode() &#123;</span></span><br><span class="line"><span class="undefined"> var zTree = $.fn.zTree.getZTreeObj("treeDemo");</span></span><br><span class="line"><span class="undefined">hideRMenu();</span></span><br><span class="line"><span class="undefined">var nodes = zTree.getSelectedNodes();</span></span><br><span class="line"><span class="undefined">if (nodes &amp;&amp; nodes.length &gt; 0) &#123;</span></span><br><span class="line"><span class="undefined">if (nodes[0].children &amp;&amp; nodes[0].children.length &gt; 0) &#123;</span></span><br><span class="line"><span class="undefined">if(window.confirm("包含下级子节点，是否连带删除？"))&#123;</span></span><br><span class="line"><span class="undefined">zTree.removeNode(nodes[0]);</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">&#125; else &#123;</span></span><br><span class="line"><span class="undefined">zTree.removeNode(nodes[0]);</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">&#125;;</span></span><br><span class="line"><span class="undefined">/*上移*/</span></span><br><span class="line"><span class="undefined">function m_up()&#123;</span></span><br><span class="line"><span class="undefined">var zTree = $.fn.zTree.getZTreeObj("treeDemo");</span></span><br><span class="line"><span class="undefined">hideRMenu();</span></span><br><span class="line"><span class="undefined">var nodes = zTree.getSelectedNodes();</span></span><br><span class="line"><span class="undefined">var n = nodes[0];</span></span><br><span class="line"><span class="undefined">if(n &amp;&amp; !n.isFirstNode)&#123;</span></span><br><span class="line"><span class="undefined">zTree.moveNode(n.getPreNode(),n,"prev");</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">/*下移*/</span></span><br><span class="line"><span class="undefined">function m_down()&#123;</span></span><br><span class="line"><span class="undefined">var zTree = $.fn.zTree.getZTreeObj("treeDemo");</span></span><br><span class="line"><span class="undefined">hideRMenu();</span></span><br><span class="line"><span class="undefined">var nodes = zTree.getSelectedNodes();</span></span><br><span class="line"><span class="undefined">var n = nodes[0];</span></span><br><span class="line"><span class="undefined">if(n &amp;&amp; !n.isLastNode)&#123;</span></span><br><span class="line"><span class="undefined">zTree.moveNode(n.getNextNode(),n,"next");</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">/*重置节点*/</span></span><br><span class="line"><span class="undefined">function resetTree()&#123;</span></span><br><span class="line"><span class="undefined">var zTree = $.fn.zTree.getZTreeObj("treeDemo");</span></span><br><span class="line"><span class="undefined">hideRMenu();</span></span><br><span class="line"><span class="undefined">var nodes = zTree.getSelectedNodes();</span></span><br><span class="line"><span class="undefined">if(nodes)checkNNode(zTree , nodes[0])</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">/*升一级*/</span></span><br><span class="line"><span class="undefined">function uLevel()&#123;</span></span><br><span class="line"><span class="undefined">var zTree = $.fn.zTree.getZTreeObj("treeDemo");</span></span><br><span class="line"><span class="undefined">hideRMenu();</span></span><br><span class="line"><span class="undefined">var nodes = zTree.getSelectedNodes();</span></span><br><span class="line"><span class="undefined">var n = nodes[0];</span></span><br><span class="line"><span class="undefined">if(n)&#123;</span></span><br><span class="line"><span class="undefined">zTree.moveNode(n.getParentNode(),n,"next");</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">/*降一级*/</span></span><br><span class="line"><span class="undefined">function dLevel()&#123;</span></span><br><span class="line"><span class="undefined">var zTree = $.fn.zTree.getZTreeObj("treeDemo");</span></span><br><span class="line"><span class="undefined">hideRMenu();</span></span><br><span class="line"><span class="undefined">var nodes = zTree.getSelectedNodes();</span></span><br><span class="line"><span class="undefined">var n = nodes[0];</span></span><br><span class="line"><span class="undefined">if(n)&#123;</span></span><br><span class="line"><span class="undefined">/*默认往下一个节点降*/</span></span><br><span class="line"><span class="undefined">/*zTree.moveNode(n.getNextNode(),n,"inner");*/</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"treeDemo"</span> <span class="attr">style</span>=<span class="string">"background-color: #7EC4CC;"</span> <span class="attr">class</span>=<span class="string">"ztree"</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"getCheckedNodes"</span>&gt;</span>获取选中的节点<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"addNode"</span>&gt;</span>添加节点<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"checkAll"</span>&gt;</span>全选所有节点<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"checkAllNo"</span>&gt;</span>反选所有节点<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--自定义的右键弹出面板--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"rMenu"</span> <span class="attr">style</span>=<span class="string">"z-index:100;position: absolute;background-color: white;"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"rMenuUl"</span><span class="attr">onselectstart</span>=<span class="string">"return false;"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">id</span>=<span class="string">"m_add"</span> <span class="attr">onclick</span>=<span class="string">"addTreeNode()"</span>&gt;</span>新增节点<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">id</span>=<span class="string">"m_del"</span> <span class="attr">onclick</span>=<span class="string">"removeTreeNode()"</span>&gt;</span>删除节点<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">id</span>=<span class="string">"m_edit"</span> <span class="attr">onclick</span>=<span class="string">"editTreeNode()"</span> <span class="attr">style</span>=<span class="string">"border-bottom:1px solid #cecece"</span>&gt;</span>编辑节点<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">id</span>=<span class="string">"m_up"</span> <span class="attr">onclick</span>=<span class="string">"m_up()"</span>&gt;</span>上移<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">id</span>=<span class="string">"m_down"</span> <span class="attr">onclick</span>=<span class="string">"m_down()"</span> <span class="attr">style</span>=<span class="string">"border-bottom:1px solid #cecece"</span>&gt;</span>下移<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">id</span>=<span class="string">"m_reset"</span> <span class="attr">onclick</span>=<span class="string">"resetTree()"</span>&gt;</span>重置节点<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">id</span>=<span class="string">"m_ulevel"</span> <span class="attr">onclick</span>=<span class="string">"uLevel()"</span>&gt;</span>升一级<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">id</span>=<span class="string">"m_dlevel"</span> <span class="attr">onclick</span>=<span class="string">"dLevel()"</span>&gt;</span>降一级<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="效果展示"><a href="#效果展示" class="headerlink" title="效果展示"></a>效果展示</h2><hr><p><a href="http://github.ifdream.xin/demo/zTree/zTreeDemo.html" target="_blank" rel="noopener">http://github.ifdream.xin/demo/zTree/zTreeDemo.html</a></p><hr><h2 id="资源文件链接"><a href="#资源文件链接" class="headerlink" title="资源文件链接"></a>资源文件链接</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http://github.ifdream.xin/css/zTree/demo.css</span><br><span class="line">http://github.ifdream.xin/css/zTree/zTreeStyle.css</span><br><span class="line">http://github.ifdream.xin/css/zTree/img.zip</span><br><span class="line">http://github.ifdream.xin/js/jquery.min.js</span><br><span class="line">http://github.ifdream.xin/js/zTree/jquery.ztree.all.min.js</span><br></pre></td></tr></table></figure><h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>zTree插件的功能很强大，官方API也很详细，博主才只是略学了一二，读者应该学不止于此，可以上官方API上看看，再进一步学学，也可以在下面留言，和博主探讨，本文若有不足希望大家能够指出，一起学习，一起进步，谢谢！</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;jQuery的插件特别多，前几天博主盯上了zTree，这个有名的jquery树插件，然后通过网上一些别人的资料，以及官方的API，将zTre
      
    
    </summary>
    
      <category term="JQuery插件" scheme="http://blog.ymlsfly.xin/categories/JQuery%E6%8F%92%E4%BB%B6/"/>
    
    
      <category term="zTree" scheme="http://blog.ymlsfly.xin/tags/zTree/"/>
    
  </entry>
  
</feed>
